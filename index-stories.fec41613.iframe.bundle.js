"use strict";(self.webpackChunkcollaborative_codemirror=self.webpackChunkcollaborative_codemirror||[]).push([[141],{"./src/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("./node_modules/react/index.js"),json_crdt=__webpack_require__("./node_modules/json-joy/lib/json-crdt/index.js"),dist=__webpack_require__("./node_modules/@codemirror/view/dist/index.js"),lib=__webpack_require__("./node_modules/collaborative-editor/lib/index.js");class CodemirrorEditorFacade{disposed=!1;d1=(()=>{var _this=this;return function(){for(var _len=arguments.length,specs=new Array(_len),_key=0;_key<_len;_key++)specs[_key]=arguments[_key];const res=_this.d0.apply(_this.editor,specs);return _this.disposed||(_this.onchange?.(),_this.onselection?.()),res}})();constructor(editor){this.editor=editor,this.d0=editor.dispatch,Object.defineProperty(editor,"dispatch",{...Object.getOwnPropertyDescriptor(editor,"dispatch"),value:this.d1})}get(){return this.editor.state.doc.toString()}getLength(){return this.editor.state.doc.length}set(text){const state=this.editor.state;this.d0({changes:{from:0,to:state.doc.length,insert:text}})}ins(from,insert){this.d0({changes:{from,insert}})}del(from,length){this.d0({changes:{from,to:from+length,insert:""}})}getSelection(){const state=this.editor.state,range=state.selection?.ranges[0];if(!range)return null;let start=range.anchor,end=range.head,direction=1;return end<start&&([start,end]=[end,start],direction=-1),[start,end,direction]}setSelection(start,end,direction){let anchor=start,head=end;-1===direction&&([anchor,head]=[head,anchor]),this.d0?.({selection:{anchor,head}})}dispose(){this.disposed=!0;const editor=this.editor,descriptor=Object.getOwnPropertyDescriptor(editor,"dispatch");descriptor?.value===this.d1&&Object.defineProperty(editor,"dispatch",{...descriptor,value:this.d0})}}const index_stories={title:"CodeMirror Editor",component:({src=""})=>{const divEl=react.useRef(null),editorRef=react.useRef(null),[model,clone]=react.useMemo(()=>{const model=json_crdt.Model.create(json_crdt.s.str(src));return[model,model.clone()]},[]);react.useEffect(()=>{if(!divEl.current)return;const editor=new dist.Lz({parent:divEl.current});editorRef.current=editor;const unbind=((str,editor,polling)=>{const facade=new CodemirrorEditorFacade(editor);return lib.StrBinding.bind(str,facade,polling)})(()=>model.s.toApi(),editor,!0);return()=>{unbind()}},[model]),react.useSyncExternalStore(model.api.subscribe,()=>model.tick);return react.createElement("div",null,react.createElement("div",{className:"Editor",ref:divEl,style:{width:800,minHeight:250,border:"1px solid #ddd"}}),react.createElement("div",null,react.createElement("button",{onClick:()=>((text,position)=>{const editor=editorRef.current;if(!editor)return;const state=editor.state;editor.dispatch({changes:{from:position??state.doc.length,to:position??state.doc.length,insert:text}})})("!")},'Append "!" to editor')),react.createElement("div",null,react.createElement("button",{onClick:()=>setTimeout(()=>{const str=model.api.str([]);str.ins(str.length(),"?")},2e3)},'Append "?" to model after 2s')),react.createElement("div",null,react.createElement("button",{onClick:()=>setTimeout(()=>{model.api.str([]).ins(0,"1. ")},2e3)},'Prepend "1. " to model after 2s')),react.createElement("div",null,react.createElement("button",{onClick:()=>{setTimeout(()=>{model.reset(clone)},2e3)}},"RESET after 2s")),react.createElement("div",null,react.createElement("button",{onClick:()=>{setTimeout(()=>{model.api.str([]).del(0,1)},2e3)}},"Delete model first char after 2s")),react.createElement("pre",{style:{fontSize:"10px"}},react.createElement("code",null,model.root+"")))},argTypes:{}},Primary={args:{src:"gl"}},__namedExportsOrder=["Primary"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  args: {\n    src: 'gl'\n  }\n}",...Primary.parameters?.docs?.source}}}}}]);