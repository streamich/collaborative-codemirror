/*! For license information please see 14.5c4ab0c0.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkcollaborative_codemirror=self.webpackChunkcollaborative_codemirror||[]).push([[14],{"./node_modules/@codemirror/view/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Lz:()=>EditorView});class Text{lineAt(pos){if(pos<0||pos>this.length)throw new RangeError(`Invalid position ${pos} in document of length ${this.length}`);return this.lineInner(pos,!1,1,0)}line(n){if(n<1||n>this.lines)throw new RangeError(`Invalid line number ${n} in ${this.lines}-line document`);return this.lineInner(n,!0,1,0)}replace(from,to,text){[from,to]=clip(this,from,to);let parts=[];return this.decompose(0,from,parts,2),text.length&&text.decompose(0,text.length,parts,3),this.decompose(to,this.length,parts,1),TextNode.from(parts,this.length-(to-from)+text.length)}append(other){return this.replace(this.length,this.length,other)}slice(from,to=this.length){[from,to]=clip(this,from,to);let parts=[];return this.decompose(from,to,parts,0),TextNode.from(parts,to-from)}eq(other){if(other==this)return!0;if(other.length!=this.length||other.lines!=this.lines)return!1;let start=this.scanIdentical(other,1),end=this.length-this.scanIdentical(other,-1),a=new RawTextCursor(this),b=new RawTextCursor(other);for(let skip=start,pos=start;;){if(a.next(skip),b.next(skip),skip=0,a.lineBreak!=b.lineBreak||a.done!=b.done||a.value!=b.value)return!1;if(pos+=a.value.length,a.done||pos>=end)return!0}}iter(dir=1){return new RawTextCursor(this,dir)}iterRange(from,to=this.length){return new PartialTextCursor(this,from,to)}iterLines(from,to){let inner;if(null==from)inner=this.iter();else{null==to&&(to=this.lines+1);let start=this.line(from).from;inner=this.iterRange(start,Math.max(start,to==this.lines+1?this.length:to<=1?0:this.line(to-1).to))}return new LineCursor(inner)}toString(){return this.sliceString(0)}toJSON(){let lines=[];return this.flatten(lines),lines}constructor(){}static of(text){if(0==text.length)throw new RangeError("A document must have at least one line");return 1!=text.length||text[0]?text.length<=32?new TextLeaf(text):TextNode.from(TextLeaf.split(text,[])):Text.empty}}class TextLeaf extends Text{constructor(text,length=function textLength(text){let length=-1;for(let line of text)length+=line.length+1;return length}(text)){super(),this.text=text,this.length=length}get lines(){return this.text.length}get children(){return null}lineInner(target,isLine,line,offset){for(let i=0;;i++){let string=this.text[i],end=offset+string.length;if((isLine?line:end)>=target)return new Line(offset,end,line,string);offset=end+1,line++}}decompose(from,to,target,open){let text=from<=0&&to>=this.length?this:new TextLeaf(sliceText(this.text,from,to),Math.min(to,this.length)-Math.max(0,from));if(1&open){let prev=target.pop(),joined=appendText(text.text,prev.text.slice(),0,text.length);if(joined.length<=32)target.push(new TextLeaf(joined,prev.length+text.length));else{let mid=joined.length>>1;target.push(new TextLeaf(joined.slice(0,mid)),new TextLeaf(joined.slice(mid)))}}else target.push(text)}replace(from,to,text){if(!(text instanceof TextLeaf))return super.replace(from,to,text);[from,to]=clip(this,from,to);let lines=appendText(this.text,appendText(text.text,sliceText(this.text,0,from)),to),newLen=this.length+text.length-(to-from);return lines.length<=32?new TextLeaf(lines,newLen):TextNode.from(TextLeaf.split(lines,[]),newLen)}sliceString(from,to=this.length,lineSep="\n"){[from,to]=clip(this,from,to);let result="";for(let pos=0,i=0;pos<=to&&i<this.text.length;i++){let line=this.text[i],end=pos+line.length;pos>from&&i&&(result+=lineSep),from<end&&to>pos&&(result+=line.slice(Math.max(0,from-pos),to-pos)),pos=end+1}return result}flatten(target){for(let line of this.text)target.push(line)}scanIdentical(){return 0}static split(text,target){let part=[],len=-1;for(let line of text)part.push(line),len+=line.length+1,32==part.length&&(target.push(new TextLeaf(part,len)),part=[],len=-1);return len>-1&&target.push(new TextLeaf(part,len)),target}}class TextNode extends Text{constructor(children,length){super(),this.children=children,this.length=length,this.lines=0;for(let child of children)this.lines+=child.lines}lineInner(target,isLine,line,offset){for(let i=0;;i++){let child=this.children[i],end=offset+child.length,endLine=line+child.lines-1;if((isLine?endLine:end)>=target)return child.lineInner(target,isLine,line,offset);offset=end+1,line=endLine+1}}decompose(from,to,target,open){for(let i=0,pos=0;pos<=to&&i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(from<=end&&to>=pos){let childOpen=open&((pos<=from?1:0)|(end>=to?2:0));pos>=from&&end<=to&&!childOpen?target.push(child):child.decompose(from-pos,to-pos,target,childOpen)}pos=end+1}}replace(from,to,text){if([from,to]=clip(this,from,to),text.lines<this.lines)for(let i=0,pos=0;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(from>=pos&&to<=end){let updated=child.replace(from-pos,to-pos,text),totalLines=this.lines-child.lines+updated.lines;if(updated.lines<totalLines>>4&&updated.lines>totalLines>>6){let copy=this.children.slice();return copy[i]=updated,new TextNode(copy,this.length-(to-from)+text.length)}return super.replace(pos,end,updated)}pos=end+1}return super.replace(from,to,text)}sliceString(from,to=this.length,lineSep="\n"){[from,to]=clip(this,from,to);let result="";for(let i=0,pos=0;i<this.children.length&&pos<=to;i++){let child=this.children[i],end=pos+child.length;pos>from&&i&&(result+=lineSep),from<end&&to>pos&&(result+=child.sliceString(from-pos,to-pos,lineSep)),pos=end+1}return result}flatten(target){for(let child of this.children)child.flatten(target)}scanIdentical(other,dir){if(!(other instanceof TextNode))return 0;let length=0,[iA,iB,eA,eB]=dir>0?[0,0,this.children.length,other.children.length]:[this.children.length-1,other.children.length-1,-1,-1];for(;;iA+=dir,iB+=dir){if(iA==eA||iB==eB)return length;let chA=this.children[iA],chB=other.children[iB];if(chA!=chB)return length+chA.scanIdentical(chB,dir);length+=chA.length+1}}static from(children,length=children.reduce(((l,ch)=>l+ch.length+1),-1)){let lines=0;for(let ch of children)lines+=ch.lines;if(lines<32){let flat=[];for(let ch of children)ch.flatten(flat);return new TextLeaf(flat,length)}let chunk=Math.max(32,lines>>5),maxChunk=chunk<<1,minChunk=chunk>>1,chunked=[],currentLines=0,currentLen=-1,currentChunk=[];function add(child){let last;if(child.lines>maxChunk&&child instanceof TextNode)for(let node of child.children)add(node);else child.lines>minChunk&&(currentLines>minChunk||!currentLines)?(flush(),chunked.push(child)):child instanceof TextLeaf&&currentLines&&(last=currentChunk[currentChunk.length-1])instanceof TextLeaf&&child.lines+last.lines<=32?(currentLines+=child.lines,currentLen+=child.length+1,currentChunk[currentChunk.length-1]=new TextLeaf(last.text.concat(child.text),last.length+1+child.length)):(currentLines+child.lines>chunk&&flush(),currentLines+=child.lines,currentLen+=child.length+1,currentChunk.push(child))}function flush(){0!=currentLines&&(chunked.push(1==currentChunk.length?currentChunk[0]:TextNode.from(currentChunk,currentLen)),currentLen=-1,currentLines=currentChunk.length=0)}for(let child of children)add(child);return flush(),1==chunked.length?chunked[0]:new TextNode(chunked,length)}}function appendText(text,target,from=0,to=1e9){for(let pos=0,i=0,first=!0;i<text.length&&pos<=to;i++){let line=text[i],end=pos+line.length;end>=from&&(end>to&&(line=line.slice(0,to-pos)),pos<from&&(line=line.slice(from-pos)),first?(target[target.length-1]+=line,first=!1):target.push(line)),pos=end+1}return target}function sliceText(text,from,to){return appendText(text,[""],from,to)}Text.empty=new TextLeaf([""],0);class RawTextCursor{constructor(text,dir=1){this.dir=dir,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[text],this.offsets=[dir>0?1:(text instanceof TextLeaf?text.text.length:text.children.length)<<1]}nextInner(skip,dir){for(this.done=this.lineBreak=!1;;){let last=this.nodes.length-1,top=this.nodes[last],offsetValue=this.offsets[last],offset=offsetValue>>1,size=top instanceof TextLeaf?top.text.length:top.children.length;if(offset==(dir>0?size:0)){if(0==last)return this.done=!0,this.value="",this;dir>0&&this.offsets[last-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&offsetValue)==(dir>0?0:1)){if(this.offsets[last]+=dir,0==skip)return this.lineBreak=!0,this.value="\n",this;skip--}else if(top instanceof TextLeaf){let next=top.text[offset+(dir<0?-1:0)];if(this.offsets[last]+=dir,next.length>Math.max(0,skip))return this.value=0==skip?next:dir>0?next.slice(skip):next.slice(0,next.length-skip),this;skip-=next.length}else{let next=top.children[offset+(dir<0?-1:0)];skip>next.length?(skip-=next.length,this.offsets[last]+=dir):(dir<0&&this.offsets[last]--,this.nodes.push(next),this.offsets.push(dir>0?1:(next instanceof TextLeaf?next.text.length:next.children.length)<<1))}}}next(skip=0){return skip<0&&(this.nextInner(-skip,-this.dir),skip=this.value.length),this.nextInner(skip,this.dir)}}class PartialTextCursor{constructor(text,start,end){this.value="",this.done=!1,this.cursor=new RawTextCursor(text,start>end?-1:1),this.pos=start>end?text.length:0,this.from=Math.min(start,end),this.to=Math.max(start,end)}nextInner(skip,dir){if(dir<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;skip+=Math.max(0,dir<0?this.pos-this.to:this.from-this.pos);let limit=dir<0?this.pos-this.from:this.to-this.pos;skip>limit&&(skip=limit),limit-=skip;let{value}=this.cursor.next(skip);return this.pos+=(value.length+skip)*dir,this.value=value.length<=limit?value:dir<0?value.slice(value.length-limit):value.slice(0,limit),this.done=!this.value,this}next(skip=0){return skip<0?skip=Math.max(skip,this.from-this.pos):skip>0&&(skip=Math.min(skip,this.to-this.pos)),this.nextInner(skip,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class LineCursor{constructor(inner){this.inner=inner,this.afterBreak=!0,this.value="",this.done=!1}next(skip=0){let{done,lineBreak,value}=this.inner.next(skip);return done&&this.afterBreak?(this.value="",this.afterBreak=!1):done?(this.done=!0,this.value=""):lineBreak?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=value,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(from,to,number,text){this.from=from,this.to=to,this.number=number,this.text=text}get length(){return this.to-this.from}}function clip(text,from,to){return[from=Math.max(0,Math.min(text.length,from)),Math.max(from,Math.min(text.length,to))]}let extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((s=>s?parseInt(s,36):1));for(let i=1;i<extend.length;i++)extend[i]+=extend[i-1];function isExtendingChar(code){for(let i=1;i<extend.length;i+=2)if(extend[i]>code)return extend[i-1]<=code;return!1}function isRegionalIndicator(code){return code>=127462&&code<=127487}const ZWJ=8205;function findClusterBreak(str,pos,forward=!0,includeExtending=!0){return(forward?nextClusterBreak:prevClusterBreak)(str,pos,includeExtending)}function nextClusterBreak(str,pos,includeExtending){if(pos==str.length)return pos;pos&&surrogateLow(str.charCodeAt(pos))&&surrogateHigh(str.charCodeAt(pos-1))&&pos--;let prev=dist_codePointAt(str,pos);for(pos+=codePointSize(prev);pos<str.length;){let next=dist_codePointAt(str,pos);if(prev==ZWJ||next==ZWJ||includeExtending&&isExtendingChar(next))pos+=codePointSize(next),prev=next;else{if(!isRegionalIndicator(next))break;{let countBefore=0,i=pos-2;for(;i>=0&&isRegionalIndicator(dist_codePointAt(str,i));)countBefore++,i-=2;if(countBefore%2==0)break;pos+=2}}}return pos}function prevClusterBreak(str,pos,includeExtending){for(;pos>0;){let found=nextClusterBreak(str,pos-2,includeExtending);if(found<pos)return found;pos--}return 0}function surrogateLow(ch){return ch>=56320&&ch<57344}function surrogateHigh(ch){return ch>=55296&&ch<56320}function dist_codePointAt(str,pos){let code0=str.charCodeAt(pos);if(!surrogateHigh(code0)||pos+1==str.length)return code0;let code1=str.charCodeAt(pos+1);return surrogateLow(code1)?code1-56320+(code0-55296<<10)+65536:code0}function codePointSize(code){return code<65536?1:2}const DefaultSplit=/\r\n?|\n/;var dist_MapMode=function(MapMode){return MapMode[MapMode.Simple=0]="Simple",MapMode[MapMode.TrackDel=1]="TrackDel",MapMode[MapMode.TrackBefore=2]="TrackBefore",MapMode[MapMode.TrackAfter=3]="TrackAfter",MapMode}(dist_MapMode||(dist_MapMode={}));class ChangeDesc{constructor(sections){this.sections=sections}get length(){let result=0;for(let i=0;i<this.sections.length;i+=2)result+=this.sections[i];return result}get newLength(){let result=0;for(let i=0;i<this.sections.length;i+=2){let ins=this.sections[i+1];result+=ins<0?this.sections[i]:ins}return result}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(f){for(let i=0,posA=0,posB=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];ins<0?(f(posA,posB,len),posB+=len):posB+=ins,posA+=len}}iterChangedRanges(f,individual=!1){iterChanges(this,f,individual)}get invertedDesc(){let sections=[];for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];ins<0?sections.push(len,ins):sections.push(ins,len)}return new ChangeDesc(sections)}composeDesc(other){return this.empty?other:other.empty?this:composeSets(this,other)}mapDesc(other,before=!1){return other.empty?this:mapSet(this,other,before)}mapPos(pos,assoc=-1,mode=dist_MapMode.Simple){let posA=0,posB=0;for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++],endA=posA+len;if(ins<0){if(endA>pos)return posB+(pos-posA);posB+=len}else{if(mode!=dist_MapMode.Simple&&endA>=pos&&(mode==dist_MapMode.TrackDel&&posA<pos&&endA>pos||mode==dist_MapMode.TrackBefore&&posA<pos||mode==dist_MapMode.TrackAfter&&endA>pos))return null;if(endA>pos||endA==pos&&assoc<0&&!len)return pos==posA||assoc<0?posB:posB+ins;posB+=ins}posA=endA}if(pos>posA)throw new RangeError(`Position ${pos} is out of range for changeset of length ${posA}`);return posB}touchesRange(from,to=from){for(let i=0,pos=0;i<this.sections.length&&pos<=to;){let end=pos+this.sections[i++];if(this.sections[i++]>=0&&pos<=to&&end>=from)return!(pos<from&&end>to)||"cover";pos=end}return!1}toString(){let result="";for(let i=0;i<this.sections.length;){let len=this.sections[i++],ins=this.sections[i++];result+=(result?" ":"")+len+(ins>=0?":"+ins:"")}return result}toJSON(){return this.sections}static fromJSON(json){if(!Array.isArray(json)||json.length%2||json.some((a=>"number"!=typeof a)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(json)}static create(sections){return new ChangeDesc(sections)}}class ChangeSet extends ChangeDesc{constructor(sections,inserted){super(sections),this.inserted=inserted}apply(doc){if(this.length!=doc.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,((fromA,toA,fromB,_toB,text)=>doc=doc.replace(fromB,fromB+(toA-fromA),text)),!1),doc}mapDesc(other,before=!1){return mapSet(this,other,before,!0)}invert(doc){let sections=this.sections.slice(),inserted=[];for(let i=0,pos=0;i<sections.length;i+=2){let len=sections[i],ins=sections[i+1];if(ins>=0){sections[i]=ins,sections[i+1]=len;let index=i>>1;for(;inserted.length<index;)inserted.push(Text.empty);inserted.push(len?doc.slice(pos,pos+len):Text.empty)}pos+=len}return new ChangeSet(sections,inserted)}compose(other){return this.empty?other:other.empty?this:composeSets(this,other,!0)}map(other,before=!1){return other.empty?this:mapSet(this,other,before,!0)}iterChanges(f,individual=!1){iterChanges(this,f,individual)}get desc(){return ChangeDesc.create(this.sections)}filter(ranges){let resultSections=[],resultInserted=[],filteredSections=[],iter=new SectionIter(this);done:for(let i=0,pos=0;;){let next=i==ranges.length?1e9:ranges[i++];for(;pos<next||pos==next&&0==iter.len;){if(iter.done)break done;let len=Math.min(iter.len,next-pos);addSection(filteredSections,len,-1);let ins=-1==iter.ins?-1:0==iter.off?iter.ins:0;addSection(resultSections,len,ins),ins>0&&addInsert(resultInserted,resultSections,iter.text),iter.forward(len),pos+=len}let end=ranges[i++];for(;pos<end;){if(iter.done)break done;let len=Math.min(iter.len,end-pos);addSection(resultSections,len,-1),addSection(filteredSections,len,-1==iter.ins?-1:0==iter.off?iter.ins:0),iter.forward(len),pos+=len}}return{changes:new ChangeSet(resultSections,resultInserted),filtered:ChangeDesc.create(filteredSections)}}toJSON(){let parts=[];for(let i=0;i<this.sections.length;i+=2){let len=this.sections[i],ins=this.sections[i+1];ins<0?parts.push(len):0==ins?parts.push([len]):parts.push([len].concat(this.inserted[i>>1].toJSON()))}return parts}static of(changes,length,lineSep){let sections=[],inserted=[],pos=0,total=null;function flush(force=!1){if(!force&&!sections.length)return;pos<length&&addSection(sections,length-pos,-1);let set=new ChangeSet(sections,inserted);total=total?total.compose(set.map(total)):set,sections=[],inserted=[],pos=0}return function process(spec){if(Array.isArray(spec))for(let sub of spec)process(sub);else if(spec instanceof ChangeSet){if(spec.length!=length)throw new RangeError(`Mismatched change set length (got ${spec.length}, expected ${length})`);flush(),total=total?total.compose(spec.map(total)):spec}else{let{from,to=from,insert}=spec;if(from>to||from<0||to>length)throw new RangeError(`Invalid change range ${from} to ${to} (in doc of length ${length})`);let insText=insert?"string"==typeof insert?Text.of(insert.split(lineSep||DefaultSplit)):insert:Text.empty,insLen=insText.length;if(from==to&&0==insLen)return;from<pos&&flush(),from>pos&&addSection(sections,from-pos,-1),addSection(sections,to-from,insLen),addInsert(inserted,sections,insText),pos=to}}(changes),flush(!total),total}static empty(length){return new ChangeSet(length?[length,-1]:[],[])}static fromJSON(json){if(!Array.isArray(json))throw new RangeError("Invalid JSON representation of ChangeSet");let sections=[],inserted=[];for(let i=0;i<json.length;i++){let part=json[i];if("number"==typeof part)sections.push(part,-1);else{if(!Array.isArray(part)||"number"!=typeof part[0]||part.some(((e,i)=>i&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==part.length)sections.push(part[0],0);else{for(;inserted.length<i;)inserted.push(Text.empty);inserted[i]=Text.of(part.slice(1)),sections.push(part[0],inserted[i].length)}}}return new ChangeSet(sections,inserted)}static createSet(sections,inserted){return new ChangeSet(sections,inserted)}}function addSection(sections,len,ins,forceJoin=!1){if(0==len&&ins<=0)return;let last=sections.length-2;last>=0&&ins<=0&&ins==sections[last+1]?sections[last]+=len:0==len&&0==sections[last]?sections[last+1]+=ins:forceJoin?(sections[last]+=len,sections[last+1]+=ins):sections.push(len,ins)}function addInsert(values,sections,value){if(0==value.length)return;let index=sections.length-2>>1;if(index<values.length)values[values.length-1]=values[values.length-1].append(value);else{for(;values.length<index;)values.push(Text.empty);values.push(value)}}function iterChanges(desc,f,individual){let inserted=desc.inserted;for(let posA=0,posB=0,i=0;i<desc.sections.length;){let len=desc.sections[i++],ins=desc.sections[i++];if(ins<0)posA+=len,posB+=len;else{let endA=posA,endB=posB,text=Text.empty;for(;endA+=len,endB+=ins,ins&&inserted&&(text=text.append(inserted[i-2>>1])),!(individual||i==desc.sections.length||desc.sections[i+1]<0);)len=desc.sections[i++],ins=desc.sections[i++];f(posA,endA,posB,endB,text),posA=endA,posB=endB}}}function mapSet(setA,setB,before,mkSet=!1){let sections=[],insert=mkSet?[]:null,a=new SectionIter(setA),b=new SectionIter(setB);for(let inserted=-1;;)if(-1==a.ins&&-1==b.ins){let len=Math.min(a.len,b.len);addSection(sections,len,-1),a.forward(len),b.forward(len)}else if(b.ins>=0&&(a.ins<0||inserted==a.i||0==a.off&&(b.len<a.len||b.len==a.len&&!before))){let len=b.len;for(addSection(sections,b.ins,-1);len;){let piece=Math.min(a.len,len);a.ins>=0&&inserted<a.i&&a.len<=piece&&(addSection(sections,0,a.ins),insert&&addInsert(insert,sections,a.text),inserted=a.i),a.forward(piece),len-=piece}b.next()}else{if(!(a.ins>=0)){if(a.done&&b.done)return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections);throw new Error("Mismatched change set lengths")}{let len=0,left=a.len;for(;left;)if(-1==b.ins){let piece=Math.min(left,b.len);len+=piece,left-=piece,b.forward(piece)}else{if(!(0==b.ins&&b.len<left))break;left-=b.len,b.next()}addSection(sections,len,inserted<a.i?a.ins:0),insert&&inserted<a.i&&addInsert(insert,sections,a.text),inserted=a.i,a.forward(a.len-left)}}}function composeSets(setA,setB,mkSet=!1){let sections=[],insert=mkSet?[]:null,a=new SectionIter(setA),b=new SectionIter(setB);for(let open=!1;;){if(a.done&&b.done)return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections);if(0==a.ins)addSection(sections,a.len,0,open),a.next();else if(0!=b.len||b.done){if(a.done||b.done)throw new Error("Mismatched change set lengths");{let len=Math.min(a.len2,b.len),sectionLen=sections.length;if(-1==a.ins){let insB=-1==b.ins?-1:b.off?0:b.ins;addSection(sections,len,insB,open),insert&&insB&&addInsert(insert,sections,b.text)}else-1==b.ins?(addSection(sections,a.off?0:a.len,len,open),insert&&addInsert(insert,sections,a.textBit(len))):(addSection(sections,a.off?0:a.len,b.off?0:b.ins,open),insert&&!b.off&&addInsert(insert,sections,b.text));open=(a.ins>len||b.ins>=0&&b.len>len)&&(open||sections.length>sectionLen),a.forward2(len),b.forward(len)}}else addSection(sections,0,b.ins,open),insert&&addInsert(insert,sections,b.text),b.next()}}class SectionIter{constructor(set){this.set=set,this.i=0,this.next()}next(){let{sections}=this.set;this.i<sections.length?(this.len=sections[this.i++],this.ins=sections[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted}=this.set,index=this.i-2>>1;return index>=inserted.length?Text.empty:inserted[index]}textBit(len){let{inserted}=this.set,index=this.i-2>>1;return index>=inserted.length&&!len?Text.empty:inserted[index].slice(this.off,null==len?void 0:this.off+len)}forward(len){len==this.len?this.next():(this.len-=len,this.off+=len)}forward2(len){-1==this.ins?this.forward(len):len==this.ins?this.next():(this.ins-=len,this.off+=len)}}class SelectionRange{constructor(from,to,flags){this.from=from,this.to=to,this.flags=flags}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let level=7&this.flags;return 7==level?null:level}get goalColumn(){let value=this.flags>>6;return 16777215==value?void 0:value}map(change,assoc=-1){let from,to;return this.empty?from=to=change.mapPos(this.from,assoc):(from=change.mapPos(this.from,1),to=change.mapPos(this.to,-1)),from==this.from&&to==this.to?this:new SelectionRange(from,to,this.flags)}extend(from,to=from){if(from<=this.anchor&&to>=this.anchor)return dist_EditorSelection.range(from,to);let head=Math.abs(from-this.anchor)>Math.abs(to-this.anchor)?from:to;return dist_EditorSelection.range(this.anchor,head)}eq(other,includeAssoc=!1){return!(this.anchor!=other.anchor||this.head!=other.head||includeAssoc&&this.empty&&this.assoc!=other.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(json){if(!json||"number"!=typeof json.anchor||"number"!=typeof json.head)throw new RangeError("Invalid JSON representation for SelectionRange");return dist_EditorSelection.range(json.anchor,json.head)}static create(from,to,flags){return new SelectionRange(from,to,flags)}}class dist_EditorSelection{constructor(ranges,mainIndex){this.ranges=ranges,this.mainIndex=mainIndex}map(change,assoc=-1){return change.empty?this:dist_EditorSelection.create(this.ranges.map((r=>r.map(change,assoc))),this.mainIndex)}eq(other,includeAssoc=!1){if(this.ranges.length!=other.ranges.length||this.mainIndex!=other.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(other.ranges[i],includeAssoc))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new dist_EditorSelection([this.main],0)}addRange(range,main=!0){return dist_EditorSelection.create([range].concat(this.ranges),main?0:this.mainIndex+1)}replaceRange(range,which=this.mainIndex){let ranges=this.ranges.slice();return ranges[which]=range,dist_EditorSelection.create(ranges,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((r=>r.toJSON())),main:this.mainIndex}}static fromJSON(json){if(!json||!Array.isArray(json.ranges)||"number"!=typeof json.main||json.main>=json.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new dist_EditorSelection(json.ranges.map((r=>SelectionRange.fromJSON(r))),json.main)}static single(anchor,head=anchor){return new dist_EditorSelection([dist_EditorSelection.range(anchor,head)],0)}static create(ranges,mainIndex=0){if(0==ranges.length)throw new RangeError("A selection needs at least one range");for(let pos=0,i=0;i<ranges.length;i++){let range=ranges[i];if(range.empty?range.from<=pos:range.from<pos)return dist_EditorSelection.normalized(ranges.slice(),mainIndex);pos=range.to}return new dist_EditorSelection(ranges,mainIndex)}static cursor(pos,assoc=0,bidiLevel,goalColumn){return SelectionRange.create(pos,pos,(0==assoc?0:assoc<0?8:16)|(null==bidiLevel?7:Math.min(6,bidiLevel))|(null!=goalColumn?goalColumn:16777215)<<6)}static range(anchor,head,goalColumn,bidiLevel){let flags=(null!=goalColumn?goalColumn:16777215)<<6|(null==bidiLevel?7:Math.min(6,bidiLevel));return head<anchor?SelectionRange.create(head,anchor,48|flags):SelectionRange.create(anchor,head,(head>anchor?8:0)|flags)}static normalized(ranges,mainIndex=0){let main=ranges[mainIndex];ranges.sort(((a,b)=>a.from-b.from)),mainIndex=ranges.indexOf(main);for(let i=1;i<ranges.length;i++){let range=ranges[i],prev=ranges[i-1];if(range.empty?range.from<=prev.to:range.from<prev.to){let from=prev.from,to=Math.max(range.to,prev.to);i<=mainIndex&&mainIndex--,ranges.splice(--i,2,range.anchor>range.head?dist_EditorSelection.range(to,from):dist_EditorSelection.range(from,to))}}return new dist_EditorSelection(ranges,mainIndex)}}function checkSelection(selection,docLength){for(let range of selection.ranges)if(range.to>docLength)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(combine,compareInput,compare,isStatic,enables){this.combine=combine,this.compareInput=compareInput,this.compare=compare,this.isStatic=isStatic,this.id=nextID++,this.default=combine([]),this.extensions="function"==typeof enables?enables(this):enables}get reader(){return this}static define(config={}){return new Facet(config.combine||(a=>a),config.compareInput||((a,b)=>a===b),config.compare||(config.combine?(a,b)=>a===b:sameArray),!!config.static,config.enables)}of(value){return new FacetProvider([],this,0,value)}compute(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,1,get)}computeN(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,2,get)}from(field,get){return get||(get=x=>x),this.compute([field],(state=>get(state.field(field))))}}function sameArray(a,b){return a==b||a.length==b.length&&a.every(((e,i)=>e===b[i]))}class FacetProvider{constructor(dependencies,facet,type,value){this.dependencies=dependencies,this.facet=facet,this.type=type,this.value=value,this.id=nextID++}dynamicSlot(addresses){var _a;let getter=this.value,compare=this.facet.compareInput,id=this.id,idx=addresses[id]>>1,multi=2==this.type,depDoc=!1,depSel=!1,depAddrs=[];for(let dep of this.dependencies)"doc"==dep?depDoc=!0:"selection"==dep?depSel=!0:1&(null!==(_a=addresses[dep.id])&&void 0!==_a?_a:1)||depAddrs.push(addresses[dep.id]);return{create:state=>(state.values[idx]=getter(state),1),update(state,tr){if(depDoc&&tr.docChanged||depSel&&(tr.docChanged||tr.selection)||ensureAll(state,depAddrs)){let newVal=getter(state);if(multi?!compareArray(newVal,state.values[idx],compare):!compare(newVal,state.values[idx]))return state.values[idx]=newVal,1}return 0},reconfigure:(state,oldState)=>{let newVal,oldAddr=oldState.config.address[id];if(null!=oldAddr){let oldVal=getAddr(oldState,oldAddr);if(this.dependencies.every((dep=>dep instanceof Facet?oldState.facet(dep)===state.facet(dep):!(dep instanceof dist_StateField)||oldState.field(dep,!1)==state.field(dep,!1)))||(multi?compareArray(newVal=getter(state),oldVal,compare):compare(newVal=getter(state),oldVal)))return state.values[idx]=oldVal,0}else newVal=getter(state);return state.values[idx]=newVal,1}}}}function compareArray(a,b,compare){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compare(a[i],b[i]))return!1;return!0}function ensureAll(state,addrs){let changed=!1;for(let addr of addrs)1&ensureAddr(state,addr)&&(changed=!0);return changed}function dynamicFacetSlot(addresses,facet,providers){let providerAddrs=providers.map((p=>addresses[p.id])),providerTypes=providers.map((p=>p.type)),dynamic=providerAddrs.filter((p=>!(1&p))),idx=addresses[facet.id]>>1;function get(state){let values=[];for(let i=0;i<providerAddrs.length;i++){let value=getAddr(state,providerAddrs[i]);if(2==providerTypes[i])for(let val of value)values.push(val);else values.push(value)}return facet.combine(values)}return{create(state){for(let addr of providerAddrs)ensureAddr(state,addr);return state.values[idx]=get(state),1},update(state,tr){if(!ensureAll(state,dynamic))return 0;let value=get(state);return facet.compare(value,state.values[idx])?0:(state.values[idx]=value,1)},reconfigure(state,oldState){let depChanged=ensureAll(state,providerAddrs),oldProviders=oldState.config.facets[facet.id],oldValue=oldState.facet(facet);if(oldProviders&&!depChanged&&sameArray(providers,oldProviders))return state.values[idx]=oldValue,0;let value=get(state);return facet.compare(value,oldValue)?(state.values[idx]=oldValue,0):(state.values[idx]=value,1)}}}const initField=Facet.define({static:!0});class dist_StateField{constructor(id,createF,updateF,compareF,spec){this.id=id,this.createF=createF,this.updateF=updateF,this.compareF=compareF,this.spec=spec,this.provides=void 0}static define(config){let field=new dist_StateField(nextID++,config.create,config.update,config.compare||((a,b)=>a===b),config);return config.provide&&(field.provides=config.provide(field)),field}create(state){let init=state.facet(initField).find((i=>i.field==this));return((null==init?void 0:init.create)||this.createF)(state)}slot(addresses){let idx=addresses[this.id]>>1;return{create:state=>(state.values[idx]=this.create(state),1),update:(state,tr)=>{let oldVal=state.values[idx],value=this.updateF(oldVal,tr);return this.compareF(oldVal,value)?0:(state.values[idx]=value,1)},reconfigure:(state,oldState)=>null!=oldState.config.address[this.id]?(state.values[idx]=oldState.field(this),0):(state.values[idx]=this.create(state),1)}}init(create){return[this,initField.of({field:this,create})]}get extension(){return this}}const Prec__lowest=4,Prec__low=3,Prec__default=2,Prec__high=1;function prec(value){return ext=>new PrecExtension(ext,value)}const dist_Prec={highest:prec(0),high:prec(Prec__high),default:prec(Prec__default),low:prec(Prec__low),lowest:prec(Prec__lowest)};class PrecExtension{constructor(inner,prec){this.inner=inner,this.prec=prec}}class Compartment{of(ext){return new CompartmentInstance(this,ext)}reconfigure(content){return Compartment.reconfigure.of({compartment:this,extension:content})}get(state){return state.config.compartments.get(this)}}class CompartmentInstance{constructor(compartment,inner){this.compartment=compartment,this.inner=inner}}class Configuration{constructor(base,compartments,dynamicSlots,address,staticValues,facets){for(this.base=base,this.compartments=compartments,this.dynamicSlots=dynamicSlots,this.address=address,this.staticValues=staticValues,this.facets=facets,this.statusTemplate=[];this.statusTemplate.length<dynamicSlots.length;)this.statusTemplate.push(0)}staticFacet(facet){let addr=this.address[facet.id];return null==addr?facet.default:this.staticValues[addr>>1]}static resolve(base,compartments,oldState){let fields=[],facets=Object.create(null),newCompartments=new Map;for(let ext of function flatten(extension,compartments,newCompartments){let result=[[],[],[],[],[]],seen=new Map;function inner(ext,prec){let known=seen.get(ext);if(null!=known){if(known<=prec)return;let found=result[known].indexOf(ext);found>-1&&result[known].splice(found,1),ext instanceof CompartmentInstance&&newCompartments.delete(ext.compartment)}if(seen.set(ext,prec),Array.isArray(ext))for(let e of ext)inner(e,prec);else if(ext instanceof CompartmentInstance){if(newCompartments.has(ext.compartment))throw new RangeError("Duplicate use of compartment in extensions");let content=compartments.get(ext.compartment)||ext.inner;newCompartments.set(ext.compartment,content),inner(content,prec)}else if(ext instanceof PrecExtension)inner(ext.inner,ext.prec);else if(ext instanceof dist_StateField)result[prec].push(ext),ext.provides&&inner(ext.provides,prec);else if(ext instanceof FacetProvider)result[prec].push(ext),ext.facet.extensions&&inner(ext.facet.extensions,Prec__default);else{let content=ext.extension;if(!content)throw new Error(`Unrecognized extension value in extension set (${ext}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);inner(content,prec)}}return inner(extension,Prec__default),result.reduce(((a,b)=>a.concat(b)))}(base,compartments,newCompartments))ext instanceof dist_StateField?fields.push(ext):(facets[ext.facet.id]||(facets[ext.facet.id]=[])).push(ext);let address=Object.create(null),staticValues=[],dynamicSlots=[];for(let field of fields)address[field.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>field.slot(a)));let oldFacets=null==oldState?void 0:oldState.config.facets;for(let id in facets){let providers=facets[id],facet=providers[0].facet,oldProviders=oldFacets&&oldFacets[id]||[];if(providers.every((p=>0==p.type)))if(address[facet.id]=staticValues.length<<1|1,sameArray(oldProviders,providers))staticValues.push(oldState.facet(facet));else{let value=facet.combine(providers.map((p=>p.value)));staticValues.push(oldState&&facet.compare(value,oldState.facet(facet))?oldState.facet(facet):value)}else{for(let p of providers)0==p.type?(address[p.id]=staticValues.length<<1|1,staticValues.push(p.value)):(address[p.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>p.dynamicSlot(a))));address[facet.id]=dynamicSlots.length<<1,dynamicSlots.push((a=>dynamicFacetSlot(a,facet,providers)))}}let dynamic=dynamicSlots.map((f=>f(address)));return new Configuration(base,newCompartments,dynamic,address,staticValues,facets)}}function ensureAddr(state,addr){if(1&addr)return 2;let idx=addr>>1,status=state.status[idx];if(4==status)throw new Error("Cyclic dependency between fields and/or facets");if(2&status)return status;state.status[idx]=4;let changed=state.computeSlot(state,state.config.dynamicSlots[idx]);return state.status[idx]=2|changed}function getAddr(state,addr){return 1&addr?state.config.staticValues[addr>>1]:state.values[addr>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:values=>values.some((v=>v)),static:!0}),lineSeparator=Facet.define({combine:values=>values.length?values[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:values=>!!values.length&&values[0]});class Annotation{constructor(type,value){this.type=type,this.value=value}static define(){return new AnnotationType}}class AnnotationType{of(value){return new Annotation(this,value)}}class StateEffectType{constructor(map){this.map=map}of(value){return new dist_StateEffect(this,value)}}class dist_StateEffect{constructor(type,value){this.type=type,this.value=value}map(mapping){let mapped=this.type.map(this.value,mapping);return void 0===mapped?void 0:mapped==this.value?this:new dist_StateEffect(this.type,mapped)}is(type){return this.type==type}static define(spec={}){return new StateEffectType(spec.map||(v=>v))}static mapEffects(effects,mapping){if(!effects.length)return effects;let result=[];for(let effect of effects){let mapped=effect.map(mapping);mapped&&result.push(mapped)}return result}}dist_StateEffect.reconfigure=dist_StateEffect.define(),dist_StateEffect.appendConfig=dist_StateEffect.define();class Transaction{constructor(startState,changes,selection,effects,annotations,scrollIntoView){this.startState=startState,this.changes=changes,this.selection=selection,this.effects=effects,this.annotations=annotations,this.scrollIntoView=scrollIntoView,this._doc=null,this._state=null,selection&&checkSelection(selection,changes.newLength),annotations.some((a=>a.type==Transaction.time))||(this.annotations=annotations.concat(Transaction.time.of(Date.now())))}static create(startState,changes,selection,effects,annotations,scrollIntoView){return new Transaction(startState,changes,selection,effects,annotations,scrollIntoView)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(type){for(let ann of this.annotations)if(ann.type==type)return ann.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(event){let e=this.annotation(Transaction.userEvent);return!(!e||!(e==event||e.length>event.length&&e.slice(0,event.length)==event&&"."==e[event.length]))}}function joinRanges(a,b){let result=[];for(let iA=0,iB=0;;){let from,to;if(iA<a.length&&(iB==b.length||b[iB]>=a[iA]))from=a[iA++],to=a[iA++];else{if(!(iB<b.length))return result;from=b[iB++],to=b[iB++]}!result.length||result[result.length-1]<from?result.push(from,to):result[result.length-1]<to&&(result[result.length-1]=to)}}function mergeTransaction(a,b,sequential){var _a;let mapForA,mapForB,changes;return sequential?(mapForA=b.changes,mapForB=ChangeSet.empty(b.changes.length),changes=a.changes.compose(b.changes)):(mapForA=b.changes.map(a.changes),mapForB=a.changes.mapDesc(b.changes,!0),changes=a.changes.compose(mapForA)),{changes,selection:b.selection?b.selection.map(mapForB):null===(_a=a.selection)||void 0===_a?void 0:_a.map(mapForA),effects:dist_StateEffect.mapEffects(a.effects,mapForA).concat(dist_StateEffect.mapEffects(b.effects,mapForB)),annotations:a.annotations.length?a.annotations.concat(b.annotations):b.annotations,scrollIntoView:a.scrollIntoView||b.scrollIntoView}}function resolveTransactionInner(state,spec,docSize){let sel=spec.selection,annotations=asArray(spec.annotations);return spec.userEvent&&(annotations=annotations.concat(Transaction.userEvent.of(spec.userEvent))),{changes:spec.changes instanceof ChangeSet?spec.changes:ChangeSet.of(spec.changes||[],docSize,state.facet(lineSeparator)),selection:sel&&(sel instanceof dist_EditorSelection?sel:dist_EditorSelection.single(sel.anchor,sel.head)),effects:asArray(spec.effects),annotations,scrollIntoView:!!spec.scrollIntoView}}function resolveTransaction(state,specs,filter){let s=resolveTransactionInner(state,specs.length?specs[0]:{},state.doc.length);specs.length&&!1===specs[0].filter&&(filter=!1);for(let i=1;i<specs.length;i++){!1===specs[i].filter&&(filter=!1);let seq=!!specs[i].sequential;s=mergeTransaction(s,resolveTransactionInner(state,specs[i],seq?s.changes.newLength:state.doc.length),seq)}let tr=Transaction.create(state,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function extendTransaction(tr){let state=tr.startState,extenders=state.facet(transactionExtender),spec=tr;for(let i=extenders.length-1;i>=0;i--){let extension=extenders[i](tr);extension&&Object.keys(extension).length&&(spec=mergeTransaction(spec,resolveTransactionInner(state,extension,tr.changes.newLength),!0))}return spec==tr?tr:Transaction.create(state,tr.changes,tr.selection,spec.effects,spec.annotations,spec.scrollIntoView)}(filter?function filterTransaction(tr){let state=tr.startState,result=!0;for(let filter of state.facet(changeFilter)){let value=filter(tr);if(!1===value){result=!1;break}Array.isArray(value)&&(result=!0===result?value:joinRanges(result,value))}if(!0!==result){let changes,back;if(!1===result)back=tr.changes.invertedDesc,changes=ChangeSet.empty(state.doc.length);else{let filtered=tr.changes.filter(result);changes=filtered.changes,back=filtered.filtered.mapDesc(filtered.changes).invertedDesc}tr=Transaction.create(state,changes,tr.selection&&tr.selection.map(back),dist_StateEffect.mapEffects(tr.effects,back),tr.annotations,tr.scrollIntoView)}let filters=state.facet(transactionFilter);for(let i=filters.length-1;i>=0;i--){let filtered=filters[i](tr);tr=filtered instanceof Transaction?filtered:Array.isArray(filtered)&&1==filtered.length&&filtered[0]instanceof Transaction?filtered[0]:resolveTransaction(state,asArray(filtered),!1)}return tr}(tr):tr)}Transaction.time=Annotation.define(),Transaction.userEvent=Annotation.define(),Transaction.addToHistory=Annotation.define(),Transaction.remote=Annotation.define();const none=[];function asArray(value){return null==value?none:Array.isArray(value)?value:[value]}var CharCategory=function(CharCategory){return CharCategory[CharCategory.Word=0]="Word",CharCategory[CharCategory.Space=1]="Space",CharCategory[CharCategory.Other=2]="Other",CharCategory}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_){}function makeCategorizer(wordChars){return char=>{if(!/\S/.test(char))return CharCategory.Space;if(function hasWordChar(str){if(wordChar)return wordChar.test(str);for(let i=0;i<str.length;i++){let ch=str[i];if(/\w/.test(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch)))return!0}return!1}(char))return CharCategory.Word;for(let i=0;i<wordChars.length;i++)if(char.indexOf(wordChars[i])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(config,doc,selection,values,computeSlot,tr){this.config=config,this.doc=doc,this.selection=selection,this.values=values,this.status=config.statusTemplate.slice(),this.computeSlot=computeSlot,tr&&(tr._state=this);for(let i=0;i<this.config.dynamicSlots.length;i++)ensureAddr(this,i<<1);this.computeSlot=null}field(field,require=!0){let addr=this.config.address[field.id];if(null!=addr)return ensureAddr(this,addr),getAddr(this,addr);if(require)throw new RangeError("Field is not present in this state")}update(...specs){return resolveTransaction(this,specs,!0)}applyTransaction(tr){let startValues,conf=this.config,{base,compartments}=conf;for(let effect of tr.effects)effect.is(Compartment.reconfigure)?(conf&&(compartments=new Map,conf.compartments.forEach(((val,key)=>compartments.set(key,val))),conf=null),compartments.set(effect.value.compartment,effect.value.extension)):effect.is(dist_StateEffect.reconfigure)?(conf=null,base=effect.value):effect.is(dist_StateEffect.appendConfig)&&(conf=null,base=asArray(base).concat(effect.value));if(conf)startValues=tr.startState.values.slice();else{conf=Configuration.resolve(base,compartments,this),startValues=new EditorState(conf,this.doc,this.selection,conf.dynamicSlots.map((()=>null)),((state,slot)=>slot.reconfigure(state,this)),null).values}let selection=tr.startState.facet(allowMultipleSelections)?tr.newSelection:tr.newSelection.asSingle();new EditorState(conf,tr.newDoc,selection,startValues,((state,slot)=>slot.update(state,tr)),tr)}replaceSelection(text){return"string"==typeof text&&(text=this.toText(text)),this.changeByRange((range=>({changes:{from:range.from,to:range.to,insert:text},range:dist_EditorSelection.cursor(range.from+text.length)})))}changeByRange(f){let sel=this.selection,result1=f(sel.ranges[0]),changes=this.changes(result1.changes),ranges=[result1.range],effects=asArray(result1.effects);for(let i=1;i<sel.ranges.length;i++){let result=f(sel.ranges[i]),newChanges=this.changes(result.changes),newMapped=newChanges.map(changes);for(let j=0;j<i;j++)ranges[j]=ranges[j].map(newMapped);let mapBy=changes.mapDesc(newChanges,!0);ranges.push(result.range.map(mapBy)),changes=changes.compose(newMapped),effects=dist_StateEffect.mapEffects(effects,newMapped).concat(dist_StateEffect.mapEffects(asArray(result.effects),mapBy))}return{changes,selection:dist_EditorSelection.create(ranges,sel.mainIndex),effects}}changes(spec=[]){return spec instanceof ChangeSet?spec:ChangeSet.of(spec,this.doc.length,this.facet(EditorState.lineSeparator))}toText(string){return Text.of(string.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(from=0,to=this.doc.length){return this.doc.sliceString(from,to,this.lineBreak)}facet(facet){let addr=this.config.address[facet.id];return null==addr?facet.default:(ensureAddr(this,addr),getAddr(this,addr))}toJSON(fields){let result={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(fields)for(let prop in fields){let value=fields[prop];value instanceof dist_StateField&&null!=this.config.address[value.id]&&(result[prop]=value.spec.toJSON(this.field(fields[prop]),this))}return result}static fromJSON(json,config={},fields){if(!json||"string"!=typeof json.doc)throw new RangeError("Invalid JSON representation for EditorState");let fieldInit=[];if(fields)for(let prop in fields)if(Object.prototype.hasOwnProperty.call(json,prop)){let field=fields[prop],value=json[prop];fieldInit.push(field.init((state=>field.spec.fromJSON(value,state))))}return EditorState.create({doc:json.doc,selection:dist_EditorSelection.fromJSON(json.selection),extensions:config.extensions?fieldInit.concat([config.extensions]):fieldInit})}static create(config={}){let configuration=Configuration.resolve(config.extensions||[],new Map),doc=config.doc instanceof Text?config.doc:Text.of((config.doc||"").split(configuration.staticFacet(EditorState.lineSeparator)||DefaultSplit)),selection=config.selection?config.selection instanceof dist_EditorSelection?config.selection:dist_EditorSelection.single(config.selection.anchor,config.selection.head):dist_EditorSelection.single(0);return checkSelection(selection,doc.length),configuration.staticFacet(allowMultipleSelections)||(selection=selection.asSingle()),new EditorState(configuration,doc,selection,configuration.dynamicSlots.map((()=>null)),((state,slot)=>slot.create(state)),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||"\n"}get readOnly(){return this.facet(readOnly)}phrase(phrase,...insert){for(let map of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(map,phrase)){phrase=map[phrase];break}return insert.length&&(phrase=phrase.replace(/\$(\$|\d*)/g,((m,i)=>{if("$"==i)return"$";let n=+(i||1);return!n||n>insert.length?m:insert[n-1]}))),phrase}languageDataAt(name,pos,side=-1){let values=[];for(let provider of this.facet(languageData))for(let result of provider(this,pos,side))Object.prototype.hasOwnProperty.call(result,name)&&values.push(result[name]);return values}charCategorizer(at){return makeCategorizer(this.languageDataAt("wordChars",at).join(""))}wordAt(pos){let{text,from,length}=this.doc.lineAt(pos),cat=this.charCategorizer(pos),start=pos-from,end=pos-from;for(;start>0;){let prev=findClusterBreak(text,start,!1);if(cat(text.slice(prev,start))!=CharCategory.Word)break;start=prev}for(;end<length;){let next=findClusterBreak(text,end);if(cat(text.slice(end,next))!=CharCategory.Word)break;end=next}return start==end?null:dist_EditorSelection.range(start+from,end+from)}}EditorState.allowMultipleSelections=allowMultipleSelections,EditorState.tabSize=Facet.define({combine:values=>values.length?values[0]:4}),EditorState.lineSeparator=lineSeparator,EditorState.readOnly=readOnly,EditorState.phrases=Facet.define({compare(a,b){let kA=Object.keys(a),kB=Object.keys(b);return kA.length==kB.length&&kA.every((k=>a[k]==b[k]))}}),EditorState.languageData=languageData,EditorState.changeFilter=changeFilter,EditorState.transactionFilter=transactionFilter,EditorState.transactionExtender=transactionExtender,Compartment.reconfigure=dist_StateEffect.define();class RangeValue{eq(other){return this==other}range(from,to=from){return Range.create(from,to,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0,RangeValue.prototype.point=!1,RangeValue.prototype.mapMode=dist_MapMode.TrackDel;class Range{constructor(from,to,value){this.from=from,this.to=to,this.value=value}static create(from,to,value){return new Range(from,to,value)}}function cmpRange(a,b){return a.from-b.from||a.value.startSide-b.value.startSide}class Chunk{constructor(from,to,value,maxPoint){this.from=from,this.to=to,this.value=value,this.maxPoint=maxPoint}get length(){return this.to[this.to.length-1]}findIndex(pos,side,end,startAt=0){let arr=end?this.to:this.from;for(let lo=startAt,hi=arr.length;;){if(lo==hi)return lo;let mid=lo+hi>>1,diff=arr[mid]-pos||(end?this.value[mid].endSide:this.value[mid].startSide)-side;if(mid==lo)return diff>=0?lo:hi;diff>=0?hi=mid:lo=mid+1}}between(offset,from,to,f){for(let i=this.findIndex(from,-1e9,!0),e=this.findIndex(to,1e9,!1,i);i<e;i++)if(!1===f(this.from[i]+offset,this.to[i]+offset,this.value[i]))return!1}map(offset,changes){let value=[],from=[],to=[],newPos=-1,maxPoint=-1;for(let i=0;i<this.value.length;i++){let newFrom,newTo,val=this.value[i],curFrom=this.from[i]+offset,curTo=this.to[i]+offset;if(curFrom==curTo){let mapped=changes.mapPos(curFrom,val.startSide,val.mapMode);if(null==mapped)continue;if(newFrom=newTo=mapped,val.startSide!=val.endSide&&(newTo=changes.mapPos(curFrom,val.endSide),newTo<newFrom))continue}else if(newFrom=changes.mapPos(curFrom,val.startSide),newTo=changes.mapPos(curTo,val.endSide),newFrom>newTo||newFrom==newTo&&val.startSide>0&&val.endSide<=0)continue;(newTo-newFrom||val.endSide-val.startSide)<0||(newPos<0&&(newPos=newFrom),val.point&&(maxPoint=Math.max(maxPoint,newTo-newFrom)),value.push(val),from.push(newFrom-newPos),to.push(newTo-newPos))}return{mapped:value.length?new Chunk(from,to,value,maxPoint):null,pos:newPos}}}class dist_RangeSet{constructor(chunkPos,chunk,nextLayer,maxPoint){this.chunkPos=chunkPos,this.chunk=chunk,this.nextLayer=nextLayer,this.maxPoint=maxPoint}static create(chunkPos,chunk,nextLayer,maxPoint){return new dist_RangeSet(chunkPos,chunk,nextLayer,maxPoint)}get length(){let last=this.chunk.length-1;return last<0?0:Math.max(this.chunkEnd(last),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let size=this.nextLayer.size;for(let chunk of this.chunk)size+=chunk.value.length;return size}chunkEnd(index){return this.chunkPos[index]+this.chunk[index].length}update(updateSpec){let{add=[],sort=!1,filterFrom=0,filterTo=this.length}=updateSpec,filter=updateSpec.filter;if(0==add.length&&!filter)return this;if(sort&&(add=add.slice().sort(cmpRange)),this.isEmpty)return add.length?dist_RangeSet.of(add):this;let cur=new LayerCursor(this,null,-1).goto(0),i=0,spill=[],builder=new RangeSetBuilder;for(;cur.value||i<add.length;)if(i<add.length&&(cur.from-add[i].from||cur.startSide-add[i].value.startSide)>=0){let range=add[i++];builder.addInner(range.from,range.to,range.value)||spill.push(range)}else 1==cur.rangeIndex&&cur.chunkIndex<this.chunk.length&&(i==add.length||this.chunkEnd(cur.chunkIndex)<add[i].from)&&(!filter||filterFrom>this.chunkEnd(cur.chunkIndex)||filterTo<this.chunkPos[cur.chunkIndex])&&builder.addChunk(this.chunkPos[cur.chunkIndex],this.chunk[cur.chunkIndex])?cur.nextChunk():((!filter||filterFrom>cur.to||filterTo<cur.from||filter(cur.from,cur.to,cur.value))&&(builder.addInner(cur.from,cur.to,cur.value)||spill.push(Range.create(cur.from,cur.to,cur.value))),cur.next());return builder.finishInner(this.nextLayer.isEmpty&&!spill.length?dist_RangeSet.empty:this.nextLayer.update({add:spill,filter,filterFrom,filterTo}))}map(changes){if(changes.empty||this.isEmpty)return this;let chunks=[],chunkPos=[],maxPoint=-1;for(let i=0;i<this.chunk.length;i++){let start=this.chunkPos[i],chunk=this.chunk[i],touch=changes.touchesRange(start,start+chunk.length);if(!1===touch)maxPoint=Math.max(maxPoint,chunk.maxPoint),chunks.push(chunk),chunkPos.push(changes.mapPos(start));else if(!0===touch){let{mapped,pos}=chunk.map(start,changes);mapped&&(maxPoint=Math.max(maxPoint,mapped.maxPoint),chunks.push(mapped),chunkPos.push(pos))}}let next=this.nextLayer.map(changes);return 0==chunks.length?next:new dist_RangeSet(chunkPos,chunks,next||dist_RangeSet.empty,maxPoint)}between(from,to,f){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let start=this.chunkPos[i],chunk=this.chunk[i];if(to>=start&&from<=start+chunk.length&&!1===chunk.between(start,from-start,to-start,f))return}this.nextLayer.between(from,to,f)}}iter(from=0){return HeapCursor.from([this]).goto(from)}get isEmpty(){return this.nextLayer==this}static iter(sets,from=0){return HeapCursor.from(sets).goto(from)}static compare(oldSets,newSets,textDiff,comparator,minPointSize=-1){let a=oldSets.filter((set=>set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize)),b=newSets.filter((set=>set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize)),sharedChunks=findSharedChunks(a,b,textDiff),sideA=new SpanCursor(a,sharedChunks,minPointSize),sideB=new SpanCursor(b,sharedChunks,minPointSize);textDiff.iterGaps(((fromA,fromB,length)=>compare(sideA,fromA,sideB,fromB,length,comparator))),textDiff.empty&&0==textDiff.length&&compare(sideA,0,sideB,0,0,comparator)}static eq(oldSets,newSets,from=0,to){null==to&&(to=999999999);let a=oldSets.filter((set=>!set.isEmpty&&newSets.indexOf(set)<0)),b=newSets.filter((set=>!set.isEmpty&&oldSets.indexOf(set)<0));if(a.length!=b.length)return!1;if(!a.length)return!0;let sharedChunks=findSharedChunks(a,b),sideA=new SpanCursor(a,sharedChunks,0).goto(from),sideB=new SpanCursor(b,sharedChunks,0).goto(from);for(;;){if(sideA.to!=sideB.to||!sameValues(sideA.active,sideB.active)||sideA.point&&(!sideB.point||!sideA.point.eq(sideB.point)))return!1;if(sideA.to>to)return!0;sideA.next(),sideB.next()}}static spans(sets,from,to,iterator,minPointSize=-1){let cursor=new SpanCursor(sets,null,minPointSize).goto(from),pos=from,openRanges=cursor.openStart;for(;;){let curTo=Math.min(cursor.to,to);if(cursor.point){let active=cursor.activeForPoint(cursor.to),openCount=cursor.pointFrom<from?active.length+1:cursor.point.startSide<0?active.length:Math.min(active.length,openRanges);iterator.point(pos,curTo,cursor.point,active,openCount,cursor.pointRank),openRanges=Math.min(cursor.openEnd(curTo),active.length)}else curTo>pos&&(iterator.span(pos,curTo,cursor.active,openRanges),openRanges=cursor.openEnd(curTo));if(cursor.to>to)return openRanges+(cursor.point&&cursor.to>to?1:0);pos=cursor.to,cursor.next()}}static of(ranges,sort=!1){let build=new RangeSetBuilder;for(let range of ranges instanceof Range?[ranges]:sort?function lazySort(ranges){if(ranges.length>1)for(let prev=ranges[0],i=1;i<ranges.length;i++){let cur=ranges[i];if(cmpRange(prev,cur)>0)return ranges.slice().sort(cmpRange);prev=cur}return ranges}(ranges):ranges)build.add(range.from,range.to,range.value);return build.finish()}static join(sets){if(!sets.length)return dist_RangeSet.empty;let result=sets[sets.length-1];for(let i=sets.length-2;i>=0;i--)for(let layer=sets[i];layer!=dist_RangeSet.empty;layer=layer.nextLayer)result=new dist_RangeSet(layer.chunkPos,layer.chunk,result,Math.max(layer.maxPoint,result.maxPoint));return result}}dist_RangeSet.empty=new dist_RangeSet([],[],null,-1),dist_RangeSet.empty.nextLayer=dist_RangeSet.empty;class RangeSetBuilder{finishChunk(newArrays){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,newArrays&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(from,to,value){this.addInner(from,to,value)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(from,to,value)}addInner(from,to,value){let diff=from-this.lastTo||value.startSide-this.last.endSide;if(diff<=0&&(from-this.lastFrom||value.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(diff<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=from),this.from.push(from-this.chunkStart),this.to.push(to-this.chunkStart),this.last=value,this.lastFrom=from,this.lastTo=to,this.value.push(value),value.point&&(this.maxPoint=Math.max(this.maxPoint,to-from)),!0)}addChunk(from,chunk){if((from-this.lastTo||chunk.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,chunk.maxPoint),this.chunks.push(chunk),this.chunkPos.push(from);let last=chunk.value.length-1;return this.last=chunk.value[last],this.lastFrom=chunk.from[last]+from,this.lastTo=chunk.to[last]+from,!0}finish(){return this.finishInner(dist_RangeSet.empty)}finishInner(next){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return next;let result=dist_RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(next):next,this.setMaxPoint);return this.from=null,result}}function findSharedChunks(a,b,textDiff){let inA=new Map;for(let set of a)for(let i=0;i<set.chunk.length;i++)set.chunk[i].maxPoint<=0&&inA.set(set.chunk[i],set.chunkPos[i]);let shared=new Set;for(let set of b)for(let i=0;i<set.chunk.length;i++){let known=inA.get(set.chunk[i]);null==known||(textDiff?textDiff.mapPos(known):known)!=set.chunkPos[i]||(null==textDiff?void 0:textDiff.touchesRange(known,known+set.chunk[i].length))||shared.add(set.chunk[i])}return shared}class LayerCursor{constructor(layer,skip,minPoint,rank=0){this.layer=layer,this.skip=skip,this.minPoint=minPoint,this.rank=rank}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(pos,side=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(pos,side,!1),this}gotoInner(pos,side,forward){for(;this.chunkIndex<this.layer.chunk.length;){let next=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(next)||this.layer.chunkEnd(this.chunkIndex)<pos||next.maxPoint<this.minPoint))break;this.chunkIndex++,forward=!1}if(this.chunkIndex<this.layer.chunk.length){let rangeIndex=this.layer.chunk[this.chunkIndex].findIndex(pos-this.layer.chunkPos[this.chunkIndex],side,!0);(!forward||this.rangeIndex<rangeIndex)&&this.setRangeIndex(rangeIndex)}this.next()}forward(pos,side){(this.to-pos||this.endSide-side)<0&&this.gotoInner(pos,side,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let chunkPos=this.layer.chunkPos[this.chunkIndex],chunk=this.layer.chunk[this.chunkIndex],from=chunkPos+chunk.from[this.rangeIndex];if(this.from=from,this.to=chunkPos+chunk.to[this.rangeIndex],this.value=chunk.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(index){if(index==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=index}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(other){return this.from-other.from||this.startSide-other.startSide||this.rank-other.rank||this.to-other.to||this.endSide-other.endSide}}class HeapCursor{constructor(heap){this.heap=heap}static from(sets,skip=null,minPoint=-1){let heap=[];for(let i=0;i<sets.length;i++)for(let cur=sets[i];!cur.isEmpty;cur=cur.nextLayer)cur.maxPoint>=minPoint&&heap.push(new LayerCursor(cur,skip,minPoint,i));return 1==heap.length?heap[0]:new HeapCursor(heap)}get startSide(){return this.value?this.value.startSide:0}goto(pos,side=-1e9){for(let cur of this.heap)cur.goto(pos,side);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);return this.next(),this}forward(pos,side){for(let cur of this.heap)cur.forward(pos,side);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);(this.to-pos||this.value.endSide-side)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let top=this.heap[0];this.from=top.from,this.to=top.to,this.value=top.value,this.rank=top.rank,top.value&&top.next(),heapBubble(this.heap,0)}}}function heapBubble(heap,index){for(let cur=heap[index];;){let childIndex=1+(index<<1);if(childIndex>=heap.length)break;let child=heap[childIndex];if(childIndex+1<heap.length&&child.compare(heap[childIndex+1])>=0&&(child=heap[childIndex+1],childIndex++),cur.compare(child)<0)break;heap[childIndex]=cur,heap[index]=child,index=childIndex}}class SpanCursor{constructor(sets,skip,minPoint){this.minPoint=minPoint,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(sets,skip,minPoint)}goto(pos,side=-1e9){return this.cursor.goto(pos,side),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=pos,this.endSide=side,this.openStart=-1,this.next(),this}forward(pos,side){for(;this.minActive>-1&&(this.activeTo[this.minActive]-pos||this.active[this.minActive].endSide-side)<0;)this.removeActive(this.minActive);this.cursor.forward(pos,side)}removeActive(index){remove(this.active,index),remove(this.activeTo,index),remove(this.activeRank,index),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(trackOpen){let i=0,{value,to,rank}=this.cursor;for(;i<this.activeRank.length&&(rank-this.activeRank[i]||to-this.activeTo[i])>0;)i++;insert(this.active,i,value),insert(this.activeTo,i,to),insert(this.activeRank,i,rank),trackOpen&&insert(trackOpen,i,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let from=this.to,wasPoint=this.point;this.point=null;let trackOpen=this.openStart<0?[]:null;for(;;){let a=this.minActive;if(a>-1&&(this.activeTo[a]-this.cursor.from||this.active[a].endSide-this.cursor.startSide)<0){if(this.activeTo[a]>from){this.to=this.activeTo[a],this.endSide=this.active[a].endSide;break}this.removeActive(a),trackOpen&&remove(trackOpen,a)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>from){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let nextVal=this.cursor.value;if(nextVal.point){if(!(wasPoint&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=nextVal,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=nextVal.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(trackOpen),this.cursor.next()}}}if(trackOpen){this.openStart=0;for(let i=trackOpen.length-1;i>=0&&trackOpen[i]<from;i--)this.openStart++}}activeForPoint(to){if(!this.active.length)return this.active;let active=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>to||this.activeTo[i]==to&&this.active[i].endSide>=this.point.endSide)&&active.push(this.active[i]);return active.reverse()}openEnd(to){let open=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>to;i--)open++;return open}}function compare(a,startA,b,startB,length,comparator){a.goto(startA),b.goto(startB);let endB=startB+length,pos=startB,dPos=startB-startA;for(;;){let diff=a.to+dPos-b.to||a.endSide-b.endSide,end=diff<0?a.to+dPos:b.to,clipEnd=Math.min(end,endB);if(a.point||b.point?a.point&&b.point&&(a.point==b.point||a.point.eq(b.point))&&sameValues(a.activeForPoint(a.to),b.activeForPoint(b.to))||comparator.comparePoint(pos,clipEnd,a.point,b.point):clipEnd>pos&&!sameValues(a.active,b.active)&&comparator.compareRange(pos,clipEnd,a.active,b.active),end>endB)break;pos=end,diff<=0&&a.next(),diff>=0&&b.next()}}function sameValues(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(a[i]!=b[i]&&!a[i].eq(b[i]))return!1;return!0}function remove(array,index){for(let i=index,e=array.length-1;i<e;i++)array[i]=array[i+1];array.pop()}function insert(array,index,value){for(let i=array.length-1;i>=index;i--)array[i+1]=array[i];array[index]=value}function findMinIndex(value,array){let found=-1,foundPos=1e9;for(let i=0;i<array.length;i++)(array[i]-foundPos||value[i].endSide-value[found].endSide)<0&&(found=i,foundPos=array[i]);return found}const COUNT="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),SET="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),style_mod_top="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class StyleModule{constructor(spec,options){this.rules=[];let{finish}=options||{};function splitSelector(selector){return/^@/.test(selector)?[selector]:selector.split(/,\s*/)}function render(selectors,spec,target,isKeyframes){let local=[],isAt=/^@(\w+)\b/.exec(selectors[0]),keyframes=isAt&&"keyframes"==isAt[1];if(isAt&&null==spec)return target.push(selectors[0]+";");for(let prop in spec){let value=spec[prop];if(/&/.test(prop))render(prop.split(/,\s*/).map((part=>selectors.map((sel=>part.replace(/&/,sel))))).reduce(((a,b)=>a.concat(b))),value,target);else if(value&&"object"==typeof value){if(!isAt)throw new RangeError("The value of a property ("+prop+") should be a primitive value.");render(splitSelector(prop),value,local,keyframes)}else null!=value&&local.push(prop.replace(/_.*/,"").replace(/[A-Z]/g,(l=>"-"+l.toLowerCase()))+": "+value+";")}(local.length||keyframes)&&target.push((!finish||isAt||isKeyframes?selectors:selectors.map(finish)).join(", ")+" {"+local.join(" ")+"}")}for(let prop in spec)render(splitSelector(prop),spec[prop],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let id=style_mod_top[COUNT]||1;return style_mod_top[COUNT]=id+1,"ͼ"+id.toString(36)}static mount(root,modules,options){let set=root[SET],nonce=options&&options.nonce;set?nonce&&set.setNonce(nonce):set=new StyleSet(root,nonce),set.mount(Array.isArray(modules)?modules:[modules],root)}}let adoptedSet=new Map;class StyleSet{constructor(root,nonce){let doc=root.ownerDocument||root,win=doc.defaultView;if(!root.head&&root.adoptedStyleSheets&&win.CSSStyleSheet){let adopted=adoptedSet.get(doc);if(adopted)return root[SET]=adopted;this.sheet=new win.CSSStyleSheet,adoptedSet.set(doc,this)}else this.styleTag=doc.createElement("style"),nonce&&this.styleTag.setAttribute("nonce",nonce);this.modules=[],root[SET]=this}mount(modules,root){let sheet=this.sheet,pos=0,j=0;for(let i=0;i<modules.length;i++){let mod=modules[i],index=this.modules.indexOf(mod);if(index<j&&index>-1&&(this.modules.splice(index,1),j--,index=-1),-1==index){if(this.modules.splice(j++,0,mod),sheet)for(let k=0;k<mod.rules.length;k++)sheet.insertRule(mod.rules[k],pos++)}else{for(;j<index;)pos+=this.modules[j++].rules.length;pos+=mod.rules.length,j++}}if(sheet)root.adoptedStyleSheets.indexOf(this.sheet)<0&&(root.adoptedStyleSheets=[this.sheet,...root.adoptedStyleSheets]);else{let text="";for(let i=0;i<this.modules.length;i++)text+=this.modules[i].getRules()+"\n";this.styleTag.textContent=text;let target=root.head||root;this.styleTag.parentNode!=target&&target.insertBefore(this.styleTag,target.firstChild)}}setNonce(nonce){this.styleTag&&this.styleTag.getAttribute("nonce")!=nonce&&this.styleTag.setAttribute("nonce",nonce)}}for(var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},i=("undefined"!=typeof navigator&&/Mac/.test(navigator.platform),"undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),0);i<10;i++)base[48+i]=base[96+i]=String(i);for(i=1;i<=24;i++)base[i+111]="F"+i;for(i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function getSelection(root){let target;return target=11==root.nodeType?root.getSelection?root:root.ownerDocument:root,target.getSelection()}function contains(dom,node){return!!node&&(dom==node||dom.contains(1!=node.nodeType?node.parentNode:node))}function hasSelection(dom,selection){if(!selection.anchorNode)return!1;try{return contains(dom,selection.anchorNode)}catch(_){return!1}}function clientRectsFor(dom){return 3==dom.nodeType?textRange(dom,0,dom.nodeValue.length).getClientRects():1==dom.nodeType?dom.getClientRects():[]}function isEquivalentPosition(node,off,targetNode,targetOff){return!!targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))}function domIndex(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index}function isBlockElement(node){return 1==node.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName)}function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:maxOffset(node))){if("DIV"==node.nodeName)return!1;let parent=node.parentNode;if(!parent||1!=parent.nodeType)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType)return!1;if(1==(node=node.childNodes[off+(dir<0?-1:0)]).nodeType&&"false"==node.contentEditable)return!1;off=dir<0?maxOffset(node):0}}}function maxOffset(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function flattenRect(rect,left){let x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom}}function windowRect(win){let vp=win.visualViewport;return vp?{left:0,right:vp.width,top:0,bottom:vp.height}:{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight}}function getScale(elt,rect){let scaleX=rect.width/elt.offsetWidth,scaleY=rect.height/elt.offsetHeight;return(scaleX>.995&&scaleX<1.005||!isFinite(scaleX)||Math.abs(rect.width-elt.offsetWidth)<1)&&(scaleX=1),(scaleY>.995&&scaleY<1.005||!isFinite(scaleY)||Math.abs(rect.height-elt.offsetHeight)<1)&&(scaleY=1),{scaleX,scaleY}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset}setRange(range){let{anchorNode,focusNode}=range;this.set(anchorNode,Math.min(range.anchorOffset,anchorNode?maxOffset(anchorNode):0),focusNode,Math.min(range.focusOffset,focusNode?maxOffset(focusNode):0))}set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode,this.anchorOffset=anchorOffset,this.focusNode=focusNode,this.focusOffset=focusOffset}}let scratchRange,preventScrollSupported=null;function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stack=[];for(let cur=dom;cur&&(stack.push(cur,cur.scrollTop,cur.scrollLeft),cur!=cur.ownerDocument);cur=cur.parentNode);if(dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let i=0;i<stack.length;){let elt=stack[i++],top=stack[i++],left=stack[i++];elt.scrollTop!=top&&(elt.scrollTop=top),elt.scrollLeft!=left&&(elt.scrollLeft=left)}}}function textRange(node,from,to=from){let range=scratchRange||(scratchRange=document.createRange());return range.setEnd(node,to),range.setStart(node,from),range}function dispatchKey(elt,name,code,mods){let options={key:name,code:name,keyCode:code,which:code,cancelable:!0};mods&&({altKey:options.altKey,ctrlKey:options.ctrlKey,shiftKey:options.shiftKey,metaKey:options.metaKey}=mods);let down=new KeyboardEvent("keydown",options);down.synthetic=!0,elt.dispatchEvent(down);let up=new KeyboardEvent("keyup",options);return up.synthetic=!0,elt.dispatchEvent(up),down.defaultPrevented||up.defaultPrevented}function clearAttributes(node){for(;node.attributes.length;)node.removeAttributeNode(node.attributes[0])}function isScrolledToBottom(elt){return elt.scrollTop>Math.max(1,elt.scrollHeight-elt.clientHeight-4)}function textNodeBefore(startNode,startOffset){for(let node=startNode,offset=startOffset;;){if(3==node.nodeType&&offset>0)return{node,offset};if(1==node.nodeType&&offset>0){if("false"==node.contentEditable)return null;node=node.childNodes[offset-1],offset=maxOffset(node)}else{if(!node.parentNode||isBlockElement(node))return null;offset=domIndex(node),node=node.parentNode}}}function textNodeAfter(startNode,startOffset){for(let node=startNode,offset=startOffset;;){if(3==node.nodeType&&offset<node.nodeValue.length)return{node,offset};if(1==node.nodeType&&offset<node.childNodes.length){if("false"==node.contentEditable)return null;node=node.childNodes[offset],offset=0}else{if(!node.parentNode||isBlockElement(node))return null;offset=domIndex(node)+1,node=node.parentNode}}}class DOMPos{constructor(node,offset,precise=!0){this.node=node,this.offset=offset,this.precise=precise}static before(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom),precise)}static after(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom)+1,precise)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(view){let pos=this.posAtStart;for(let child of this.children){if(child==view)return pos;pos+=child.length+child.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(view){return this.posBefore(view)+view.length}sync(view,track){if(2&this.flags){let next,parent=this.dom,prev=null;for(let child of this.children){if(7&child.flags){if(!child.dom&&(next=prev?prev.nextSibling:parent.firstChild)){let contentView=ContentView.get(next);(!contentView||!contentView.parent&&contentView.canReuseDOM(child))&&child.reuseDOM(next)}child.sync(view,track),child.flags&=-8}if(next=prev?prev.nextSibling:parent.firstChild,track&&!track.written&&track.node==parent&&next!=child.dom&&(track.written=!0),child.dom.parentNode==parent)for(;next&&next!=child.dom;)next=rm$1(next);else parent.insertBefore(child.dom,next);prev=child.dom}for(next=prev?prev.nextSibling:parent.firstChild,next&&track&&track.node==parent&&(track.written=!0);next;)next=rm$1(next)}else if(1&this.flags)for(let child of this.children)7&child.flags&&(child.sync(view,track),child.flags&=-8)}reuseDOM(_dom){}localPosFromDOM(node,offset){let after;if(node==this.dom)after=this.dom.childNodes[offset];else{let bias=0==maxOffset(node)?0:0==offset?-1:1;for(;;){let parent=node.parentNode;if(parent==this.dom)break;0==bias&&parent.firstChild!=parent.lastChild&&(bias=node==parent.firstChild?-1:1),node=parent}after=bias<0?node:node.nextSibling}if(after==this.dom.firstChild)return 0;for(;after&&!ContentView.get(after);)after=after.nextSibling;if(!after)return this.length;for(let i=0,pos=0;;i++){let child=this.children[i];if(child.dom==after)return pos;pos+=child.length+child.breakAfter}}domBoundsAround(from,to,offset=0){let fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(let i=0,pos=offset,prevEnd=offset;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&-1==fromI&&(fromI=i,fromStart=pos),pos>to&&child.dom.parentNode==this.dom){toI=i,toEnd=prevEnd;break}prevEnd=end,pos=end+child.breakAfter}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null}}markDirty(andParent=!1){this.flags|=2,this.markParentsDirty(andParent)}markParentsDirty(childList){for(let parent=this.parent;parent;parent=parent.parent){if(childList&&(parent.flags|=2),1&parent.flags)return;parent.flags|=1,childList=!1}}setParent(parent){this.parent!=parent&&(this.parent=parent,7&this.flags&&this.markParentsDirty(!0))}setDOM(dom){this.dom!=dom&&(this.dom&&(this.dom.cmView=null),this.dom=dom,dom.cmView=this)}get rootView(){for(let v=this;;){let parent=v.parent;if(!parent)return v;v=parent}}replaceChildren(from,to,children=noChildren){this.markDirty();for(let i=from;i<to;i++){let child=this.children[i];child.parent==this&&children.indexOf(child)<0&&child.destroy()}this.children.splice(from,to-from,...children);for(let i=0;i<children.length;i++)children[i].setParent(this)}ignoreMutation(_rec){return!1}ignoreEvent(_event){return!1}childCursor(pos=this.length){return new ChildCursor(this.children,pos,this.children.length)}childPos(pos,bias=1){return this.childCursor().findPos(pos,bias)}toString(){let name=this.constructor.name.replace("View","");return name+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==name?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(node){return node.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(from,to,source,hasStart,openStart,openEnd){return!1}become(other){return!1}canReuseDOM(other){return other.constructor==this.constructor&&!(8&(this.flags|other.flags))}getSide(){return 0}destroy(){for(let child of this.children)child.parent==this&&child.destroy();this.parent=null}}function rm$1(dom){let next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}ContentView.prototype.breakAfter=0;class ChildCursor{constructor(children,pos,i){this.children=children,this.pos=pos,this.i=i,this.off=0}findPos(pos,bias=1){for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=pos-this.pos,this;let next=this.children[--this.i];this.pos-=next.length+next.breakAfter}}}function replaceRange(parent,fromI,fromOff,toI,toOff,insert,breakAtStart,openStart,openEnd){let{children}=parent,before=children.length?children[fromI]:null,last=insert.length?insert[insert.length-1]:null,breakAtEnd=last?last.breakAfter:breakAtStart;if(!(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert.length<2&&before.merge(fromOff,toOff,insert.length?last:null,0==fromOff,openStart,openEnd))){if(toI<children.length){let after=children[toI];after&&(toOff<after.length||after.breakAfter&&(null==last?void 0:last.breakAfter))?(fromI==toI&&(after=after.split(toOff),toOff=0),!breakAtEnd&&last&&after.merge(0,toOff,last,!0,0,openEnd)?insert[insert.length-1]=after:((toOff||after.children.length&&!after.children[0].length)&&after.merge(0,toOff,null,!1,0,openEnd),insert.push(after))):(null==after?void 0:after.breakAfter)&&(last?last.breakAfter=1:breakAtStart=1),toI++}for(before&&(before.breakAfter=breakAtStart,fromOff>0&&(!breakAtStart&&insert.length&&before.merge(fromOff,before.length,insert[0],!1,openStart,0)?before.breakAfter=insert.shift().breakAfter:(fromOff<before.length||before.children.length&&0==before.children[before.children.length-1].length)&&before.merge(fromOff,before.length,null,!1,openStart,0),fromI++));fromI<toI&&insert.length;)if(children[toI-1].become(insert[insert.length-1]))toI--,insert.pop(),openEnd=insert.length?0:openStart;else{if(!children[fromI].become(insert[0]))break;fromI++,insert.shift(),openStart=insert.length?0:openEnd}!insert.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],!1,openStart,openEnd)&&fromI--,(fromI<toI||insert.length)&&parent.replaceChildren(fromI,toI,insert)}}function mergeChildrenInto(parent,from,to,insert,openStart,openEnd){let cur=parent.childCursor(),{i:toI,off:toOff}=cur.findPos(to,1),{i:fromI,off:fromOff}=cur.findPos(from,-1),dLen=from-to;for(let view of insert)dLen+=view.length;parent.length+=dLen,replaceRange(parent,fromI,fromOff,toI,toOff,insert,0,openStart,openEnd)}let nav="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},doc="undefined"!=typeof document?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),dist_ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!dist_ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!dist_ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!dist_ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:dist_ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=doc.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class TextView extends ContentView{constructor(text){super(),this.text=text}get length(){return this.text.length}createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text))}sync(view,track){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(track&&track.node==this.dom&&(track.written=!0),this.dom.nodeValue=this.text)}reuseDOM(dom){3==dom.nodeType&&this.createDOM(dom)}merge(from,to,source){return!(8&this.flags||source&&(!(source instanceof TextView)||this.length-(to-from)+source.length>256||8&source.flags))&&(this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to),this.markDirty(),!0)}split(from){let result=new TextView(this.text.slice(from));return this.text=this.text.slice(0,from),this.markDirty(),result.flags|=8&this.flags,result}localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0}domAtPos(pos){return new DOMPos(this.dom,pos)}domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(pos,side){return function textCoords(text,pos,side){let length=text.nodeValue.length;pos>length&&(pos=length);let from=pos,to=pos,flatten=0;0==pos&&side<0||pos==length&&side>=0?browser.chrome||browser.gecko||(pos?(from--,flatten=1):to<length&&(to++,flatten=-1)):side<0?from--:to<length&&to++;let rects=textRange(text,from,to).getClientRects();if(!rects.length)return null;let rect=rects[(flatten?flatten<0:side>=0)?0:rects.length-1];browser.safari&&!flatten&&0==rect.width&&(rect=Array.prototype.find.call(rects,(r=>r.width))||rect);return flatten?flattenRect(rect,flatten<0):rect||null}(this.dom,pos,side)}}class MarkView extends ContentView{constructor(mark,children=[],length=0){super(),this.mark=mark,this.children=children,this.length=length;for(let ch of children)ch.setParent(this)}setAttrs(dom){if(clearAttributes(dom),this.mark.class&&(dom.className=this.mark.class),this.mark.attrs)for(let name in this.mark.attrs)dom.setAttribute(name,this.mark.attrs[name]);return dom}canReuseDOM(other){return super.canReuseDOM(other)&&!(8&(this.flags|other.flags))}reuseDOM(node){node.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(node),this.flags|=6)}sync(view,track){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(view,track)}merge(from,to,source,_hasStart,openStart,openEnd){return(!source||!(!(source instanceof MarkView&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))&&(mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart-1,openEnd-1),this.markDirty(),!0)}split(from){let result=[],off=0,detachFrom=-1,i=0;for(let elt of this.children){let end=off+elt.length;end>from&&result.push(off<from?elt.split(from-off):elt),detachFrom<0&&off>=from&&(detachFrom=i),off=end,i++}let length=this.length-from;return this.length=from,detachFrom>-1&&(this.children.length=detachFrom,this.markDirty()),new MarkView(this.mark,result,length)}domAtPos(pos){return inlineDOMAtPos(this,pos)}coordsAt(pos,side){return coordsInChildren(this,pos,side)}}class WidgetView extends ContentView{static create(widget,length,side){return new WidgetView(widget,length,side)}constructor(widget,length,side){super(),this.widget=widget,this.length=length,this.side=side,this.prevWidget=null}split(from){let result=WidgetView.create(this.widget,this.length-from,this.side);return this.length-=from,result}sync(view){this.dom&&this.widget.updateDOM(this.dom,view)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(view)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(from,to,source,hasStart,openStart,openEnd){return!(source&&(!(source instanceof WidgetView&&this.widget.compare(source.widget))||from>0&&openStart<=0||to<this.length&&openEnd<=0))&&(this.length=from+(source?source.length:0)+(this.length-to),!0)}become(other){return other instanceof WidgetView&&other.side==this.side&&this.widget.constructor==other.widget.constructor&&(this.widget.compare(other.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,this.length=other.length,!0)}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}get overrideDOMText(){if(0==this.length)return Text.empty;let top=this;for(;top.parent;)top=top.parent;let{view}=top,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty}domAtPos(pos){return(this.length?0==pos:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}domBoundsAround(){return null}coordsAt(pos,side){let custom=this.widget.coordsAt(this.dom,pos,side);if(custom)return custom;let rects=this.dom.getClientRects(),rect=null;if(!rects.length)return null;let fromBack=this.side?this.side<0:pos>0;for(let i=fromBack?rects.length-1:0;rect=rects[i],!(pos>0?0==i:i==rects.length-1||rect.top<rect.bottom);i+=fromBack?-1:1);return flattenRect(rect,!fromBack)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(side){super(),this.side=side}get length(){return 0}merge(){return!1}become(other){return other instanceof WidgetBufferView&&other.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let dom=document.createElement("img");dom.className="cm-widgetBuffer",dom.setAttribute("aria-hidden","true"),this.setDOM(dom)}}getSide(){return this.side}domAtPos(pos){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(pos){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}function inlineDOMAtPos(parent,pos){let dom=parent.dom,{children}=parent,i=0;for(let off=0;i<children.length;i++){let child=children[i],end=off+child.length;if(!(end==off&&child.getSide()<=0)){if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end}}for(let j=i;j>0;j--){let prev=children[j-1];if(prev.dom.parentNode==dom)return prev.domAtPos(prev.length)}for(let j=i;j<children.length;j++){let next=children[j];if(next.dom.parentNode==dom)return next.domAtPos(0)}return new DOMPos(dom,0)}function joinInlineInto(parent,view,open){let last,{children}=parent;open>0&&view instanceof MarkView&&children.length&&(last=children[children.length-1])instanceof MarkView&&last.mark.eq(view.mark)?joinInlineInto(last,view.children[0],open-1):(children.push(view),view.setParent(parent)),parent.length+=view.length}function coordsInChildren(view,pos,side){let before=null,beforePos=-1,after=null,afterPos=-1;!function scan(view,pos){for(let i=0,off=0;i<view.children.length&&off<=pos;i++){let child=view.children[i],end=off+child.length;end>=pos&&(child.children.length?scan(child,pos-off):(!after||after.isHidden&&side>0)&&(end>pos||off==end&&child.getSide()>0)?(after=child,afterPos=pos-off):(off<pos||off==end&&child.getSide()<0&&!child.isHidden)&&(before=child,beforePos=pos-off)),off=end}}(view,pos);let target=(side<0?before:after)||before||after;return target?target.coordsAt(Math.max(0,target==before?beforePos:afterPos),side):function fallbackRect(view){let last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();let rects=clientRectsFor(last);return rects[rects.length-1]||null}(view)}function combineAttrs(source,target){for(let name in source)"class"==name&&target.class?target.class+=" "+source.class:"style"==name&&target.style?target.style+=";"+source.style:target[name]=source[name];return target}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;const noAttrs=Object.create(null);function attrsEq(a,b,ignore){if(a==b)return!0;a||(a=noAttrs),b||(b=noAttrs);let keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length-(ignore&&keysA.indexOf(ignore)>-1?1:0)!=keysB.length-(ignore&&keysB.indexOf(ignore)>-1?1:0))return!1;for(let key of keysA)if(key!=ignore&&(-1==keysB.indexOf(key)||a[key]!==b[key]))return!1;return!0}function updateAttrs(dom,prev,attrs){let changed=!1;if(prev)for(let name in prev)attrs&&name in attrs||(changed=!0,"style"==name?dom.style.cssText="":dom.removeAttribute(name));if(attrs)for(let name in attrs)prev&&prev[name]==attrs[name]||(changed=!0,"style"==name?dom.style.cssText=attrs[name]:dom.setAttribute(name,attrs[name]));return changed}function getAttrs(dom){let attrs=Object.create(null);for(let i=0;i<dom.attributes.length;i++){let attr=dom.attributes[i];attrs[attr.name]=attr.value}return attrs}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView))return!1;this.dom||source.transferDOM(this)}return hasStart&&this.setDeco(source?source.attrs:null),mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart,openEnd),!0}split(at){let end=new LineView;if(end.breakAfter=this.breakAfter,0==this.length)return end;let{i,off}=this.childPos(at);off&&(end.append(this.children[i].split(off),0),this.children[i].merge(off,this.children[i].length,null,!1,0,0),i++);for(let j=i;j<this.children.length;j++)end.append(this.children[j],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=at,end}transferDOM(other){this.dom&&(this.markDirty(),other.setDOM(this.dom),other.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(attrs){attrsEq(this.attrs,attrs)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=attrs)}append(child,openStart){joinInlineInto(this,child,openStart)}addLineDeco(deco){let attrs=deco.spec.attributes,cls=deco.spec.class;attrs&&(this.attrs=combineAttrs(attrs,this.attrs||{})),cls&&(this.attrs=combineAttrs({class:cls},this.attrs||{}))}domAtPos(pos){return inlineDOMAtPos(this,pos)}reuseDOM(node){"DIV"==node.nodeName&&(this.setDOM(node),this.flags|=6)}sync(view,track){var _a;this.dom?4&this.flags&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(view,track);let last=this.dom.lastChild;for(;last&&ContentView.get(last)instanceof MarkView;)last=last.lastChild;if(!(last&&this.length&&("BR"==last.nodeName||0!=(null===(_a=ContentView.get(last))||void 0===_a?void 0:_a.isEditable)||browser.ios&&this.children.some((ch=>ch instanceof TextView))))){let hack=document.createElement("BR");hack.cmIgnore=!0,this.dom.appendChild(hack)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let textHeight,totalWidth=0;for(let child of this.children){if(!(child instanceof TextView)||/[^ -~]/.test(child.text))return null;let rects=clientRectsFor(child.dom);if(1!=rects.length)return null;totalWidth+=rects[0].width,textHeight=rects[0].height}return totalWidth?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length,textHeight}:null}coordsAt(pos,side){let rect=coordsInChildren(this,pos,side);if(!this.children.length&&rect&&this.parent){let{heightOracle}=this.parent.view.viewState,height=rect.bottom-rect.top;if(Math.abs(height-heightOracle.lineHeight)<2&&heightOracle.textHeight<height){let dist=(height-heightOracle.textHeight)/2;return{top:rect.top+dist,bottom:rect.bottom-dist,left:rect.left,right:rect.left}}}return rect}become(_other){return!1}covers(){return!0}static find(docView,pos){for(let i=0,off=0;i<docView.children.length;i++){let block=docView.children[i],end=off+block.length;if(end>=pos){if(block instanceof LineView)return block;if(end>pos)break}off=end+block.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(widget,length,deco){super(),this.widget=widget,this.length=length,this.deco=deco,this.breakAfter=0,this.prevWidget=null}merge(from,to,source,_takeDeco,openStart,openEnd){return!(source&&(!(source instanceof BlockWidgetView&&this.widget.compare(source.widget))||from>0&&openStart<=0||to<this.length&&openEnd<=0))&&(this.length=from+(source?source.length:0)+(this.length-to),!0)}domAtPos(pos){return 0==pos?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}split(at){let len=this.length-at;this.length=at;let end=new BlockWidgetView(this.widget,len,this.deco);return end.breakAfter=this.breakAfter,end}get children(){return noChildren}sync(view){this.dom&&this.widget.updateDOM(this.dom,view)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(view)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(other){return other instanceof BlockWidgetView&&other.widget.constructor==this.widget.constructor&&(other.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,this.length=other.length,this.deco=other.deco,this.breakAfter=other.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(pos,side){return this.widget.coordsAt(this.dom,pos,side)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(side){let{startSide,endSide}=this.deco;return startSide!=endSide&&(side<0?startSide<0:endSide>0)}}class WidgetType{eq(widget){return!1}updateDOM(dom,view){return!1}compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(event){return!0}coordsAt(dom,pos,side){return null}get isHidden(){return!1}get editable(){return!1}destroy(dom){}}var BlockType=function(BlockType){return BlockType[BlockType.Text=0]="Text",BlockType[BlockType.WidgetBefore=1]="WidgetBefore",BlockType[BlockType.WidgetAfter=2]="WidgetAfter",BlockType[BlockType.WidgetRange=3]="WidgetRange",BlockType}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(startSide,endSide,widget,spec){super(),this.startSide=startSide,this.endSide=endSide,this.widget=widget,this.spec=spec}get heightRelevant(){return!1}static mark(spec){return new MarkDecoration(spec)}static widget(spec){let side=Math.max(-1e4,Math.min(1e4,spec.side||0)),block=!!spec.block;return side+=block&&!spec.inlineOrder?side>0?3e8:-4e8:side>0?1e8:-1e8,new PointDecoration(spec,side,side,block,spec.widget||null,!1)}static replace(spec){let startSide,endSide,block=!!spec.block;if(spec.isBlockGap)startSide=-5e8,endSide=4e8;else{let{start,end}=getInclusive(spec,block);startSide=(start?block?-3e8:-1:5e8)-1,endSide=1+(end?block?2e8:1:-6e8)}return new PointDecoration(spec,startSide,endSide,block,spec.widget||null,!0)}static line(spec){return new LineDecoration(spec)}static set(of,sort=!1){return dist_RangeSet.of(of,sort)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Decoration.none=dist_RangeSet.empty;class MarkDecoration extends Decoration{constructor(spec){let{start,end}=getInclusive(spec);super(start?-1:5e8,end?1:-6e8,null,spec),this.tagName=spec.tagName||"span",this.class=spec.class||"",this.attrs=spec.attributes||null}eq(other){var _a,_b;return this==other||other instanceof MarkDecoration&&this.tagName==other.tagName&&(this.class||(null===(_a=this.attrs)||void 0===_a?void 0:_a.class))==(other.class||(null===(_b=other.attrs)||void 0===_b?void 0:_b.class))&&attrsEq(this.attrs,other.attrs,"class")}range(from,to=from){if(from>=to)throw new RangeError("Mark decorations may not be empty");return super.range(from,to)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(spec){super(-2e8,-2e8,null,spec)}eq(other){return other instanceof LineDecoration&&this.spec.class==other.spec.class&&attrsEq(this.spec.attributes,other.spec.attributes)}range(from,to=from){if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return super.range(from,to)}}LineDecoration.prototype.mapMode=dist_MapMode.TrackBefore,LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(spec,startSide,endSide,block,widget,isReplace){super(startSide,endSide,widget,spec),this.block=block,this.isReplace=isReplace,this.mapMode=block?startSide<=0?dist_MapMode.TrackBefore:dist_MapMode.TrackAfter:dist_MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(other){return other instanceof PointDecoration&&function widgetsEq(a,b){return a==b||!!(a&&b&&a.compare(b))}(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide}range(from,to=from){if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(from,to)}}function getInclusive(spec,block=!1){let{inclusiveStart:start,inclusiveEnd:end}=spec;return null==start&&(start=spec.inclusive),null==end&&(end=spec.inclusive),{start:null!=start?start:block,end:null!=end?end:block}}function addRange(from,to,ranges,margin=0){let last=ranges.length-1;last>=0&&ranges[last]+margin>=from?ranges[last]=Math.max(ranges[last],to):ranges.push(from,to)}PointDecoration.prototype.point=!0;class ContentBuilder{constructor(doc,pos,end,disallowBlockEffectsFor){this.doc=doc,this.pos=pos,this.end=end,this.disallowBlockEffectsFor=disallowBlockEffectsFor,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=doc.iter(),this.skip=pos}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let last=this.content[this.content.length-1];return!(last.breakAfter||last instanceof BlockWidgetView&&last.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(active=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),active),active.length),this.pendingBuffer=0)}addBlockWidget(view){this.flushBuffer(),this.curLine=null,this.content.push(view)}finish(openEnd){this.pendingBuffer&&openEnd<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||openEnd&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView||this.getLine()}buildText(length,active,openStart){for(;length>0;){if(this.textOff==this.text.length){let{value,lineBreak,done}=this.cursor.next(this.skip);if(this.skip=0,done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,length--;continue}this.text=value,this.textOff=0}let take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(active.length-openStart)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+take)),active),openStart),this.atCursorPos=!0,this.textOff+=take,length-=take,openStart=0}}span(from,to,active,openStart){this.buildText(to-from,active,openStart),this.pos=to,this.openStart<0&&(this.openStart=openStart)}point(from,to,deco,active,openStart,index){if(this.disallowBlockEffectsFor[index]&&deco instanceof PointDecoration){if(deco.block)throw new RangeError("Block decorations may not be specified via plugins");if(to>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let len=to-from;if(deco instanceof PointDecoration)if(deco.block)deco.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(deco.widget||NullWidget.block,len,deco));else{let view=WidgetView.create(deco.widget||NullWidget.inline,len,len?0:deco.startSide),cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0),cursorAfter=!view.isEditable&&(from<to||openStart>active.length||deco.startSide<=0),line=this.getLine();2!=this.pendingBuffer||cursorBefore||view.isEditable||(this.pendingBuffer=0),this.flushBuffer(active),cursorBefore&&(line.append(wrapMarks(new WidgetBufferView(1),active),openStart),openStart=active.length+Math.max(0,openStart-active.length)),line.append(wrapMarks(view,active),openStart),this.atCursorPos=cursorAfter,this.pendingBuffer=cursorAfter?from<to||openStart>active.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=active.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(deco);len&&(this.textOff+len<=this.text.length?this.textOff+=len:(this.skip+=len-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=to),this.openStart<0&&(this.openStart=openStart)}static build(text,from,to,decorations,dynamicDecorationMap){let builder=new ContentBuilder(text,from,to,dynamicDecorationMap);return builder.openEnd=dist_RangeSet.spans(decorations,from,to,builder),builder.openStart<0&&(builder.openStart=builder.openEnd),builder.finish(builder.openEnd),builder}}function wrapMarks(view,active){for(let mark of active)view=new MarkView(mark,[view],view.length);return view}class NullWidget extends WidgetType{constructor(tag){super(),this.tag=tag}eq(other){return other.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span"),NullWidget.block=new NullWidget("div");var Direction=function(Direction){return Direction[Direction.LTR=0]="LTR",Direction[Direction.RTL=1]="RTL",Direction}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(str){let result=[];for(let i=0;i<str.length;i++)result.push(1<<+str[i]);return result}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let p of["()","[]","{}"]){let l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r,Brackets[r]=-l}function charType(ch){return ch<=247?LowTypes[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8204?256:64336<=ch&&ch<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(from,to,level){this.from=from,this.to=to,this.level=level}side(end,dir){return this.dir==dir==end?this.to:this.from}forward(forward,dir){return forward==(this.dir==dir)}static find(order,index,level,assoc){let maybe=-1;for(let i=0;i<order.length;i++){let span=order[i];if(span.from<=index&&span.to>=index){if(span.level==level)return i;(maybe<0||(0!=assoc?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))&&(maybe=i)}}if(maybe<0)throw new RangeError("Index out of range");return maybe}}function isolatesEq(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++){let iA=a[i],iB=b[i];if(iA.from!=iB.from||iA.to!=iB.to||iA.direction!=iB.direction||!isolatesEq(iA.inner,iB.inner))return!1}return!0}const types=[];function emitSpans(line,from,to,level,baseLevel,isolates,order){let ourType=level%2?2:1;if(level%2==baseLevel%2)for(let iCh=from,iI=0;iCh<to;){let sameDir=!0,isNum=!1;if(iI==isolates.length||iCh<isolates[iI].from){let next=types[iCh];next!=ourType&&(sameDir=!1,isNum=16==next)}let recurse=sameDir||1!=ourType?null:[],localLevel=sameDir?level:level+1,iScan=iCh;run:for(;;)if(iI<isolates.length&&iScan==isolates[iI].from){if(isNum)break run;let iso=isolates[iI];if(!sameDir)for(let upto=iso.to,jI=iI+1;;){if(upto==to)break run;if(!(jI<isolates.length&&isolates[jI].from==upto)){if(types[upto]==ourType)break run;break}upto=isolates[jI++].to}if(iI++,recurse)recurse.push(iso);else{iso.from>iCh&&order.push(new BidiSpan(iCh,iso.from,localLevel)),computeSectionOrder(line,iso.direction==LTR!=!(localLevel%2)?level+1:level,baseLevel,iso.inner,iso.from,iso.to,order),iCh=iso.to}iScan=iso.to}else{if(iScan==to||(sameDir?types[iScan]!=ourType:types[iScan]==ourType))break;iScan++}recurse?emitSpans(line,iCh,iScan,level+1,baseLevel,recurse,order):iCh<iScan&&order.push(new BidiSpan(iCh,iScan,localLevel)),iCh=iScan}else for(let iCh=to,iI=isolates.length;iCh>from;){let sameDir=!0,isNum=!1;if(!iI||iCh>isolates[iI-1].to){let next=types[iCh-1];next!=ourType&&(sameDir=!1,isNum=16==next)}let recurse=sameDir||1!=ourType?null:[],localLevel=sameDir?level:level+1,iScan=iCh;run:for(;;)if(iI&&iScan==isolates[iI-1].to){if(isNum)break run;let iso=isolates[--iI];if(!sameDir)for(let upto=iso.from,jI=iI;;){if(upto==from)break run;if(!jI||isolates[jI-1].to!=upto){if(types[upto-1]==ourType)break run;break}upto=isolates[--jI].from}if(recurse)recurse.push(iso);else{iso.to<iCh&&order.push(new BidiSpan(iso.to,iCh,localLevel)),computeSectionOrder(line,iso.direction==LTR!=!(localLevel%2)?level+1:level,baseLevel,iso.inner,iso.from,iso.to,order),iCh=iso.from}iScan=iso.from}else{if(iScan==from||(sameDir?types[iScan-1]!=ourType:types[iScan-1]==ourType))break;iScan--}recurse?emitSpans(line,iScan,iCh,level+1,baseLevel,recurse,order):iScan<iCh&&order.push(new BidiSpan(iScan,iCh,localLevel)),iCh=iScan}}function computeSectionOrder(line,level,baseLevel,isolates,from,to,order){let outerType=level%2?2:1;!function computeCharTypes(line,rFrom,rTo,isolates,outerType){for(let iI=0;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo,prevType=iI?256:outerType;for(let i=from,prev=prevType,prevStrong=prevType;i<to;i++){let type=charType(line.charCodeAt(i));512==type?type=prev:8==type&&4==prevStrong&&(type=16),types[i]=4==type?2:type,7&type&&(prevStrong=type),prev=type}for(let i=from,prev=prevType,prevStrong=prevType;i<to;i++){let type=types[i];if(128==type)i<to-1&&prev==types[i+1]&&24&prev?type=types[i]=prev:types[i]=256;else if(64==type){let end=i+1;for(;end<to&&64==types[end];)end++;let replace=i&&8==prev||end<rTo&&8==types[end]?1==prevStrong?1:8:256;for(let j=i;j<end;j++)types[j]=replace;i=end-1}else 8==type&&1==prevStrong&&(types[i]=1);prev=type,7&type&&(prevStrong=type)}}}(line,from,to,isolates,outerType),function processBracketPairs(line,rFrom,rTo,isolates,outerType){let oppositeType=1==outerType?2:1;for(let iI=0,sI=0,context=0;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(let ch,br,type,i=from;i<to;i++)if(br=Brackets[ch=line.charCodeAt(i)])if(br<0){for(let sJ=sI-3;sJ>=0;sJ-=3)if(BracketStack[sJ+1]==-br){let flags=BracketStack[sJ+2],type=2&flags?outerType:4&flags?1&flags?oppositeType:outerType:0;type&&(types[i]=types[BracketStack[sJ]]=type),sI=sJ;break}}else{if(189==BracketStack.length)break;BracketStack[sI++]=i,BracketStack[sI++]=ch,BracketStack[sI++]=context}else if(2==(type=types[i])||1==type){let embed=type==outerType;context=embed?0:1;for(let sJ=sI-3;sJ>=0;sJ-=3){let cur=BracketStack[sJ+2];if(2&cur)break;if(embed)BracketStack[sJ+2]|=2;else{if(4&cur)break;BracketStack[sJ+2]|=4}}}}}(line,from,to,isolates,outerType),function processNeutrals(rFrom,rTo,isolates,outerType){for(let iI=0,prev=outerType;iI<=isolates.length;iI++){let from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(let i=from;i<to;){let type=types[i];if(256==type){let end=i+1;for(;;)if(end==to){if(iI==isolates.length)break;end=isolates[iI++].to,to=iI<isolates.length?isolates[iI].from:rTo}else{if(256!=types[end])break;end++}let beforeL=1==prev,replace=beforeL==(1==(end<rTo?types[end]:outerType))?beforeL?1:2:outerType;for(let j=end,jI=iI,fromJ=jI?isolates[jI-1].to:rFrom;j>i;)j==fromJ&&(j=isolates[--jI].from,fromJ=jI?isolates[jI-1].to:rFrom),types[--j]=replace;i=end}else prev=type,i++}}}(from,to,isolates,outerType),emitSpans(line,from,to,level,baseLevel,isolates,order)}function computeOrder(line,direction,isolates){if(!line)return[new BidiSpan(0,0,direction==RTL?1:0)];if(direction==LTR&&!isolates.length&&!BidiRE.test(line))return trivialOrder(line.length);if(isolates.length)for(;line.length>types.length;)types[types.length]=256;let order=[],level=direction==LTR?0:1;return computeSectionOrder(line,level,level,isolates,0,line.length,order),order}function trivialOrder(length){return[new BidiSpan(0,length,0)]}let movedOver="";function moveVisually(line,order,dir,start,forward){var _a;let startIndex=start.head-line.from,spanI=BidiSpan.find(order,startIndex,null!==(_a=start.bidiLevel)&&void 0!==_a?_a:-1,start.assoc),span=order[spanI],spanEnd=span.side(forward,dir);if(startIndex==spanEnd){let nextI=spanI+=forward?1:-1;if(nextI<0||nextI>=order.length)return null;span=order[spanI=nextI],startIndex=span.side(!forward,dir),spanEnd=span.side(forward,dir)}let nextIndex=findClusterBreak(line.text,startIndex,span.forward(forward,dir));(nextIndex<span.from||nextIndex>span.to)&&(nextIndex=spanEnd),movedOver=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));let nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];return nextSpan&&nextIndex==spanEnd&&nextSpan.level+(forward?0:1)<span.level?dist_EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,nextSpan.forward(forward,dir)?1:-1,nextSpan.level):dist_EditorSelection.cursor(nextIndex+line.from,span.forward(forward,dir)?-1:1,span.level)}function autoDirection(text,from,to){for(let i=from;i<to;i++){let type=charType(text.charCodeAt(i));if(1==type)return LTR;if(2==type||4==type)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler=Facet.define(),focusChangeEffect=Facet.define(),perLineTextDirection=Facet.define({combine:values=>values.some((x=>x))}),nativeSelectionHidden=Facet.define({combine:values=>values.some((x=>x))}),scrollHandler=Facet.define();class ScrollTarget{constructor(range,y="nearest",x="nearest",yMargin=5,xMargin=5,isSnapshot=!1){this.range=range,this.y=y,this.x=x,this.yMargin=yMargin,this.xMargin=xMargin,this.isSnapshot=isSnapshot}map(changes){return changes.empty?this:new ScrollTarget(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(state){return this.range.to<=state.doc.length?this:new ScrollTarget(dist_EditorSelection.cursor(state.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView=dist_StateEffect.define({map:(t,ch)=>t.map(ch)});function logException(state,exception,context){let handler=state.facet(exceptionSink);handler.length?handler[0](exception):window.onerror?window.onerror(String(exception),context,void 0,void 0,exception):context?console.error(context+":",exception):console.error(exception)}const editable=Facet.define({combine:values=>!values.length||values[0]});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(id,create,domEventHandlers,domEventObservers,buildExtensions){this.id=id,this.create=create,this.domEventHandlers=domEventHandlers,this.domEventObservers=domEventObservers,this.extension=buildExtensions(this)}static define(create,spec){const{eventHandlers,eventObservers,provide,decorations:deco}=spec||{};return new ViewPlugin(nextPluginID++,create,eventHandlers,eventObservers,(plugin=>{let ext=[viewPlugin.of(plugin)];return deco&&ext.push(decorations.of((view=>{let pluginInst=view.plugin(plugin);return pluginInst?deco(pluginInst):Decoration.none}))),provide&&ext.push(provide(plugin)),ext}))}static fromClass(cls,spec){return ViewPlugin.define((view=>new cls(view)),spec)}}class PluginInstance{constructor(spec){this.spec=spec,this.mustUpdate=null,this.value=null}update(view){if(this.value){if(this.mustUpdate){let update=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(update)}catch(e){if(logException(update.state,e,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(_){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(view)}catch(e){logException(view.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(view){var _a;if(null===(_a=this.value)||void 0===_a?void 0:_a.destroy)try{this.value.destroy()}catch(e){logException(view.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(view,line){let isolates=view.state.facet(bidiIsolatedRanges);if(!isolates.length)return isolates;let sets=isolates.map((i=>i instanceof Function?i(view):i)),result=[];return dist_RangeSet.spans(sets,line.from,line.to,{point(){},span(fromDoc,toDoc,active,open){let from=fromDoc-line.from,to=toDoc-line.from,level=result;for(let i=active.length-1;i>=0;i--,open--){let update,direction=active[i].spec.bidiIsolate;if(null==direction&&(direction=autoDirection(line.text,from,to)),open>0&&level.length&&(update=level[level.length-1]).to==from&&update.direction==direction)update.to=to,level=update.inner;else{let add={from,to,direction,inner:[]};level.push(add),level=add.inner}}}}),result}const scrollMargins=Facet.define();function getScrollMargins(view){let left=0,right=0,top=0,bottom=0;for(let source of view.state.facet(scrollMargins)){let m=source(view);m&&(null!=m.left&&(left=Math.max(left,m.left)),null!=m.right&&(right=Math.max(right,m.right)),null!=m.top&&(top=Math.max(top,m.top)),null!=m.bottom&&(bottom=Math.max(bottom,m.bottom)))}return{left,right,top,bottom}}const styleModule=Facet.define();class ChangedRange{constructor(fromA,toA,fromB,toB){this.fromA=fromA,this.toA=toA,this.fromB=fromB,this.toB=toB}join(other){return new ChangedRange(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB))}addToSet(set){let i=set.length,me=this;for(;i>0;i--){let range=set[i-1];if(!(range.fromA>me.toA)){if(range.toA<me.fromA)break;me=me.join(range),set.splice(i-1,1)}}return set.splice(i,0,me),set}static extendWithRanges(diff,ranges){if(0==ranges.length)return diff;let result=[];for(let dI=0,rI=0,posA=0,posB=0;;dI++){let next=dI==diff.length?null:diff[dI],off=posA-posB,end=next?next.fromB:1e9;for(;rI<ranges.length&&ranges[rI]<end;){let from=ranges[rI],to=ranges[rI+1],fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB&&new ChangedRange(fromB+off,toB+off,fromB,toB).addToSet(result),to>end)break;rI+=2}if(!next)return result;new ChangedRange(next.fromA,next.toA,next.fromB,next.toB).addToSet(result),posA=next.toA,posB=next.toB}}}class ViewUpdate{constructor(view,state,transactions){this.view=view,this.state=state,this.transactions=transactions,this.flags=0,this.startState=view.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let tr of transactions)this.changes=this.changes.compose(tr.changes);let changedRanges=[];this.changes.iterChangedRanges(((fromA,toA,fromB,toB)=>changedRanges.push(new ChangedRange(fromA,toA,fromB,toB)))),this.changedRanges=changedRanges}static create(view,state,transactions){return new ViewUpdate(view,state,transactions)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((tr=>tr.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(view){super(),this.view=view,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(view.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,view.state.doc.length)],0,null)}update(update){var _a;let changedRanges=update.changedRanges;this.minWidth>0&&changedRanges.length&&(changedRanges.every((({fromA,toA})=>toA<this.minWidthFrom||fromA>this.minWidthTo))?(this.minWidthFrom=update.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=update.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let readCompositionAt=-1;this.view.inputState.composing>=0&&((null===(_a=this.domChanged)||void 0===_a?void 0:_a.newSel)?readCompositionAt=this.domChanged.newSel.head:function touchesComposition(changes,composition){let touched=!1;composition&&changes.iterChangedRanges(((from,to)=>{from<composition.to&&to>composition.from&&(touched=!0)}));return touched}(update.changes,this.hasComposition)||update.selectionSet||(readCompositionAt=update.state.selection.main.head));let composition=readCompositionAt>-1?function findCompositionRange(view,changes,headPos){let found=findCompositionNode(view,headPos);if(!found)return null;let{node:textNode,from,to}=found,text=textNode.nodeValue;if(/[\n\r]/.test(text))return null;if(view.state.doc.sliceString(found.from,found.to)!=text)return null;let inv=changes.invertedDesc,range=new ChangedRange(inv.mapPos(from),inv.mapPos(to),from,to),marks=[];for(let parent=textNode.parentNode;;parent=parent.parentNode){let parentView=ContentView.get(parent);if(parentView instanceof MarkView)marks.push({node:parent,deco:parentView.mark});else{if(parentView instanceof LineView||"DIV"==parent.nodeName&&parent.parentNode==view.contentDOM)return{range,text:textNode,marks,line:parent};if(parent==view.contentDOM)return null;marks.push({node:parent,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(parent),tagName:parent.tagName.toLowerCase()})})}}}(this.view,update.changes,readCompositionAt):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from,to}=this.hasComposition;changedRanges=new ChangedRange(from,to,update.changes.mapPos(from,-1),update.changes.mapPos(to,1)).addToSet(changedRanges.slice())}this.hasComposition=composition?{from:composition.range.fromB,to:composition.range.toB}:null,(browser.ie||browser.chrome)&&!composition&&update&&update.state.doc.lines!=update.startState.doc.lines&&(this.forceSelection=!0);let decoDiff=function findChangedDeco(a,b,diff){let comp=new DecorationComparator$1;return dist_RangeSet.compare(a,b,diff,comp),comp.changes}(this.decorations,this.updateDeco(),update.changes);return changedRanges=ChangedRange.extendWithRanges(changedRanges,decoDiff),!!(7&this.flags||0!=changedRanges.length)&&(this.updateInner(changedRanges,update.startState.doc.length,composition),update.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(changes,oldLength,composition){this.view.viewState.mustMeasureContent=!0,this.updateChildren(changes,oldLength,composition);let{observer}=this.view;observer.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let track=browser.chrome||browser.ios?{node:observer.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,track),this.flags&=-8,track&&(track.written||observer.selectionRange.focusNode!=track.node)&&(this.forceSelection=!0),this.dom.style.height=""})),this.markedForComposition.forEach((cView=>cView.flags&=-9));let gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let child of this.children)child instanceof BlockWidgetView&&child.widget instanceof BlockGapWidget&&gaps.push(child.dom);observer.updateGaps(gaps)}updateChildren(changes,oldLength,composition){let ranges=composition?composition.range.addToSet(changes.slice()):changes,cursor=this.childCursor(oldLength);for(let i=ranges.length-1;;i--){let next=i>=0?ranges[i]:null;if(!next)break;let content,breakAtStart,openStart,openEnd,{fromA,toA,fromB,toB}=next;if(composition&&composition.range.fromB<toB&&composition.range.toB>fromB){let before=ContentBuilder.build(this.view.state.doc,fromB,composition.range.fromB,this.decorations,this.dynamicDecorationMap),after=ContentBuilder.build(this.view.state.doc,composition.range.toB,toB,this.decorations,this.dynamicDecorationMap);breakAtStart=before.breakAtStart,openStart=before.openStart,openEnd=after.openEnd;let compLine=this.compositionView(composition);after.breakAtStart?compLine.breakAfter=1:after.content.length&&compLine.merge(compLine.length,compLine.length,after.content[0],!1,after.openStart,0)&&(compLine.breakAfter=after.content[0].breakAfter,after.content.shift()),before.content.length&&compLine.merge(0,0,before.content[before.content.length-1],!0,0,before.openEnd)&&before.content.pop(),content=before.content.concat(compLine).concat(after.content)}else({content,breakAtStart,openStart,openEnd}=ContentBuilder.build(this.view.state.doc,fromB,toB,this.decorations,this.dynamicDecorationMap));let{i:toI,off:toOff}=cursor.findPos(toA,1),{i:fromI,off:fromOff}=cursor.findPos(fromA,-1);replaceRange(this,fromI,fromOff,toI,toOff,content,breakAtStart,openStart,openEnd)}composition&&this.fixCompositionDOM(composition)}compositionView(composition){let cur=new TextView(composition.text.nodeValue);cur.flags|=8;for(let{deco}of composition.marks)cur=new MarkView(deco,[cur],cur.length);let line=new LineView;return line.append(cur,0),line}fixCompositionDOM(composition){let fix=(dom,cView)=>{cView.flags|=8|(cView.children.some((c=>7&c.flags))?1:0),this.markedForComposition.add(cView);let prev=ContentView.get(dom);prev&&prev!=cView&&(prev.dom=null),cView.setDOM(dom)},pos=this.childPos(composition.range.fromB,1),cView=this.children[pos.i];fix(composition.line,cView);for(let i=composition.marks.length-1;i>=-1;i--)pos=cView.childPos(pos.off,1),cView=cView.children[pos.i],fix(i>=0?composition.marks[i].node:composition.text,cView)}updateSelection(mustRead=!1,fromPointer=!1){!mustRead&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let activeElt=this.view.root.activeElement,focused=activeElt==this.dom,selectionNotFocus=!focused&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(activeElt&&this.dom.contains(activeElt));if(!(focused||fromPointer||selectionNotFocus))return;let force=this.forceSelection;this.forceSelection=!1;let main=this.view.state.selection.main,anchor=this.moveToLine(this.domAtPos(main.anchor)),head=main.empty?anchor:this.moveToLine(this.domAtPos(main.head));if(browser.gecko&&main.empty&&!this.hasComposition&&function betweenUneditable(pos){return 1==pos.node.nodeType&&pos.node.firstChild&&(0==pos.offset||"false"==pos.node.childNodes[pos.offset-1].contentEditable)&&(pos.offset==pos.node.childNodes.length||"false"==pos.node.childNodes[pos.offset].contentEditable)}(anchor)){let dummy=document.createTextNode("");this.view.observer.ignore((()=>anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null))),anchor=head=new DOMPos(dummy,0),force=!0}let domSel=this.view.observer.selectionRange;!force&&domSel.focusNode&&(isEquivalentPosition(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)&&isEquivalentPosition(head.node,head.offset,domSel.focusNode,domSel.focusOffset)||this.suppressWidgetCursorChange(domSel,main))||(this.view.observer.ignore((()=>{browser.android&&browser.chrome&&this.dom.contains(domSel.focusNode)&&function inUneditable(node,inside){for(let cur=node;cur&&cur!=inside;cur=cur.assignedSlot||cur.parentNode)if(1==cur.nodeType&&"false"==cur.contentEditable)return!0;return!1}(domSel.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let rawSel=getSelection(this.view.root);if(rawSel)if(main.empty){if(browser.gecko){let nextTo=function nextToUneditable(node,offset){return 1!=node.nodeType?0:(offset&&"false"==node.childNodes[offset-1].contentEditable?1:0)|(offset<node.childNodes.length&&"false"==node.childNodes[offset].contentEditable?2:0)}(anchor.node,anchor.offset);if(nextTo&&3!=nextTo){let text=(1==nextTo?textNodeBefore:textNodeAfter)(anchor.node,anchor.offset);text&&(anchor=new DOMPos(text.node,text.offset))}}rawSel.collapse(anchor.node,anchor.offset),null!=main.bidiLevel&&void 0!==rawSel.caretBidiLevel&&(rawSel.caretBidiLevel=main.bidiLevel)}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);try{rawSel.extend(head.node,head.offset)}catch(_){}}else{let range=document.createRange();main.anchor>main.head&&([anchor,head]=[head,anchor]),range.setEnd(head.node,head.offset),range.setStart(anchor.node,anchor.offset),rawSel.removeAllRanges(),rawSel.addRange(range)}else;selectionNotFocus&&this.view.root.activeElement==this.dom&&(this.dom.blur(),activeElt&&activeElt.focus())})),this.view.observer.setSelectionRange(anchor,head)),this.impreciseAnchor=anchor.precise?null:new DOMPos(domSel.anchorNode,domSel.anchorOffset),this.impreciseHead=head.precise?null:new DOMPos(domSel.focusNode,domSel.focusOffset)}suppressWidgetCursorChange(sel,cursor){return this.hasComposition&&cursor.empty&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)&&this.posFromDOM(sel.focusNode,sel.focusOffset)==cursor.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view}=this,cursor=view.state.selection.main,sel=getSelection(view.root),{anchorNode,anchorOffset}=view.observer.selectionRange;if(!(sel&&cursor.empty&&cursor.assoc&&sel.modify))return;let line=LineView.find(this,cursor.head);if(!line)return;let lineStart=line.posAtStart;if(cursor.head==lineStart||cursor.head==lineStart+line.length)return;let before=this.coordsAt(cursor.head,-1),after=this.coordsAt(cursor.head,1);if(!before||!after||before.bottom>after.top)return;let dom=this.domAtPos(cursor.head+cursor.assoc);sel.collapse(dom.node,dom.offset),sel.modify("move",cursor.assoc<0?"forward":"backward","lineboundary"),view.observer.readSelectionRange();let newRange=view.observer.selectionRange;view.docView.posFromDOM(newRange.anchorNode,newRange.anchorOffset)!=cursor.from&&sel.collapse(anchorNode,anchorOffset)}moveToLine(pos){let newPos,dom=this.dom;if(pos.node!=dom)return pos;for(let i=pos.offset;!newPos&&i<dom.childNodes.length;i++){let view=ContentView.get(dom.childNodes[i]);view instanceof LineView&&(newPos=view.domAtPos(0))}for(let i=pos.offset-1;!newPos&&i>=0;i--){let view=ContentView.get(dom.childNodes[i]);view instanceof LineView&&(newPos=view.domAtPos(view.length))}return newPos?new DOMPos(newPos.node,newPos.offset,!0):pos}nearest(dom){for(let cur=dom;cur;){let domView=ContentView.get(cur);if(domView&&domView.rootView==this)return domView;cur=cur.parentNode}return null}posFromDOM(node,offset){let view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart}domAtPos(pos){let{i,off}=this.childCursor().findPos(pos,-1);for(;i<this.children.length-1;){let child=this.children[i];if(off<child.length||child instanceof LineView)break;i++,off=0}return this.children[i].domAtPos(off)}coordsAt(pos,side){let best=null,bestPos=0;for(let off=this.length,i=this.children.length-1;i>=0;i--){let child=this.children[i],end=off-child.breakAfter,start=end-child.length;if(end<pos)break;start<=pos&&(start<pos||child.covers(-1))&&(end>pos||child.covers(1))&&(!best||child instanceof LineView&&!(best instanceof LineView&&side>=0))&&(best=child,bestPos=start),off=start}return best?best.coordsAt(pos-bestPos,side):null}coordsForChar(pos){let{i,off}=this.childPos(pos,1),child=this.children[i];if(!(child instanceof LineView))return null;for(;child.children.length;){let{i,off:childOff}=child.childPos(off,1);for(;;i++){if(i==child.children.length)return null;if((child=child.children[i]).length)break}off=childOff}if(!(child instanceof TextView))return null;let end=findClusterBreak(child.text,off);if(end==off)return null;let rects=textRange(child.dom,off,end).getClientRects();for(let i=0;i<rects.length;i++){let rect=rects[i];if(i==rects.length-1||rect.top<rect.bottom&&rect.left<rect.right)return rect}return null}measureVisibleLineHeights(viewport){let result=[],{from,to}=viewport,contentWidth=this.view.contentDOM.clientWidth,isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,widest=-1,ltr=this.view.textDirection==Direction.LTR;for(let pos=0,i=0;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(end>to)break;if(pos>=from){let childRect=child.dom.getBoundingClientRect();if(result.push(childRect.height),isWider){let last=child.dom.lastChild,rects=last?clientRectsFor(last):[];if(rects.length){let rect=rects[rects.length-1],width=ltr?rect.right-childRect.left:childRect.right-rect.left;width>widest&&(widest=width,this.minWidth=contentWidth,this.minWidthFrom=pos,this.minWidthTo=end)}}}pos=end+child.breakAfter}return result}textDirectionAt(pos){let{i}=this.childPos(pos,1);return"rtl"==getComputedStyle(this.children[i].dom).direction?Direction.RTL:Direction.LTR}measureTextSize(){for(let child of this.children)if(child instanceof LineView){let measure=child.measureTextSize();if(measure)return measure}let lineHeight,charWidth,textHeight,dummy=document.createElement("div");return dummy.className="cm-line",dummy.style.width="99999px",dummy.style.position="absolute",dummy.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(dummy);let rect=clientRectsFor(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height,charWidth=rect?rect.width/27:7,textHeight=rect?rect.height:lineHeight,dummy.remove()})),{lineHeight,charWidth,textHeight}}childCursor(pos=this.length){let i=this.children.length;return i&&(pos-=this.children[--i].length),new ChildCursor(this.children,pos,i)}computeBlockGapDeco(){let deco=[],vs=this.view.viewState;for(let pos=0,i=0;;i++){let next=i==vs.viewports.length?null:vs.viewports[i],end=next?next.from-1:this.length;if(end>pos){let height=(vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top)/this.view.scaleY;deco.push(Decoration.replace({widget:new BlockGapWidget(height),block:!0,inclusive:!0,isBlockGap:!0}).range(pos,end))}if(!next)break;pos=next.to+1}return Decoration.set(deco)}updateDeco(){let i=0,allDeco=this.view.state.facet(decorations).map((d=>(this.dynamicDecorationMap[i++]="function"==typeof d)?d(this.view):d)),dynamicOuter=!1,outerDeco=this.view.state.facet(outerDecorations).map(((d,i)=>{let dynamic="function"==typeof d;return dynamic&&(dynamicOuter=!0),dynamic?d(this.view):d}));for(outerDeco.length&&(this.dynamicDecorationMap[i++]=dynamicOuter,allDeco.push(dist_RangeSet.join(outerDeco))),this.decorations=[...allDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];i<this.decorations.length;)this.dynamicDecorationMap[i++]=!1;return this.decorations}scrollIntoView(target){if(target.isSnapshot){let ref=this.view.viewState.lineBlockAt(target.range.head);return this.view.scrollDOM.scrollTop=ref.top-target.yMargin,void(this.view.scrollDOM.scrollLeft=target.xMargin)}for(let handler of this.view.state.facet(scrollHandler))try{if(handler(this.view,target.range,target))return!0}catch(e){logException(this.view.state,e,"scroll handler")}let other,{range}=target,rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1);if(!rect)return;!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1))&&(rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)});let margins=getScrollMargins(this.view),targetRect={left:rect.left-margins.left,top:rect.top-margins.top,right:rect.right+margins.right,bottom:rect.bottom+margins.bottom},{offsetWidth,offsetHeight}=this.view.scrollDOM;!function scrollRectIntoView(dom,rect,side,x,y,xMargin,yMargin,ltr){let doc=dom.ownerDocument,win=doc.defaultView||window;for(let cur=dom,stop=!1;cur&&!stop;)if(1==cur.nodeType){let bounding,top=cur==doc.body,scaleX=1,scaleY=1;if(top)bounding=windowRect(win);else{if(/^(fixed|sticky)$/.test(getComputedStyle(cur).position)&&(stop=!0),cur.scrollHeight<=cur.clientHeight&&cur.scrollWidth<=cur.clientWidth){cur=cur.assignedSlot||cur.parentNode;continue}let rect=cur.getBoundingClientRect();({scaleX,scaleY}=getScale(cur,rect)),bounding={left:rect.left,right:rect.left+cur.clientWidth*scaleX,top:rect.top,bottom:rect.top+cur.clientHeight*scaleY}}let moveX=0,moveY=0;if("nearest"==y)rect.top<bounding.top?(moveY=-(bounding.top-rect.top+yMargin),side>0&&rect.bottom>bounding.bottom+moveY&&(moveY=rect.bottom-bounding.bottom+moveY+yMargin)):rect.bottom>bounding.bottom&&(moveY=rect.bottom-bounding.bottom+yMargin,side<0&&rect.top-moveY<bounding.top&&(moveY=-(bounding.top+moveY-rect.top+yMargin)));else{let rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;moveY=("center"==y&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:"start"==y||"center"==y&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin)-bounding.top}if("nearest"==x?rect.left<bounding.left?(moveX=-(bounding.left-rect.left+xMargin),side>0&&rect.right>bounding.right+moveX&&(moveX=rect.right-bounding.right+moveX+xMargin)):rect.right>bounding.right&&(moveX=rect.right-bounding.right+xMargin,side<0&&rect.left<bounding.left+moveX&&(moveX=-(bounding.left+moveX-rect.left+xMargin))):moveX=("center"==x?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:"start"==x==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin)-bounding.left,moveX||moveY)if(top)win.scrollBy(moveX,moveY);else{let movedX=0,movedY=0;if(moveY){let start=cur.scrollTop;cur.scrollTop+=moveY/scaleY,movedY=(cur.scrollTop-start)*scaleY}if(moveX){let start=cur.scrollLeft;cur.scrollLeft+=moveX/scaleX,movedX=(cur.scrollLeft-start)*scaleX}rect={left:rect.left-movedX,top:rect.top-movedY,right:rect.right-movedX,bottom:rect.bottom-movedY},movedX&&Math.abs(movedX-moveX)<1&&(x="nearest"),movedY&&Math.abs(movedY-moveY)<1&&(y="nearest")}if(top)break;cur=cur.assignedSlot||cur.parentNode}else{if(11!=cur.nodeType)break;cur=cur.host}}(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,Math.max(Math.min(target.xMargin,offsetWidth),-offsetWidth),Math.max(Math.min(target.yMargin,offsetHeight),-offsetHeight),this.view.textDirection==Direction.LTR)}}class BlockGapWidget extends WidgetType{constructor(height){super(),this.height=height}toDOM(){let elt=document.createElement("div");return elt.className="cm-gap",this.updateDOM(elt),elt}eq(other){return other.height==this.height}updateDOM(elt){return elt.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function findCompositionNode(view,headPos){let sel=view.observer.selectionRange;if(!sel.focusNode)return null;let textBefore=textNodeBefore(sel.focusNode,sel.focusOffset),textAfter=textNodeAfter(sel.focusNode,sel.focusOffset),textNode=textBefore||textAfter;if(textAfter&&textBefore&&textAfter.node!=textBefore.node){let descAfter=ContentView.get(textAfter.node);if(!descAfter||descAfter instanceof TextView&&descAfter.text!=textAfter.node.nodeValue)textNode=textAfter;else if(view.docView.lastCompositionAfterCursor){let descBefore=ContentView.get(textBefore.node);!descBefore||descBefore instanceof TextView&&descBefore.text!=textBefore.node.nodeValue||(textNode=textAfter)}}if(view.docView.lastCompositionAfterCursor=textNode!=textBefore,!textNode)return null;let from=headPos-textNode.offset;return{from,to:from+textNode.node.nodeValue.length,node:textNode.node}}let DecorationComparator$1=class DecorationComparator{constructor(){this.changes=[]}compareRange(from,to){addRange(from,to,this.changes)}comparePoint(from,to){addRange(from,to,this.changes)}};function getdx(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right)}function getdy(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom)}function yOverlap(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1}function upTop(rect,top){return top<rect.top?{top,left:rect.left,right:rect.right,bottom:rect.bottom}:rect}function upBot(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom}:rect}function domPosAtCoords(parent,x,y){let closest,closestRect,closestX,closestY,above,below,aboveRect,belowRect,closestOverlap=!1;for(let child=parent.firstChild;child;child=child.nextSibling){let rects=clientRectsFor(child);for(let i=0;i<rects.length;i++){let rect=rects[i];closestRect&&yOverlap(closestRect,rect)&&(rect=upTop(upBot(rect,closestRect.bottom),closestRect.top));let dx=getdx(x,rect),dy=getdy(y,rect);if(0==dx&&0==dy)return 3==child.nodeType?domPosInText(child,x,y):domPosAtCoords(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child,closestRect=rect,closestX=dx,closestY=dy;let side=dy?y<rect.top?-1:1:dx?x<rect.left?-1:1:0;closestOverlap=!side||(side>0?i<rects.length-1:i>0)}0==dx?y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)?(above=child,aboveRect=rect):y<rect.top&&(!belowRect||belowRect.top>rect.top)&&(below=child,belowRect=rect):aboveRect&&yOverlap(aboveRect,rect)?aboveRect=upBot(aboveRect,rect.bottom):belowRect&&yOverlap(belowRect,rect)&&(belowRect=upTop(belowRect,rect.top))}}if(aboveRect&&aboveRect.bottom>=y?(closest=above,closestRect=aboveRect):belowRect&&belowRect.top<=y&&(closest=below,closestRect=belowRect),!closest)return{node:parent,offset:0};let clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));return 3==closest.nodeType?domPosInText(closest,clipX,y):closestOverlap&&"false"!=closest.contentEditable?domPosAtCoords(closest,clipX,y):{node:parent,offset:Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0)}}function domPosInText(node,x,y){let len=node.nodeValue.length,closestOffset=-1,closestDY=1e9,generalSide=0;for(let i=0;i<len;i++){let rects=textRange(node,i,i+1).getClientRects();for(let j=0;j<rects.length;j++){let rect=rects[j];if(rect.top==rect.bottom)continue;generalSide||(generalSide=x-rect.left);let dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){let right=x>=(rect.left+rect.right)/2,after=right;if(browser.chrome||browser.gecko){textRange(node,i).getBoundingClientRect().left==rect.right&&(after=!right)}if(dy<=0)return{node,offset:i+(after?1:0)};closestOffset=i+(after?1:0),closestDY=dy}}}return{node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0}}function posAtCoords(view,coords,precise,bias=-1){var _a,_b;let block,content=view.contentDOM.getBoundingClientRect(),docTop=content.top+view.viewState.paddingTop,{docHeight}=view.viewState,{x,y}=coords,yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(let halfLine=view.viewState.heightOracle.textHeight/2,bounced=!1;block=view.elementAtHeight(yOffset),block.type!=BlockType.Text;)for(;yOffset=bias>0?block.bottom+halfLine:block.top-halfLine,!(yOffset>=0&&yOffset<=docHeight);){if(bounced)return precise?null:0;bounced=!0,bias=-bias}y=docTop+yOffset;let lineStart=block.from;if(lineStart<view.viewport.from)return 0==view.viewport.from?0:precise?null:posAtCoordsImprecise(view,content,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise(view,content,block,x,y);let doc=view.dom.ownerDocument,root=view.root.elementFromPoint?view.root:doc,element=root.elementFromPoint(x,y);element&&!view.contentDOM.contains(element)&&(element=null),element||(x=Math.max(content.left+1,Math.min(content.right-1,x)),element=root.elementFromPoint(x,y),element&&!view.contentDOM.contains(element)&&(element=null));let node,offset=-1;if(element&&0!=(null===(_a=view.docView.nearest(element))||void 0===_a?void 0:_a.isEditable))if(doc.caretPositionFromPoint){let pos=doc.caretPositionFromPoint(x,y);pos&&({offsetNode:node,offset}=pos)}else if(doc.caretRangeFromPoint){let range=doc.caretRangeFromPoint(x,y);range&&(({startContainer:node,startOffset:offset}=range),(!view.contentDOM.contains(node)||browser.safari&&function isSuspiciousSafariCaretResult(node,offset,x){let len;if(3!=node.nodeType||offset!=(len=node.nodeValue.length))return!1;for(let next=node.nextSibling;next;next=next.nextSibling)if(1!=next.nodeType||"BR"!=next.nodeName)return!1;return textRange(node,len-1,len).getBoundingClientRect().left>x}(node,offset,x)||browser.chrome&&function isSuspiciousChromeCaretResult(node,offset,x){if(0!=offset)return!1;for(let cur=node;;){let parent=cur.parentNode;if(!parent||1!=parent.nodeType||parent.firstChild!=cur)return!1;if(parent.classList.contains("cm-line"))break;cur=parent}let rect=1==node.nodeType?node.getBoundingClientRect():textRange(node,0,Math.max(node.nodeValue.length,1)).getBoundingClientRect();return x-rect.left>5}(node,offset,x))&&(node=void 0))}if(!node||!view.docView.dom.contains(node)){let line=LineView.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;({node,offset}=domPosAtCoords(line.dom,x,y))}let nearest=view.docView.nearest(node);if(!nearest)return null;if(nearest.isWidget&&1==(null===(_b=nearest.dom)||void 0===_b?void 0:_b.nodeType)){let rect=nearest.dom.getBoundingClientRect();return coords.y<rect.top||coords.y<=rect.bottom&&coords.x<=(rect.left+rect.right)/2?nearest.posAtStart:nearest.posAtEnd}return nearest.localPosFromDOM(node,offset)+nearest.posAtStart}function posAtCoordsImprecise(view,contentRect,block,x,y){let into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>1.5*view.defaultLineHeight){let textHeight=view.viewState.heightOracle.textHeight;into+=Math.floor((y-block.top-.5*(view.defaultLineHeight-textHeight))/textHeight)*view.viewState.heightOracle.lineLength}let content=view.state.sliceDoc(block.from,block.to);return block.from+function dist_findColumn(string,col,tabSize,strict){for(let i=0,n=0;;){if(n>=col)return i;if(i==string.length)break;n+=9==string.charCodeAt(i)?tabSize-n%tabSize:1,i=findClusterBreak(string,i)}return!0===strict?-1:string.length}(content,into,view.state.tabSize)}function blockAt(view,pos){let line=view.lineBlockAt(pos);if(Array.isArray(line.type))for(let l of line.type)if(l.to>pos||l.to==pos&&(l.to==line.to||l.type==BlockType.Text))return l;return line}function moveByChar(view,start,forward,by){let line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line),direction=view.textDirectionAt(line.from);for(let cur=start,check=null;;){let next=moveVisually(line,spans,direction,cur,forward),char=movedOver;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur;char="\n",line=view.state.doc.line(line.number+(forward?1:-1)),spans=view.bidiSpans(line),next=view.visualLineSide(line,!forward)}if(check){if(!check(char))return cur}else{if(!by)return next;check=by(char)}cur=next}}function skipAtomicRanges(atoms,pos,bias){for(;;){let moved=0;for(let set of atoms)set.between(pos-1,pos+1,((from,to,value)=>{if(pos>from&&pos<to){let side=moved||bias||(pos-from<to-pos?-1:1);pos=side<0?from:to,moved=side}}));if(!moved)return pos}}function skipAtoms(view,oldPos,pos){let newPos=skipAtomicRanges(view.state.facet(atomicRanges).map((f=>f(view))),pos.from,oldPos.head>pos.from?-1:1);return newPos==pos.from?pos:dist_EditorSelection.cursor(newPos,newPos<pos.from?1:-1)}class InputState{setSelectionOrigin(origin){this.lastSelectionOrigin=origin,this.lastSelectionTime=Date.now()}constructor(view){this.view=view,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=view.hasFocus,browser.safari&&view.contentDOM.addEventListener("input",(()=>null)),browser.gecko&&function firefoxCopyCutHack(doc){appliedFirefoxHack.has(doc)||(appliedFirefoxHack.add(doc),doc.addEventListener("copy",(()=>{})),doc.addEventListener("cut",(()=>{})))}(view.contentDOM.ownerDocument)}handleEvent(event){(function eventBelongsToEditor(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let cView,node=event.target;node!=view.contentDOM;node=node.parentNode)if(!node||11==node.nodeType||(cView=ContentView.get(node))&&cView.ignoreEvent(event))return!1;return!0})(this.view,event)&&!this.ignoreDuringComposition(event)&&("keydown"==event.type&&this.keydown(event)||this.runHandlers(event.type,event))}runHandlers(type,event){let handlers=this.handlers[type];if(handlers){for(let observer of handlers.observers)observer(this.view,event);for(let handler of handlers.handlers){if(event.defaultPrevented)break;if(handler(this.view,event)){event.preventDefault();break}}}}ensureHandlers(plugins){let handlers=computeHandlers(plugins),prev=this.handlers,dom=this.view.contentDOM;for(let type in handlers)if("scroll"!=type){let passive=!handlers[type].handlers.length,exists=prev[type];exists&&passive!=!exists.handlers.length&&(dom.removeEventListener(type,this.handleEvent),exists=null),exists||dom.addEventListener(type,this.handleEvent,{passive})}for(let type in prev)"scroll"==type||handlers[type]||dom.removeEventListener(type,this.handleEvent);this.handlers=handlers}keydown(event){if(this.lastKeyCode=event.keyCode,this.lastKeyTime=Date.now(),9==event.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(27!=event.keyCode&&modifierCodes.indexOf(event.keyCode)<0&&(this.view.inputState.lastEscPress=0),browser.android&&browser.chrome&&!event.synthetic&&(13==event.keyCode||8==event.keyCode))return this.view.observer.delayAndroidKey(event.key,event.keyCode),!0;let pending;return!browser.ios||event.synthetic||event.altKey||event.metaKey||!((pending=PendingKeys.find((key=>key.keyCode==event.keyCode)))&&!event.ctrlKey||EmacsyPendingKeys.indexOf(event.key)>-1&&event.ctrlKey&&!event.shiftKey)?(229!=event.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=pending||event,setTimeout((()=>this.flushIOSKey()),250),!0)}flushIOSKey(change){let key=this.pendingIOSKey;return!!key&&(!("Enter"==key.key&&change&&change.from<change.to&&/^\S+$/.test(change.insert.toString()))&&(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,key.key,key.keyCode,key instanceof KeyboardEvent?key:void 0)))}ignoreDuringComposition(event){return!!/^key/.test(event.type)&&(this.composing>0||!!(browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(mouseSelection){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=mouseSelection}update(update){this.mouseSelection&&this.mouseSelection.update(update),this.draggedContent&&update.docChanged&&(this.draggedContent=this.draggedContent.map(update.changes)),update.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(plugin,handler){return(view,event)=>{try{return handler.call(plugin,event,view)}catch(e){logException(view.state,e)}}}function computeHandlers(plugins){let result=Object.create(null);function record(type){return result[type]||(result[type]={observers:[],handlers:[]})}for(let plugin of plugins){let spec=plugin.spec;if(spec&&spec.domEventHandlers)for(let type in spec.domEventHandlers){let f=spec.domEventHandlers[type];f&&record(type).handlers.push(bindHandler(plugin.value,f))}if(spec&&spec.domEventObservers)for(let type in spec.domEventObservers){let f=spec.domEventObservers[type];f&&record(type).observers.push(bindHandler(plugin.value,f))}}for(let type in handlers)record(type).handlers.push(handlers[type]);for(let type in observers)record(type).observers.push(observers[type]);return result}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225];function dragScrollSpeed(dist){return.7*Math.max(0,dist)+8}class MouseSelection{constructor(view,startEvent,style,mustSelect){this.view=view,this.startEvent=startEvent,this.style=style,this.mustSelect=mustSelect,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=startEvent,this.scrollParent=function scrollableParent(dom){let doc=dom.ownerDocument;for(let cur=dom.parentNode;cur&&cur!=doc.body;)if(1==cur.nodeType){if(cur.scrollHeight>cur.clientHeight||cur.scrollWidth>cur.clientWidth)return cur;cur=cur.assignedSlot||cur.parentNode}else{if(11!=cur.nodeType)break;cur=cur.host}return null}(view.contentDOM),this.atoms=view.state.facet(atomicRanges).map((f=>f(view)));let doc=view.contentDOM.ownerDocument;doc.addEventListener("mousemove",this.move=this.move.bind(this)),doc.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=startEvent.shiftKey,this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&function addsSelectionRange(view,event){let facet=view.state.facet(clickAddsSelectionRange);return facet.length?facet[0](event):browser.mac?event.metaKey:event.ctrlKey}(view,startEvent),this.dragging=!(!function isInPrimarySelection(view,event){let{main}=view.state.selection;if(main.empty)return!1;let sel=getSelection(view.root);if(!sel||0==sel.rangeCount)return!0;let rects=sel.getRangeAt(0).getClientRects();for(let i=0;i<rects.length;i++){let rect=rects[i];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return!0}return!1}(view,startEvent)||1!=getClickType(startEvent))&&null}start(event){!1===this.dragging&&this.select(event)}move(event){var _a;if(0==event.buttons)return this.destroy();if(this.dragging||null==this.dragging&&function dist(a,b){return Math.max(Math.abs(a.clientX-b.clientX),Math.abs(a.clientY-b.clientY))}(this.startEvent,event)<10)return;this.select(this.lastEvent=event);let sx=0,sy=0,rect=(null===(_a=this.scrollParent)||void 0===_a?void 0:_a.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},margins=getScrollMargins(this.view);event.clientX-margins.left<=rect.left+6?sx=-dragScrollSpeed(rect.left-event.clientX):event.clientX+margins.right>=rect.right-6&&(sx=dragScrollSpeed(event.clientX-rect.right)),event.clientY-margins.top<=rect.top+6?sy=-dragScrollSpeed(rect.top-event.clientY):event.clientY+margins.bottom>=rect.bottom-6&&(sy=dragScrollSpeed(event.clientY-rect.bottom)),this.setScrollSpeed(sx,sy)}up(event){null==this.dragging&&this.select(this.lastEvent),this.dragging||event.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let doc=this.view.contentDOM.ownerDocument;doc.removeEventListener("mousemove",this.move),doc.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(sx,sy){this.scrollSpeed={x:sx,y:sy},sx||sy?this.scrolling<0&&(this.scrolling=setInterval((()=>this.scroll()),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),!1===this.dragging&&this.select(this.lastEvent)}skipAtoms(sel){let ranges=null;for(let i=0;i<sel.ranges.length;i++){let range=sel.ranges[i],updated=null;if(range.empty){let pos=skipAtomicRanges(this.atoms,range.from,0);pos!=range.from&&(updated=dist_EditorSelection.cursor(pos,-1))}else{let from=skipAtomicRanges(this.atoms,range.from,-1),to=skipAtomicRanges(this.atoms,range.to,1);from==range.from&&to==range.to||(updated=dist_EditorSelection.range(range.from==range.anchor?from:to,range.from==range.head?from:to))}updated&&(ranges||(ranges=sel.ranges.slice()),ranges[i]=updated)}return ranges?dist_EditorSelection.create(ranges,sel.mainIndex):sel}select(event){let{view}=this,selection=this.skipAtoms(this.style.get(event,this.extend,this.multiple));!this.mustSelect&&selection.eq(view.state.selection,!1===this.dragging)||this.view.dispatch({selection,userEvent:"select.pointer"}),this.mustSelect=!1}update(update){this.style.update(update)&&setTimeout((()=>this.select(this.lastEvent)),20)}}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function doPaste(view,input){let changes,{state}=view,i=1,text=state.toText(input),byLine=text.lines==state.selection.ranges.length;if(null!=lastLinewiseCopy&&state.selection.ranges.every((r=>r.empty))&&lastLinewiseCopy==text.toString()){let lastLine=-1;changes=state.changeByRange((range=>{let line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range};lastLine=line.from;let insert=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert},range:dist_EditorSelection.cursor(range.from+insert.length)}}))}else changes=byLine?state.changeByRange((range=>{let line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:dist_EditorSelection.cursor(range.from+line.length)}})):state.replaceSelection(text);view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:!0})}function rangeForClick(view,pos,bias,type){if(1==type)return dist_EditorSelection.cursor(pos,bias);if(2==type)return function groupAt(state,pos,bias=1){let categorize=state.charCategorizer(pos),line=state.doc.lineAt(pos),linePos=pos-line.from;if(0==line.length)return dist_EditorSelection.cursor(pos);0==linePos?bias=1:linePos==line.length&&(bias=-1);let from=linePos,to=linePos;bias<0?from=findClusterBreak(line.text,linePos,!1):to=findClusterBreak(line.text,linePos);let cat=categorize(line.text.slice(from,to));for(;from>0;){let prev=findClusterBreak(line.text,from,!1);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev}for(;to<line.length;){let next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next}return dist_EditorSelection.range(from+line.from,to+line.from)}(view.state,pos,bias);{let visual=LineView.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos),from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;return to<view.state.doc.length&&to==line.to&&to++,dist_EditorSelection.range(from,to)}}observers.scroll=view=>{view.inputState.lastScrollTop=view.scrollDOM.scrollTop,view.inputState.lastScrollLeft=view.scrollDOM.scrollLeft},handlers.keydown=(view,event)=>(view.inputState.setSelectionOrigin("select"),27==event.keyCode&&(view.inputState.lastEscPress=Date.now()),!1),observers.touchstart=(view,e)=>{view.inputState.lastTouchTime=Date.now(),view.inputState.setSelectionOrigin("select.pointer")},observers.touchmove=view=>{view.inputState.setSelectionOrigin("select.pointer")},handlers.mousedown=(view,event)=>{if(view.observer.flush(),view.inputState.lastTouchTime>Date.now()-2e3)return!1;let style=null;for(let makeStyle of view.state.facet(mouseSelectionStyle))if(style=makeStyle(view,event),style)break;if(style||0!=event.button||(style=function basicMouseSelection(view,event){let start=queryPos(view,event),type=getClickType(event),startSel=view.state.selection;return{update(update){update.docChanged&&(start.pos=update.changes.mapPos(start.pos),startSel=startSel.map(update.changes))},get(event,extend,multiple){let removed,cur=queryPos(view,event),range=rangeForClick(view,cur.pos,cur.bias,type);if(start.pos!=cur.pos&&!extend){let startRange=rangeForClick(view,start.pos,start.bias,type),from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?dist_EditorSelection.range(from,to):dist_EditorSelection.range(to,from)}return extend?startSel.replaceRange(startSel.main.extend(range.from,range.to)):multiple&&1==type&&startSel.ranges.length>1&&(removed=function removeRangeAround(sel,pos){for(let i=0;i<sel.ranges.length;i++){let{from,to}=sel.ranges[i];if(from<=pos&&to>=pos)return dist_EditorSelection.create(sel.ranges.slice(0,i).concat(sel.ranges.slice(i+1)),sel.mainIndex==i?0:sel.mainIndex-(sel.mainIndex>i?1:0))}return null}(startSel,cur.pos))?removed:multiple?startSel.addRange(range):dist_EditorSelection.create([range])}}}(view,event)),style){let mustFocus=!view.hasFocus;view.inputState.startMouseSelection(new MouseSelection(view,event,style,mustFocus)),mustFocus&&view.observer.ignore((()=>focusPreventScroll(view.contentDOM)));let mouseSel=view.inputState.mouseSelection;if(mouseSel)return mouseSel.start(event),!1===mouseSel.dragging}return!1};let insideY=(y,rect)=>y>=rect.top&&y<=rect.bottom,inside=(x,y,rect)=>insideY(y,rect)&&x>=rect.left&&x<=rect.right;function findPositionSide(view,pos,x,y){let line=LineView.find(view.docView,pos);if(!line)return 1;let off=pos-line.posAtStart;if(0==off)return 1;if(off==line.length)return-1;let before=line.coordsAt(off,-1);if(before&&inside(x,y,before))return-1;let after=line.coordsAt(off,1);return after&&inside(x,y,after)?1:before&&insideY(y,before)?-1:1}function queryPos(view,event){let pos=view.posAtCoords({x:event.clientX,y:event.clientY},!1);return{pos,bias:findPositionSide(view,pos,event.clientX,event.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(event){if(!BadMouseDetail)return event.detail;let last=lastMouseDown,lastTime=lastMouseDownTime;return lastMouseDown=event,lastMouseDownTime=Date.now(),lastMouseDownCount=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount+1)%3:1}function dropText(view,event,text,direct){if(!text)return;let dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},!1),{draggedContent}=view.inputState,del=direct&&draggedContent&&function dragMovesSelection(view,event){let facet=view.state.facet(dragMovesSelection$1);return facet.length?facet[0](event):browser.mac?!event.altKey:!event.ctrlKey}(view,event)?{from:draggedContent.from,to:draggedContent.to}:null,ins={from:dropPos,insert:text},changes=view.state.changes(del?[del,ins]:ins);view.focus(),view.dispatch({changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"}),view.inputState.draggedContent=null}handlers.dragstart=(view,event)=>{let{selection:{main:range}}=view.state;if(event.target.draggable){let cView=view.docView.nearest(event.target);if(cView&&cView.isWidget){let from=cView.posAtStart,to=from+cView.length;(from>=range.to||to<=range.from)&&(range=dist_EditorSelection.range(from,to))}}let{inputState}=view;return inputState.mouseSelection&&(inputState.mouseSelection.dragging=!0),inputState.draggedContent=range,event.dataTransfer&&(event.dataTransfer.setData("Text",view.state.sliceDoc(range.from,range.to)),event.dataTransfer.effectAllowed="copyMove"),!1},handlers.dragend=view=>(view.inputState.draggedContent=null,!1),handlers.drop=(view,event)=>{if(!event.dataTransfer)return!1;if(view.state.readOnly)return!0;let files=event.dataTransfer.files;if(files&&files.length){let text=Array(files.length),read=0,finishFile=()=>{++read==files.length&&dropText(view,event,text.filter((s=>null!=s)).join(view.state.lineBreak),!1)};for(let i=0;i<files.length;i++){let reader=new FileReader;reader.onerror=finishFile,reader.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result)||(text[i]=reader.result),finishFile()},reader.readAsText(files[i])}return!0}{let text=event.dataTransfer.getData("Text");if(text)return dropText(view,event,text,!0),!0}return!1},handlers.paste=(view,event)=>{if(view.state.readOnly)return!0;view.observer.flush();let data=brokenClipboardAPI?null:event.clipboardData;return data?(doPaste(view,data.getData("text/plain")||data.getData("text/uri-list")),!0):(function capturePaste(view){let parent=view.dom.parentNode;if(!parent)return;let target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus(),setTimeout((()=>{view.focus(),target.remove(),doPaste(view,target.value)}),50)}(view),!1)};let lastLinewiseCopy=null;handlers.copy=handlers.cut=(view,event)=>{let{text,ranges,linewise}=function copiedRange(state){let content=[],ranges=[],linewise=!1;for(let range of state.selection.ranges)range.empty||(content.push(state.sliceDoc(range.from,range.to)),ranges.push(range));if(!content.length){let upto=-1;for(let{from}of state.selection.ranges){let line=state.doc.lineAt(from);line.number>upto&&(content.push(line.text),ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)})),upto=line.number}linewise=!0}return{text:content.join(state.lineBreak),ranges,linewise}}(view.state);if(!text&&!linewise)return!1;lastLinewiseCopy=linewise?text:null,"cut"!=event.type||view.state.readOnly||view.dispatch({changes:ranges,scrollIntoView:!0,userEvent:"delete.cut"});let data=brokenClipboardAPI?null:event.clipboardData;return data?(data.clearData(),data.setData("text/plain",text),!0):(function captureCopy(view,text){let parent=view.dom.parentNode;if(!parent)return;let target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px",target.value=text,target.focus(),target.selectionEnd=text.length,target.selectionStart=0,setTimeout((()=>{target.remove(),view.focus()}),50)}(view,text),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(state,focus){let effects=[];for(let getEffect of state.facet(focusChangeEffect)){let effect=getEffect(state,focus);effect&&effects.push(effect)}return effects?state.update({effects,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(view){setTimeout((()=>{let focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){let tr=focusChangeTransaction(view.state,focus);tr?view.dispatch(tr):view.update([])}}),10)}observers.focus=view=>{view.inputState.lastFocusTime=Date.now(),view.scrollDOM.scrollTop||!view.inputState.lastScrollTop&&!view.inputState.lastScrollLeft||(view.scrollDOM.scrollTop=view.inputState.lastScrollTop,view.scrollDOM.scrollLeft=view.inputState.lastScrollLeft),updateForFocusChange(view)},observers.blur=view=>{view.observer.clearSelectionRange(),updateForFocusChange(view)},observers.compositionstart=observers.compositionupdate=view=>{null==view.inputState.compositionFirstChange&&(view.inputState.compositionFirstChange=!0),view.inputState.composing<0&&(view.inputState.composing=0)},observers.compositionend=view=>{view.inputState.composing=-1,view.inputState.compositionEndedAt=Date.now(),view.inputState.compositionPendingKey=!0,view.inputState.compositionPendingChange=view.observer.pendingRecords().length>0,view.inputState.compositionFirstChange=null,browser.chrome&&browser.android?view.observer.flushSoon():view.inputState.compositionPendingChange?Promise.resolve().then((()=>view.observer.flush())):setTimeout((()=>{view.inputState.composing<0&&view.docView.hasComposition&&view.update([])}),50)},observers.contextmenu=view=>{view.inputState.lastContextMenu=Date.now()},handlers.beforeinput=(view,event)=>{var _a;let pending;if(browser.chrome&&browser.android&&(pending=PendingKeys.find((key=>key.inputType==event.inputType)))&&(view.observer.delayAndroidKey(pending.key,pending.keyCode),"Backspace"==pending.key||"Delete"==pending.key)){let startViewHeight=(null===(_a=window.visualViewport)||void 0===_a?void 0:_a.height)||0;setTimeout((()=>{var _a;((null===(_a=window.visualViewport)||void 0===_a?void 0:_a.height)||0)>startViewHeight+10&&view.hasFocus&&(view.contentDOM.blur(),view.focus())}),100)}return browser.ios&&"deleteContentForward"==event.inputType&&view.observer.flushSoon(),browser.safari&&"insertText"==event.inputType&&view.inputState.composing>=0&&setTimeout((()=>observers.compositionend(view,event)),20),!1};const appliedFirefoxHack=new Set;const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(lineWrapping){this.lineWrapping=lineWrapping,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(from,to){let lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;return this.lineWrapping&&(lines+=Math.max(0,Math.ceil((to-from-lines*this.lineLength*.5)/this.lineLength))),this.lineHeight*lines}heightForLine(length){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(doc){return this.doc=doc,this}mustRefreshForWrapping(whiteSpace){return wrappingWhiteSpace.indexOf(whiteSpace)>-1!=this.lineWrapping}mustRefreshForHeights(lineHeights){let newHeight=!1;for(let i=0;i<lineHeights.length;i++){let h=lineHeights[i];h<0?i++:this.heightSamples[Math.floor(10*h)]||(newHeight=!0,this.heightSamples[Math.floor(10*h)]=!0)}return newHeight}refresh(whiteSpace,lineHeight,charWidth,textHeight,lineLength,knownHeights){let lineWrapping=wrappingWhiteSpace.indexOf(whiteSpace)>-1,changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping;if(this.lineWrapping=lineWrapping,this.lineHeight=lineHeight,this.charWidth=charWidth,this.textHeight=textHeight,this.lineLength=lineLength,changed){this.heightSamples={};for(let i=0;i<knownHeights.length;i++){let h=knownHeights[i];h<0?i++:this.heightSamples[Math.floor(10*h)]=!0}}return changed}}class MeasuredHeights{constructor(from,heights){this.from=from,this.heights=heights,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(from,length,top,height,_content){this.from=from,this.length=length,this.top=top,this.height=height,this._content=_content}get type(){return"number"==typeof this._content?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(other){let content=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(other._content)?other._content:[other]);return new BlockInfo(this.from,this.length+other.length,this.top,this.height+other.height,content)}}var QueryType=function(QueryType){return QueryType[QueryType.ByPos=0]="ByPos",QueryType[QueryType.ByHeight=1]="ByHeight",QueryType[QueryType.ByPosNoHeight=2]="ByPosNoHeight",QueryType}(QueryType||(QueryType={}));class HeightMap{constructor(length,height,flags=2){this.length=length,this.height=height,this.flags=flags}get outdated(){return(2&this.flags)>0}set outdated(value){this.flags=(value?2:0)|-3&this.flags}setHeight(oracle,height){this.height!=height&&(Math.abs(this.height-height)>.001&&(oracle.heightChanged=!0),this.height=height)}replace(_from,_to,nodes){return HeightMap.of(nodes)}decomposeLeft(_to,result){result.push(this)}decomposeRight(_from,result){result.push(this)}applyChanges(decorations,oldDoc,oracle,changes){let me=this,doc=oracle.doc;for(let i=changes.length-1;i>=0;i--){let{fromA,toA,fromB,toB}=changes[i],start=me.lineAt(fromA,QueryType.ByPosNoHeight,oracle.setDoc(oldDoc),0,0),end=start.to>=toA?start:me.lineAt(toA,QueryType.ByPosNoHeight,oracle,0,0);for(toB+=end.to-toA,toA=end.to;i>0&&start.from<=changes[i-1].toA;)fromA=changes[i-1].fromA,fromB=changes[i-1].fromB,i--,fromA<start.from&&(start=me.lineAt(fromA,QueryType.ByPosNoHeight,oracle,0,0));fromB+=start.from-fromA,fromA=start.from;let nodes=NodeBuilder.build(oracle.setDoc(doc),decorations,fromB,toB);me=me.replace(fromA,toA,nodes)}return me.updateHeight(oracle,0)}static empty(){return new HeightMapText(0,0)}static of(nodes){if(1==nodes.length)return nodes[0];let i=0,j=nodes.length,before=0,after=0;for(;;)if(i==j)if(before>2*after){let split=nodes[i-1];split.break?nodes.splice(--i,1,split.left,null,split.right):nodes.splice(--i,1,split.left,split.right),j+=1+split.break,before-=split.size}else{if(!(after>2*before))break;{let split=nodes[j];split.break?nodes.splice(j,1,split.left,null,split.right):nodes.splice(j,1,split.left,split.right),j+=2+split.break,after-=split.size}}else if(before<after){let next=nodes[i++];next&&(before+=next.size)}else{let next=nodes[--j];next&&(after+=next.size)}let brk=0;return null==nodes[i-1]?(brk=1,i--):null==nodes[i]&&(brk=1,j++),new HeightMapBranch(HeightMap.of(nodes.slice(0,i)),brk,HeightMap.of(nodes.slice(j)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(length,height,deco){super(length,height),this.deco=deco}blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.deco||0)}lineAt(_value,_type,oracle,top,offset){return this.blockAt(0,oracle,top,offset)}forEachLine(from,to,oracle,top,offset,f){from<=offset+this.length&&to>=offset&&f(this.blockAt(0,oracle,top,offset))}updateHeight(oracle,offset=0,_force=!1,measured){return measured&&measured.from<=offset&&measured.more&&this.setHeight(oracle,measured.heights[measured.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(length,height){super(length,height,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.breaks)}replace(_from,_to,nodes){let node=nodes[0];return 1==nodes.length&&(node instanceof HeightMapText||node instanceof HeightMapGap&&4&node.flags)&&Math.abs(this.length-node.length)<10?(node instanceof HeightMapGap?node=new HeightMapText(node.length,this.height):node.height=this.height,this.outdated||(node.outdated=!1),node):HeightMap.of(nodes)}updateHeight(oracle,offset=0,force=!1,measured){return measured&&measured.from<=offset&&measured.more?this.setHeight(oracle,measured.heights[measured.index++]):(force||this.outdated)&&this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed))+this.breaks*oracle.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(length){super(length,0)}heightMetrics(oracle,offset){let perLine,firstLine=oracle.doc.lineAt(offset).number,lastLine=oracle.doc.lineAt(offset+this.length).number,lines=lastLine-firstLine+1,perChar=0;if(oracle.lineWrapping){let totalPerLine=Math.min(this.height,oracle.lineHeight*lines);perLine=totalPerLine/lines,this.length>lines+1&&(perChar=(this.height-totalPerLine)/(this.length-lines-1))}else perLine=this.height/lines;return{firstLine,lastLine,perLine,perChar}}blockAt(height,oracle,top,offset){let{firstLine,lastLine,perLine,perChar}=this.heightMetrics(oracle,offset);if(oracle.lineWrapping){let guess=offset+(height<oracle.lineHeight?0:Math.round(Math.max(0,Math.min(1,(height-top)/this.height))*this.length)),line=oracle.doc.lineAt(guess),lineHeight=perLine+line.length*perChar,lineTop=Math.max(top,height-lineHeight/2);return new BlockInfo(line.from,line.length,lineTop,lineHeight,0)}{let line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top)/perLine))),{from,length}=oracle.doc.line(firstLine+line);return new BlockInfo(from,length,top+perLine*line,perLine,0)}}lineAt(value,type,oracle,top,offset){if(type==QueryType.ByHeight)return this.blockAt(value,oracle,top,offset);if(type==QueryType.ByPosNoHeight){let{from,to}=oracle.doc.lineAt(value);return new BlockInfo(from,to-from,0,0,0)}let{firstLine,perLine,perChar}=this.heightMetrics(oracle,offset),line=oracle.doc.lineAt(value),lineHeight=perLine+line.length*perChar,linesAbove=line.number-firstLine,lineTop=top+perLine*linesAbove+perChar*(line.from-offset-linesAbove);return new BlockInfo(line.from,line.length,Math.max(top,Math.min(lineTop,top+this.height-lineHeight)),lineHeight,0)}forEachLine(from,to,oracle,top,offset,f){from=Math.max(from,offset),to=Math.min(to,offset+this.length);let{firstLine,perLine,perChar}=this.heightMetrics(oracle,offset);for(let pos=from,lineTop=top;pos<=to;){let line=oracle.doc.lineAt(pos);if(pos==from){let linesAbove=line.number-firstLine;lineTop+=perLine*linesAbove+perChar*(from-offset-linesAbove)}let lineHeight=perLine+perChar*line.length;f(new BlockInfo(line.from,line.length,lineTop,lineHeight,0)),lineTop+=lineHeight,pos=line.to+1}}replace(from,to,nodes){let after=this.length-to;if(after>0){let last=nodes[nodes.length-1];last instanceof HeightMapGap?nodes[nodes.length-1]=new HeightMapGap(last.length+after):nodes.push(null,new HeightMapGap(after-1))}if(from>0){let first=nodes[0];first instanceof HeightMapGap?nodes[0]=new HeightMapGap(from+first.length):nodes.unshift(new HeightMapGap(from-1),null)}return HeightMap.of(nodes)}decomposeLeft(to,result){result.push(new HeightMapGap(to-1),null)}decomposeRight(from,result){result.push(null,new HeightMapGap(this.length-from-1))}updateHeight(oracle,offset=0,force=!1,measured){let end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){let nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;for(measured.from>offset&&nodes.push(new HeightMapGap(measured.from-offset-1).updateHeight(oracle,offset));pos<=end&&measured.more;){let len=oracle.doc.lineAt(pos).length;nodes.length&&nodes.push(null);let height=measured.heights[measured.index++];-1==singleHeight?singleHeight=height:Math.abs(height-singleHeight)>=.001&&(singleHeight=-2);let line=new HeightMapText(len,height);line.outdated=!1,nodes.push(line),pos+=len+1}pos<=end&&nodes.push(null,new HeightMapGap(end-pos).updateHeight(oracle,pos));let result=HeightMap.of(nodes);return(singleHeight<0||Math.abs(result.height-this.height)>=.001||Math.abs(singleHeight-this.heightMetrics(oracle,offset).perLine)>=.001)&&(oracle.heightChanged=!0),result}return(force||this.outdated)&&(this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(left,brk,right){super(left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0)),this.left=left,this.right=right,this.size=left.size+right.size}get break(){return 1&this.flags}blockAt(height,oracle,top,offset){let mid=top+this.left.height;return height<mid?this.left.blockAt(height,oracle,top,offset):this.right.blockAt(height,oracle,mid,offset+this.left.length+this.break)}lineAt(value,type,oracle,top,offset){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break,left=type==QueryType.ByHeight?value<rightTop:value<rightOffset,base=left?this.left.lineAt(value,type,oracle,top,offset):this.right.lineAt(value,type,oracle,rightTop,rightOffset);if(this.break||(left?base.to<rightOffset:base.from>rightOffset))return base;let subQuery=type==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return left?base.join(this.right.lineAt(rightOffset,subQuery,oracle,rightTop,rightOffset)):this.left.lineAt(rightOffset,subQuery,oracle,top,offset).join(base)}forEachLine(from,to,oracle,top,offset,f){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break;if(this.break)from<rightOffset&&this.left.forEachLine(from,to,oracle,top,offset,f),to>=rightOffset&&this.right.forEachLine(from,to,oracle,rightTop,rightOffset,f);else{let mid=this.lineAt(rightOffset,QueryType.ByPos,oracle,top,offset);from<mid.from&&this.left.forEachLine(from,mid.from-1,oracle,top,offset,f),mid.to>=from&&mid.from<=to&&f(mid),to>mid.to&&this.right.forEachLine(mid.to+1,to,oracle,rightTop,rightOffset,f)}}replace(from,to,nodes){let rightStart=this.left.length+this.break;if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));let result=[];from>0&&this.decomposeLeft(from,result);let left=result.length;for(let node of nodes)result.push(node);if(from>0&&mergeGaps(result,left-1),to<this.length){let right=result.length;this.decomposeRight(to,result),mergeGaps(result,right)}return HeightMap.of(result)}decomposeLeft(to,result){let left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left),this.break&&(left++,to>=left&&result.push(null)),to>left&&this.right.decomposeLeft(to-left,result)}decomposeRight(from,result){let left=this.left.length,right=left+this.break;if(from>=right)return this.right.decomposeRight(from-right,result);from<left&&this.left.decomposeRight(from,result),this.break&&from<right&&result.push(null),result.push(this.right)}balanced(left,right){return left.size>2*right.size||right.size>2*left.size?HeightMap.of(this.break?[left,null,right]:[left,right]):(this.left=left,this.right=right,this.height=left.height+right.height,this.outdated=left.outdated||right.outdated,this.size=left.size+right.size,this.length=left.length+this.break+right.length,this)}updateHeight(oracle,offset=0,force=!1,measured){let{left,right}=this,rightStart=offset+left.length+this.break,rebalance=null;return measured&&measured.from<=offset+left.length&&measured.more?rebalance=left=left.updateHeight(oracle,offset,force,measured):left.updateHeight(oracle,offset,force),measured&&measured.from<=rightStart+right.length&&measured.more?rebalance=right=right.updateHeight(oracle,rightStart,force,measured):right.updateHeight(oracle,rightStart,force),rebalance?this.balanced(left,right):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(nodes,around){let before,after;null==nodes[around]&&(before=nodes[around-1])instanceof HeightMapGap&&(after=nodes[around+1])instanceof HeightMapGap&&nodes.splice(around-1,3,new HeightMapGap(before.length+1+after.length))}class NodeBuilder{constructor(pos,oracle){this.pos=pos,this.oracle=oracle,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=pos}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(_from,to){if(this.lineStart>-1){let end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];last instanceof HeightMapText?last.length+=end-this.pos:(end>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(end-this.pos,-1)),this.writtenTo=end,to>end&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=to}point(from,to,deco){if(from<to||deco.heightRelevant){let height=deco.widget?deco.widget.estimatedHeight:0,breaks=deco.widget?deco.widget.lineBreaks:0;height<0&&(height=this.oracle.lineHeight);let len=to-from;deco.block?this.addBlock(new HeightMapBlock(len,height,deco)):(len||breaks||height>=5)&&this.addLineDeco(height,breaks,len)}else to>from&&this.span(from,to);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from,to}=this.oracle.doc.lineAt(this.pos);this.lineStart=from,this.lineEnd=to,this.writtenTo<from&&((this.writtenTo<from-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,from-1)),this.nodes.push(null)),this.pos>from&&this.nodes.push(new HeightMapText(this.pos-from,-1)),this.writtenTo=this.pos}blankContent(from,to){let gap=new HeightMapGap(to-from);return this.oracle.doc.lineAt(from).to==to&&(gap.flags|=4),gap}ensureLine(){this.enterLine();let last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText)return last;let line=new HeightMapText(0,-1);return this.nodes.push(line),line}addBlock(block){this.enterLine();let deco=block.deco;deco&&deco.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(block),this.writtenTo=this.pos=this.pos+block.length,deco&&deco.endSide>0&&(this.covering=block)}addLineDeco(height,breaks,length){let line=this.ensureLine();line.length+=length,line.collapsed+=length,line.widgetHeight=Math.max(line.widgetHeight,height),line.breaks+=breaks,this.writtenTo=this.pos=this.pos+length}finish(from){let last=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||last instanceof HeightMapText||this.isCovered?(this.writtenTo<this.pos||null==last)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new HeightMapText(0,-1));let pos=from;for(let node of this.nodes)node instanceof HeightMapText&&node.updateHeight(this.oracle,pos),pos+=node?node.length:1;return this.nodes}static build(oracle,decorations,from,to){let builder=new NodeBuilder(from,oracle);return dist_RangeSet.spans(decorations,from,to,builder,0),builder.finish(from)}}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(from,to,a,b){(from<to||a&&a.heightRelevant||b&&b.heightRelevant)&&addRange(from,to,this.changes,5)}}function visiblePixelRange(dom,paddingTop){let rect=dom.getBoundingClientRect(),doc=dom.ownerDocument,win=doc.defaultView||window,left=Math.max(0,rect.left),right=Math.min(win.innerWidth,rect.right),top=Math.max(0,rect.top),bottom=Math.min(win.innerHeight,rect.bottom);for(let parent=dom.parentNode;parent&&parent!=doc.body;)if(1==parent.nodeType){let elt=parent,style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&"visible"!=style.overflow){let parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left),right=Math.min(right,parentRect.right),top=Math.max(top,parentRect.top),bottom=parent==dom.parentNode?parentRect.bottom:Math.min(bottom,parentRect.bottom)}parent="absolute"==style.position||"fixed"==style.position?elt.offsetParent:elt.parentNode}else{if(11!=parent.nodeType)break;parent=parent.host}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top-(rect.top+paddingTop),bottom:Math.max(top,bottom)-(rect.top+paddingTop)}}function fullPixelRange(dom,paddingTop){let rect=dom.getBoundingClientRect();return{left:0,right:rect.right-rect.left,top:paddingTop,bottom:rect.bottom-(rect.top+paddingTop)}}class LineGap{constructor(from,to,size){this.from=from,this.to=to,this.size=size}static same(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++){let gA=a[i],gB=b[i];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return!1}return!0}draw(viewState,wrapping){return Decoration.replace({widget:new LineGapWidget(this.size*(wrapping?viewState.scaleY:viewState.scaleX),wrapping)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(size,vertical){super(),this.size=size,this.vertical=vertical}eq(other){return other.size==this.size&&other.vertical==this.vertical}toDOM(){let elt=document.createElement("div");return this.vertical?elt.style.height=this.size+"px":(elt.style.width=this.size+"px",elt.style.height="2px",elt.style.display="inline-block"),elt}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(state){this.state=state,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let guessWrapping=state.facet(contentAttributes).some((v=>"function"!=typeof v&&"cm-lineWrapping"==v.class));this.heightOracle=new HeightOracle(guessWrapping),this.stateDeco=state.facet(decorations).filter((d=>"function"!=typeof d)),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange(0,0,0,state.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map((gap=>gap.draw(this,!1)))),this.computeVisibleRanges()}updateForViewport(){let viewports=[this.viewport],{main}=this.state.selection;for(let i=0;i<=1;i++){let pos=i?main.head:main.anchor;if(!viewports.some((({from,to})=>pos>=from&&pos<=to))){let{from,to}=this.lineBlockAt(pos);viewports.push(new Viewport(from,to))}}this.viewports=viewports.sort(((a,b)=>a.from-b.from)),this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,(block=>{this.viewportLines.push(1==this.scaler.scale?block:scaleBlock(block,this.scaler))}))}update(update,scrollTarget=null){this.state=update.state;let prevDeco=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter((d=>"function"!=typeof d));let contentChanges=update.changedRanges,heightChanges=ChangedRange.extendWithRanges(contentChanges,function heightRelevantDecoChanges(a,b,diff){let comp=new DecorationComparator;return dist_RangeSet.compare(a,b,diff,comp,0),comp.changes}(prevDeco,this.stateDeco,update?update.changes:ChangeSet.empty(this.state.doc.length))),prevHeight=this.heightMap.height,scrollAnchor=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,update.startState.doc,this.heightOracle.setDoc(this.state.doc),heightChanges),this.heightMap.height!=prevHeight&&(update.flags|=2),scrollAnchor?(this.scrollAnchorPos=update.changes.mapPos(scrollAnchor.from,-1),this.scrollAnchorHeight=scrollAnchor.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let viewport=heightChanges.length?this.mapViewport(this.viewport,update.changes):this.viewport;(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))&&(viewport=this.getViewport(0,scrollTarget));let updateLines=!update.changes.empty||2&update.flags||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport,this.updateForViewport(),updateLines&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,update.changes))),update.flags|=this.computeVisibleRanges(),scrollTarget&&(this.scrollTarget=scrollTarget),!this.mustEnforceCursorAssoc&&update.selectionSet&&update.view.lineWrapping&&update.state.selection.main.empty&&update.state.selection.main.assoc&&!update.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(view){let dom=view.contentDOM,style=window.getComputedStyle(dom),oracle=this.heightOracle,whiteSpace=style.whiteSpace;this.defaultTextDirection="rtl"==style.direction?Direction.RTL:Direction.LTR;let refresh=this.heightOracle.mustRefreshForWrapping(whiteSpace),domRect=dom.getBoundingClientRect(),measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=domRect.height;this.contentDOMHeight=domRect.height,this.mustMeasureContent=!1;let result=0,bias=0;if(domRect.width&&domRect.height){let{scaleX,scaleY}=getScale(dom,domRect);(scaleX>.005&&Math.abs(this.scaleX-scaleX)>.005||scaleY>.005&&Math.abs(this.scaleY-scaleY)>.005)&&(this.scaleX=scaleX,this.scaleY=scaleY,result|=8,refresh=measureContent=!0)}let paddingTop=(parseInt(style.paddingTop)||0)*this.scaleY,paddingBottom=(parseInt(style.paddingBottom)||0)*this.scaleY;this.paddingTop==paddingTop&&this.paddingBottom==paddingBottom||(this.paddingTop=paddingTop,this.paddingBottom=paddingBottom,result|=10),this.editorWidth!=view.scrollDOM.clientWidth&&(oracle.lineWrapping&&(measureContent=!0),this.editorWidth=view.scrollDOM.clientWidth,result|=8);let scrollTop=view.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=scrollTop&&(this.scrollAnchorHeight=-1,this.scrollTop=scrollTop),this.scrolledToBottom=isScrolledToBottom(view.scrollDOM);let pixelViewport=(this.printing?fullPixelRange:visiblePixelRange)(dom,this.paddingTop),dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;let inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView&&(this.inView=inView,inView&&(measureContent=!0)),!this.inView&&!this.scrollTarget)return 0;let contentWidth=domRect.width;if(this.contentDOMWidth==contentWidth&&this.editorHeight==view.scrollDOM.clientHeight||(this.contentDOMWidth=domRect.width,this.editorHeight=view.scrollDOM.clientHeight,result|=8),measureContent){let lineHeights=view.docView.measureVisibleLineHeights(this.viewport);if(oracle.mustRefreshForHeights(lineHeights)&&(refresh=!0),refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){let{lineHeight,charWidth,textHeight}=view.docView.measureTextSize();refresh=lineHeight>0&&oracle.refresh(whiteSpace,lineHeight,charWidth,textHeight,contentWidth/charWidth,lineHeights),refresh&&(view.docView.minWidth=0,result|=8)}dTop>0&&dBottom>0?bias=Math.max(dTop,dBottom):dTop<0&&dBottom<0&&(bias=Math.min(dTop,dBottom)),oracle.heightChanged=!1;for(let vp of this.viewports){let heights=vp.from==this.viewport.from?lineHeights:view.docView.measureVisibleLineHeights(vp);this.heightMap=(refresh?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,view.state.doc.length)]):this.heightMap).updateHeight(oracle,0,refresh,new MeasuredHeights(vp.from,heights))}oracle.heightChanged&&(result|=2)}let viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return viewportChange&&(this.viewport=this.getViewport(bias,this.scrollTarget)),this.updateForViewport(),(2&result||viewportChange)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps,view)),result|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,view.docView.enforceCursorAssoc()),result}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(bias,scrollTarget){let marginTop=.5-Math.max(-.5,Math.min(.5,bias/1e3/2)),map=this.heightMap,oracle=this.heightOracle,{visibleTop,visibleBottom}=this,viewport=new Viewport(map.lineAt(visibleTop-1e3*marginTop,QueryType.ByHeight,oracle,0,0).from,map.lineAt(visibleBottom+1e3*(1-marginTop),QueryType.ByHeight,oracle,0,0).to);if(scrollTarget){let{head}=scrollTarget.range;if(head<viewport.from||head>viewport.to){let topPos,viewHeight=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),block=map.lineAt(head,QueryType.ByPos,oracle,0,0);topPos="center"==scrollTarget.y?(block.top+block.bottom)/2-viewHeight/2:"start"==scrollTarget.y||"nearest"==scrollTarget.y&&head<viewport.from?block.top:block.bottom-viewHeight,viewport=new Viewport(map.lineAt(topPos-500,QueryType.ByHeight,oracle,0,0).from,map.lineAt(topPos+viewHeight+500,QueryType.ByHeight,oracle,0,0).to)}}return viewport}mapViewport(viewport,changes){let from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport(this.heightMap.lineAt(from,QueryType.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(to,QueryType.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from,to},bias=0){if(!this.inView)return!0;let{top}=this.heightMap.lineAt(from,QueryType.ByPos,this.heightOracle,0,0),{bottom}=this.heightMap.lineAt(to,QueryType.ByPos,this.heightOracle,0,0),{visibleTop,visibleBottom}=this;return(0==from||top<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top>visibleTop-2e3&&bottom<visibleBottom+2e3}mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;let mapped=[];for(let gap of gaps)changes.touchesRange(gap.from,gap.to)||mapped.push(new LineGap(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));return mapped}ensureLineGaps(current,mayMeasure){let wrapping=this.heightOracle.lineWrapping,margin=wrapping?1e4:2e3,halfMargin=margin>>1,doubleMargin=margin<<1;if(this.defaultTextDirection!=Direction.LTR&&!wrapping)return[];let gaps=[],addGap=(from,to,line,structure)=>{if(to-from<halfMargin)return;let sel=this.state.selection.main,avoid=[sel.from];sel.empty||avoid.push(sel.to);for(let pos of avoid)if(pos>from&&pos<to)return addGap(from,pos-10,line,structure),void addGap(pos+10,to,line,structure);let gap=function find(array,f){for(let val of array)if(f(val))return val;return}(current,(gap=>gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<halfMargin&&Math.abs(gap.to-to)<halfMargin&&!avoid.some((pos=>gap.from<pos&&gap.to>pos))));if(!gap){if(to<line.to&&mayMeasure&&wrapping&&mayMeasure.visibleRanges.some((r=>r.from<=to&&r.to>=to))){let lineStart=mayMeasure.moveToLineBoundary(dist_EditorSelection.cursor(to),!1,!0).head;lineStart>from&&(to=lineStart)}gap=new LineGap(from,to,this.gapSize(line,from,to,structure))}gaps.push(gap)};for(let line of this.viewportLines){if(line.length<doubleMargin)continue;let structure=lineStructure(line.from,line.to,this.stateDeco);if(structure.total<doubleMargin)continue;let viewFrom,viewTo,target=this.scrollTarget?this.scrollTarget.range.head:null;if(wrapping){let top,bot,marginHeight=margin/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=target){let targetFrac=findFraction(structure,target),spaceFrac=((this.visibleBottom-this.visibleTop)/2+marginHeight)/line.height;top=targetFrac-spaceFrac,bot=targetFrac+spaceFrac}else top=(this.visibleTop-line.top-marginHeight)/line.height,bot=(this.visibleBottom-line.top+marginHeight)/line.height;viewFrom=findPosition(structure,top),viewTo=findPosition(structure,bot)}else{let left,right,totalWidth=structure.total*this.heightOracle.charWidth,marginWidth=margin*this.heightOracle.charWidth;if(null!=target){let targetFrac=findFraction(structure,target),spaceFrac=((this.pixelViewport.right-this.pixelViewport.left)/2+marginWidth)/totalWidth;left=targetFrac-spaceFrac,right=targetFrac+spaceFrac}else left=(this.pixelViewport.left-marginWidth)/totalWidth,right=(this.pixelViewport.right+marginWidth)/totalWidth;viewFrom=findPosition(structure,left),viewTo=findPosition(structure,right)}viewFrom>line.from&&addGap(line.from,viewFrom,line,structure),viewTo<line.to&&addGap(viewTo,line.to,line,structure)}return gaps}gapSize(line,from,to,structure){let fraction=findFraction(structure,to)-findFraction(structure,from);return this.heightOracle.lineWrapping?line.height*fraction:structure.total*this.heightOracle.charWidth*fraction}updateLineGaps(gaps){LineGap.same(gaps,this.lineGaps)||(this.lineGaps=gaps,this.lineGapDeco=Decoration.set(gaps.map((gap=>gap.draw(this,this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let deco=this.stateDeco;this.lineGaps.length&&(deco=deco.concat(this.lineGapDeco));let ranges=[];dist_RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span(from,to){ranges.push({from,to})},point(){}},20);let changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(((r,i)=>r.from!=ranges[i].from||r.to!=ranges[i].to));return this.visibleRanges=ranges,changed?4:0}lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find((b=>b.from<=pos&&b.to>=pos))||scaleBlock(this.heightMap.lineAt(pos,QueryType.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(height){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(scrollTop){let block=this.lineBlockAtHeight(scrollTop+8);return block.from>=this.viewport.from||this.viewportLines[0].top-scrollTop>200?block:this.viewportLines[0]}elementAtHeight(height){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(from,to){this.from=from,this.to=to}}function lineStructure(from,to,stateDeco){let ranges=[],pos=from,total=0;return dist_RangeSet.spans(stateDeco,from,to,{span(){},point(from,to){from>pos&&(ranges.push({from:pos,to:from}),total+=from-pos),pos=to}},20),pos<to&&(ranges.push({from:pos,to}),total+=to-pos),{total,ranges}}function findPosition({total,ranges},ratio){if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;let dist=Math.floor(total*ratio);for(let i=0;;i++){let{from,to}=ranges[i],size=to-from;if(dist<=size)return from+dist;dist-=size}}function findFraction(structure,pos){let counted=0;for(let{from,to}of structure.ranges){if(pos<=to){counted+=pos-from;break}counted+=to-from}return counted/structure.total}const IdScaler={toDOM:n=>n,fromDOM:n=>n,scale:1};class BigScaler{constructor(oracle,heightMap,viewports){let vpHeight=0,base=0,domBase=0;this.viewports=viewports.map((({from,to})=>{let top=heightMap.lineAt(from,QueryType.ByPos,oracle,0,0).top,bottom=heightMap.lineAt(to,QueryType.ByPos,oracle,0,0).bottom;return vpHeight+=bottom-top,{from,to,top,bottom,domTop:0,domBottom:0}})),this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);for(let obj of this.viewports)obj.domTop=domBase+(obj.top-base)*this.scale,domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top),base=obj.bottom}toDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.top)return domBase+(n-base)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base=vp.bottom,domBase=vp.domBottom}}fromDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.domTop)return base+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base=vp.bottom,domBase=vp.domBottom}}}function scaleBlock(block,scaler){if(1==scaler.scale)return block;let bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block._content)?block._content.map((b=>scaleBlock(b,scaler))):block._content)}const theme=Facet.define({combine:strs=>strs.join(" ")}),darkTheme=Facet.define({combine:values=>values.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(main,spec,scopes){return new StyleModule(spec,{finish:sel=>/&/.test(sel)?sel.replace(/&\w*/,(m=>{if("&"==m)return main;if(!scopes||!scopes[m])throw new RangeError(`Unsupported selector: ${m}`);return scopes[m]})):main+" "+sel})}const baseTheme$1=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);class DOMReader{constructor(points,state){this.points=points,this.text="",this.lineSeparator=state.facet(EditorState.lineSeparator)}append(text){this.text+=text}lineBreak(){this.text+="￿"}readRange(start,end){if(!start)return this;let parent=start.parentNode;for(let cur=start;;){this.findPointBefore(parent,cur);let oldLen=this.text.length;this.readNode(cur);let next=cur.nextSibling;if(next==end)break;let view=ContentView.get(cur),nextView=ContentView.get(next);(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement(cur))||isBlockElement(next)&&("BR"!=cur.nodeName||cur.cmIgnore)&&this.text.length>oldLen)&&this.lineBreak(),cur=next}return this.findPointBefore(parent,end),this}readTextNode(node){let text=node.nodeValue;for(let point of this.points)point.node==node&&(point.pos=this.text.length+Math.min(point.offset,text.length));for(let off=0,re=this.lineSeparator?null:/\r\n?|\n/g;;){let m,nextBreak=-1,breakSize=1;if(this.lineSeparator?(nextBreak=text.indexOf(this.lineSeparator,off),breakSize=this.lineSeparator.length):(m=re.exec(text))&&(nextBreak=m.index,breakSize=m[0].length),this.append(text.slice(off,nextBreak<0?text.length:nextBreak)),nextBreak<0)break;if(this.lineBreak(),breakSize>1)for(let point of this.points)point.node==node&&point.pos>this.text.length&&(point.pos-=breakSize-1);off=nextBreak+breakSize}}readNode(node){if(node.cmIgnore)return;let view=ContentView.get(node),fromView=view&&view.overrideDOMText;if(null!=fromView){this.findPointInside(node,fromView.length);for(let i=fromView.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else 3==node.nodeType?this.readTextNode(node):"BR"==node.nodeName?node.nextSibling&&this.lineBreak():1==node.nodeType&&this.readRange(node.firstChild,null)}findPointBefore(node,next){for(let point of this.points)point.node==node&&node.childNodes[point.offset]==next&&(point.pos=this.text.length)}findPointInside(node,length){for(let point of this.points)(3==node.nodeType?point.node==node:node.contains(point.node))&&(point.pos=this.text.length+(isAtEnd(node,point.node,point.offset)?length:0))}}function isAtEnd(parent,node,offset){for(;;){if(!node||offset<maxOffset(node))return!1;if(node==parent)return!0;offset=domIndex(node)+1,node=node.parentNode}}class DOMPoint{constructor(node,offset){this.node=node,this.offset=offset,this.pos=-1}}class DOMChange{constructor(view,start,end,typeOver){this.typeOver=typeOver,this.bounds=null,this.text="";let{impreciseHead:iHead,impreciseAnchor:iAnchor}=view.docView;if(view.state.readOnly&&start>-1)this.newSel=null;else if(start>-1&&(this.bounds=view.docView.domBoundsAround(start,end,0))){let selPoints=iHead||iAnchor?[]:function selectionPoints(view){let result=[];if(view.root.activeElement!=view.contentDOM)return result;let{anchorNode,anchorOffset,focusNode,focusOffset}=view.observer.selectionRange;anchorNode&&(result.push(new DOMPoint(anchorNode,anchorOffset)),focusNode==anchorNode&&focusOffset==anchorOffset||result.push(new DOMPoint(focusNode,focusOffset)));return result}(view),reader=new DOMReader(selPoints,view.state);reader.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=reader.text,this.newSel=function selectionFromPoints(points,base){if(0==points.length)return null;let anchor=points[0].pos,head=2==points.length?points[1].pos:anchor;return anchor>-1&&head>-1?dist_EditorSelection.single(anchor+base,head+base):null}(selPoints,this.bounds.from)}else{let domSel=view.observer.selectionRange,head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset),anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset),vp=view.viewport;if((browser.ios||browser.chrome)&&view.state.selection.main.empty&&head!=anchor&&(vp.from>0||vp.to<view.state.doc.length)){let from=Math.min(head,anchor),to=Math.max(head,anchor),offFrom=vp.from-from,offTo=vp.to-to;0!=offFrom&&1!=offFrom&&0!=from||0!=offTo&&-1!=offTo&&to!=view.state.doc.length||(head=0,anchor=view.state.doc.length)}this.newSel=dist_EditorSelection.single(anchor,head)}}}function applyDOMChange(view,domChange){let change,{newSel}=domChange,sel=view.state.selection.main,lastKey=view.inputState.lastKeyTime>Date.now()-100?view.inputState.lastKeyCode:-1;if(domChange.bounds){let{from,to}=domChange.bounds,preferredPos=sel.from,preferredSide=null;(8===lastKey||browser.android&&domChange.text.length<to-from)&&(preferredPos=sel.to,preferredSide="end");let diff=function findDiff(a,b,preferredPos,preferredSide){let minLen=Math.min(a.length,b.length),from=0;for(;from<minLen&&a.charCodeAt(from)==b.charCodeAt(from);)from++;if(from==minLen&&a.length==b.length)return null;let toA=a.length,toB=b.length;for(;toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1);)toA--,toB--;if("end"==preferredSide){preferredPos-=toA+Math.max(0,from-Math.min(toA,toB))-from}if(toA<from&&a.length<b.length){from-=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0,toB=from+(toB-toA),toA=from}else if(toB<from){from-=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0,toA=from+(toA-toB),toB=from}return{from,toA,toB}}(view.state.doc.sliceString(from,to,"￿"),domChange.text,preferredPos-from,preferredSide);diff&&(browser.chrome&&13==lastKey&&diff.toB==diff.from+2&&"￿￿"==domChange.text.slice(diff.from,diff.toB)&&diff.toB--,change={from:from+diff.from,to:from+diff.toA,insert:Text.of(domChange.text.slice(diff.from,diff.toB).split("￿"))})}else newSel&&(!view.hasFocus&&view.state.facet(editable)||newSel.main.eq(sel))&&(newSel=null);if(!change&&!newSel)return!1;if(!change&&domChange.typeOver&&!sel.empty&&newSel&&newSel.main.empty?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)}:change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))}:(browser.mac||browser.android)&&change&&change.from==change.to&&change.from==sel.head-1&&/^\. ?$/.test(change.insert.toString())&&"off"==view.contentDOM.getAttribute("autocorrect")?(newSel&&2==change.insert.length&&(newSel=dist_EditorSelection.single(newSel.main.anchor-1,newSel.main.head-1)),change={from:sel.from,to:sel.to,insert:Text.of([" "])}):browser.chrome&&change&&change.from==change.to&&change.from==sel.head&&"\n "==change.insert.toString()&&view.lineWrapping&&(newSel&&(newSel=dist_EditorSelection.single(newSel.main.anchor-1,newSel.main.head-1)),change={from:sel.from,to:sel.to,insert:Text.of([" "])}),change){if(browser.ios&&view.inputState.flushIOSKey(change))return!0;if(browser.android&&(change.to==sel.to&&(change.from==sel.from||change.from==sel.from-1&&" "==view.state.sliceDoc(change.from,sel.from))&&1==change.insert.length&&2==change.insert.lines&&dispatchKey(view.contentDOM,"Enter",13)||(change.from==sel.from-1&&change.to==sel.to&&0==change.insert.length||8==lastKey&&change.insert.length<change.to-change.from&&change.to>sel.head)&&dispatchKey(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&0==change.insert.length&&dispatchKey(view.contentDOM,"Delete",46)))return!0;let defaultTr,text=change.insert.toString();view.inputState.composing>=0&&view.inputState.composing++;let defaultInsert=()=>defaultTr||(defaultTr=function applyDefaultInsert(view,change,newSel){let tr,startState=view.state,sel=startState.selection.main;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){let before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"",after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after))}else{let changes=startState.changes(change),mainSel=newSel&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){let compositionRange,replaced=view.state.sliceDoc(change.from,change.to),composition=newSel&&findCompositionNode(view,newSel.main.head);if(composition){let dLen=change.insert.length-(change.to-change.from);compositionRange={from:composition.from,to:composition.to-dLen}}else compositionRange=view.state.doc.lineAt(sel.head);let offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange((range=>{if(range.from==sel.from&&range.to==sel.to)return{changes,range:mainSel||range.map(changes)};let to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range};let rangeChanges=startState.changes({from,to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:mainSel?dist_EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff)):range.map(rangeChanges)}}))}else tr={changes,selection:mainSel&&startState.selection.replaceRange(mainSel)}}let userEvent="input.type";(view.composing||view.inputState.compositionPendingChange&&view.inputState.compositionEndedAt>Date.now()-50)&&(view.inputState.compositionPendingChange=!1,userEvent+=".compose",view.inputState.compositionFirstChange&&(userEvent+=".start",view.inputState.compositionFirstChange=!1));return startState.update(tr,{userEvent,scrollIntoView:!0})}(view,change,newSel));return view.state.facet(inputHandler).some((h=>h(view,change.from,change.to,text,defaultInsert)))||view.dispatch(defaultInsert()),!0}if(newSel&&!newSel.main.eq(sel)){let scrollIntoView=!1,userEvent="select";return view.inputState.lastSelectionTime>Date.now()-50&&("select"==view.inputState.lastSelectionOrigin&&(scrollIntoView=!0),userEvent=view.inputState.lastSelectionOrigin),view.dispatch({selection:newSel,scrollIntoView,userEvent}),!0}return!1}const observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(view){this.view=view,this.active=!1,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=view.contentDOM,this.observer=new MutationObserver((mutations=>{for(let mut of mutations)this.queue.push(mut);(browser.ie&&browser.ie_version<=11||browser.ios&&view.composing)&&mutations.some((m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length))?this.flushSoon():this.flush()})),useCharData&&(this.onCharData=event=>{this.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver((()=>{var _a;(null===(_a=this.view.docView)||void 0===_a?void 0:_a.lastUpdate)<Date.now()-75&&this.onResize()})),this.resizeScroll.observe(view.scrollDOM)),this.addWindowListeners(this.win=view.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((entries=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),entries.length>0&&entries[entries.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((entries=>{entries.length>0&&entries[entries.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(event){("change"!=event.type||event.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500))}updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(((g,i)=>g!=gaps[i])))){this.gapIntersection.disconnect();for(let gap of gaps)this.gapIntersection.observe(gap);this.gaps=gaps}}onSelectionChange(event){let wasChanged=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view}=this,sel=this.selectionRange;if(view.state.facet(editable)?view.root.activeElement!=this.dom:!hasSelection(view.dom,sel))return;let context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);context&&context.ignoreEvent(event)?wasChanged||(this.selectionChanged=!1):(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view}=this,selection=getSelection(view.root);if(!selection)return!1;let range=browser.safari&&11==view.root.nodeType&&function deepActiveElement(doc){let elt=doc.activeElement;for(;elt&&elt.shadowRoot;)elt=elt.shadowRoot.activeElement;return elt}(this.dom.ownerDocument)==this.dom&&function safariSelectionRangeHack(view,selection){if(selection.getComposedRanges){let range=selection.getComposedRanges(view.root)[0];if(range)return buildSelectionRangeFromRange(view,range)}let found=null;function read(event){event.preventDefault(),event.stopImmediatePropagation(),found=event.getTargetRanges()[0]}return view.contentDOM.addEventListener("beforeinput",read,!0),view.dom.ownerDocument.execCommand("indent"),view.contentDOM.removeEventListener("beforeinput",read,!0),found?buildSelectionRangeFromRange(view,found):null}(this.view,selection)||selection;if(!range||this.selectionRange.eq(range))return!1;let local=hasSelection(this.dom,range);return local&&!this.selectionChanged&&view.inputState.lastFocusTime>Date.now()-200&&view.inputState.lastTouchTime<Date.now()-300&&function atElementStart(doc,selection){let node=selection.focusNode,offset=selection.focusOffset;if(!node||selection.anchorNode!=node||selection.anchorOffset!=offset)return!1;for(offset=Math.min(offset,maxOffset(node));;)if(offset){if(1!=node.nodeType)return!1;let prev=node.childNodes[offset-1];"false"==prev.contentEditable?offset--:(node=prev,offset=maxOffset(node))}else{if(node==doc)return!0;offset=domIndex(node),node=node.parentNode}}(this.dom,range)?(this.view.inputState.lastFocusTime=0,view.docView.updateSelection(),!1):(this.selectionRange.setRange(range),local&&(this.selectionChanged=!0),!0)}setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let i=0,changed=null;for(let dom=this.dom;dom;)if(1==dom.nodeType)!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom?i++:changed||(changed=this.scrollTargets.slice(0,i)),changed&&changed.push(dom),dom=dom.assignedSlot||dom.parentNode;else{if(11!=dom.nodeType)break;dom=dom.host}if(i<this.scrollTargets.length&&!changed&&(changed=this.scrollTargets.slice(0,i)),changed){for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);for(let dom of this.scrollTargets=changed)dom.addEventListener("scroll",this.onScroll)}}ignore(f){if(!this.active)return f();try{return this.stop(),f()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(key,keyCode){var _a;if(!this.delayedAndroidKey){let flush=()=>{let key=this.delayedAndroidKey;if(key){this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=key.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&key.force&&dispatchKey(this.dom,key.key,key.keyCode)}};this.flushingAndroidKey=this.view.win.requestAnimationFrame(flush)}this.delayedAndroidKey&&"Enter"!=key||(this.delayedAndroidKey={key,keyCode,force:this.lastChange<Date.now()-50||!!(null===(_a=this.delayedAndroidKey)||void 0===_a?void 0:_a.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame((()=>{this.delayedFlush=-1,this.flush()})))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let mut of this.observer.takeRecords())this.queue.push(mut);return this.queue}processRecords(){let records=this.pendingRecords();records.length&&(this.queue=[]);let from=-1,to=-1,typeOver=!1;for(let record of records){let range=this.readMutation(record);range&&(range.typeOver&&(typeOver=!0),-1==from?({from,to}=range):(from=Math.min(range.from,from),to=Math.max(range.to,to)))}return{from,to,typeOver}}readChange(){let{from,to,typeOver}=this.processRecords(),newSel=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(from<0&&!newSel)return null;from>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let change=new DOMChange(this.view,from,to,typeOver);return this.view.docView.domChanged={newSel:change.newSel?change.newSel.main:null},change}flush(readSelection=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;readSelection&&this.readSelectionRange();let domChange=this.readChange();if(!domChange)return this.view.requestMeasure(),!1;let startState=this.view.state,handled=applyDOMChange(this.view,domChange);return this.view.state==startState&&this.view.update([]),handled}readMutation(rec){let cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;if(cView.markDirty("attributes"==rec.type),"attributes"==rec.type&&(cView.flags|=4),"childList"==rec.type){let childBefore=findChild(cView,rec.previousSibling||rec.target.previousSibling,-1),childAfter=findChild(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:!1}}return"characterData"==rec.type?{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue}:null}setWindow(win){win!=this.win&&(this.removeWindowListeners(this.win),this.win=win,this.addWindowListeners(this.win))}addWindowListeners(win){win.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener("change",this.onPrint):win.addEventListener("beforeprint",this.onPrint),win.addEventListener("scroll",this.onScroll),win.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(win){win.removeEventListener("scroll",this.onScroll),win.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener("change",this.onPrint):win.removeEventListener("beforeprint",this.onPrint),win.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var _a,_b,_c;this.stop(),null===(_a=this.intersection)||void 0===_a||_a.disconnect(),null===(_b=this.gapIntersection)||void 0===_b||_b.disconnect(),null===(_c=this.resizeScroll)||void 0===_c||_c.disconnect();for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function findChild(cView,dom,dir){for(;dom;){let curView=ContentView.get(dom);if(curView&&curView.parent==cView)return curView;let parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling}return null}function buildSelectionRangeFromRange(view,range){let anchorNode=range.startContainer,anchorOffset=range.startOffset,focusNode=range.endContainer,focusOffset=range.endOffset,curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);return isEquivalentPosition(curAnchor.node,curAnchor.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]),{anchorNode,anchorOffset,focusNode,focusOffset}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(config={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),config.parent&&config.parent.appendChild(this.dom);let{dispatch}=config;this.dispatchTransactions=config.dispatchTransactions||dispatch&&(trs=>trs.forEach((tr=>dispatch(tr,this))))||(trs=>this.update(trs)),this.dispatch=this.dispatch.bind(this),this._root=config.root||function getRoot(node){for(;node;){if(node&&(9==node.nodeType||11==node.nodeType&&node.host))return node;node=node.assignedSlot||node.parentNode}return null}(config.parent)||document,this.viewState=new ViewState(config.state||EditorState.create(config)),config.scrollTo&&config.scrollTo.is(scrollIntoView)&&(this.viewState.scrollTarget=config.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map((spec=>new PluginInstance(spec)));for(let plugin of this.plugins)plugin.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure()}dispatch(...input){let trs=1==input.length&&input[0]instanceof Transaction?input:1==input.length&&Array.isArray(input[0])?input[0]:[this.state.update(...input)];this.dispatchTransactions(trs,this)}update(transactions){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let update,redrawn=!1,attrsChanged=!1,state=this.state;for(let tr of transactions){if(tr.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=tr.state}if(this.destroyed)return void(this.viewState.state=state);let focus=this.hasFocus,focusFlag=0,dispatchFocus=null;transactions.some((tr=>tr.annotation(isFocusChange)))?(this.inputState.notifiedFocused=focus,focusFlag=1):focus!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=focus,dispatchFocus=focusChangeTransaction(state,focus),dispatchFocus||(focusFlag=1));let pendingKey=this.observer.delayedAndroidKey,domChange=null;if(pendingKey?(this.observer.clearDelayedAndroidKey(),domChange=this.observer.readChange(),(domChange&&!this.state.doc.eq(state.doc)||!this.state.selection.eq(state.selection))&&(domChange=null)):this.observer.clear(),state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=ViewUpdate.create(this,state,transactions),update.flags|=focusFlag;let scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;for(let tr of transactions){if(scrollTarget&&(scrollTarget=scrollTarget.map(tr.changes)),tr.scrollIntoView){let{main}=tr.state.selection;scrollTarget=new ScrollTarget(main.empty?main:dist_EditorSelection.cursor(main.head,main.head>main.anchor?-1:1))}for(let e of tr.effects)e.is(scrollIntoView)&&(scrollTarget=e.value.clip(this.state))}this.viewState.update(update,scrollTarget),this.bidiCache=CachedOrder.update(this.bidiCache,update.changes),update.empty||(this.updatePlugins(update),this.inputState.update(update)),redrawn=this.docView.update(update),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),attrsChanged=this.updateAttrs(),this.showAnnouncements(transactions),this.docView.updateSelection(redrawn,transactions.some((tr=>tr.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(update.startState.facet(theme)!=update.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(redrawn||attrsChanged||scrollTarget||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),redrawn&&this.docViewUpdate(),!update.empty)for(let listener of this.state.facet(updateListener))try{listener(update)}catch(e){logException(this.state,e,"update listener")}(dispatchFocus||domChange)&&Promise.resolve().then((()=>{dispatchFocus&&this.state==dispatchFocus.startState&&this.dispatch(dispatchFocus),domChange&&!applyDOMChange(this,domChange)&&pendingKey.force&&dispatchKey(this.contentDOM,pendingKey.key,pendingKey.keyCode)}))}setState(newState){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=newState);this.updateState=2;let hadFocus=this.hasFocus;try{for(let plugin of this.plugins)plugin.destroy(this);this.viewState=new ViewState(newState),this.plugins=newState.facet(viewPlugin).map((spec=>new PluginInstance(spec))),this.pluginMap.clear();for(let plugin of this.plugins)plugin.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}hadFocus&&this.focus(),this.requestMeasure()}updatePlugins(update){let prevSpecs=update.startState.facet(viewPlugin),specs=update.state.facet(viewPlugin);if(prevSpecs!=specs){let newPlugins=[];for(let spec of specs){let found=prevSpecs.indexOf(spec);if(found<0)newPlugins.push(new PluginInstance(spec));else{let plugin=this.plugins[found];plugin.mustUpdate=update,newPlugins.push(plugin)}}for(let plugin of this.plugins)plugin.mustUpdate!=update&&plugin.destroy(this);this.plugins=newPlugins,this.pluginMap.clear()}else for(let p of this.plugins)p.mustUpdate=update;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);prevSpecs!=specs&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let plugin of this.plugins){let val=plugin.value;if(val&&val.docViewUpdate)try{val.docViewUpdate(this)}catch(e){logException(this.state,e,"doc view update listener")}}}measure(flush=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,flush&&this.observer.forceFlush();let updated=null,sDOM=this.scrollDOM,scrollTop=sDOM.scrollTop*this.scaleY,{scrollAnchorPos,scrollAnchorHeight}=this.viewState;Math.abs(scrollTop-this.viewState.scrollTop)>1&&(scrollAnchorHeight=-1),this.viewState.scrollAnchorHeight=-1;try{for(let i=0;;i++){if(scrollAnchorHeight<0)if(isScrolledToBottom(sDOM))scrollAnchorPos=-1,scrollAnchorHeight=this.viewState.heightMap.height;else{let block=this.viewState.scrollAnchorAt(scrollTop);scrollAnchorPos=block.from,scrollAnchorHeight=block.top}this.updateState=1;let changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let measuring=[];4&changed||([this.measureRequests,measuring]=[measuring,this.measureRequests]);let measured=measuring.map((m=>{try{return m.read(this)}catch(e){return logException(this.state,e),BadMeasure}})),update=ViewUpdate.create(this,this.state,[]),redrawn=!1;update.flags|=changed,updated?updated.flags|=changed:updated=update,this.updateState=2,update.empty||(this.updatePlugins(update),this.inputState.update(update),this.updateAttrs(),redrawn=this.docView.update(update),redrawn&&this.docViewUpdate());for(let i=0;i<measuring.length;i++)if(measured[i]!=BadMeasure)try{let m=measuring[i];m.write&&m.write(measured[i],this)}catch(e){logException(this.state,e)}if(redrawn&&this.docView.updateSelection(!0),!update.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,scrollAnchorHeight=-1;continue}{let diff=(scrollAnchorPos<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(scrollAnchorPos).top)-scrollAnchorHeight;if(diff>1||diff<-1){scrollTop+=diff,sDOM.scrollTop=scrollTop/this.scaleY,scrollAnchorHeight=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(updated&&!updated.empty)for(let listener of this.state.facet(updateListener))listener(updated)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let editorAttrs=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(contentAttrs["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,contentAttrs);let changed=this.observer.ignore((()=>{let changedContent=updateAttrs(this.contentDOM,this.contentAttrs,contentAttrs),changedEditor=updateAttrs(this.dom,this.editorAttrs,editorAttrs);return changedContent||changedEditor}));return this.editorAttrs=editorAttrs,this.contentAttrs=contentAttrs,changed}showAnnouncements(trs){let first=!0;for(let tr of trs)for(let effect of tr.effects)if(effect.is(EditorView.announce)){first&&(this.announceDOM.textContent=""),first=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=effect.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let nonce=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1).reverse(),nonce?{nonce}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(request){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame((()=>this.measure()))),request){if(this.measureRequests.indexOf(request)>-1)return;if(null!=request.key)for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===request.key)return void(this.measureRequests[i]=request);this.measureRequests.push(request)}}plugin(plugin){let known=this.pluginMap.get(plugin);return(void 0===known||known&&known.spec!=plugin)&&this.pluginMap.set(plugin,known=this.plugins.find((p=>p.spec==plugin))||null),known&&known.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(height){return this.readMeasured(),this.viewState.elementAtHeight(height)}lineBlockAtHeight(height){return this.readMeasured(),this.viewState.lineBlockAtHeight(height)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(pos){return this.viewState.lineBlockAt(pos)}get contentHeight(){return this.viewState.contentHeight}moveByChar(start,forward,by){return skipAtoms(this,start,moveByChar(this,start,forward,by))}moveByGroup(start,forward){return skipAtoms(this,start,moveByChar(this,start,forward,(initial=>function byGroup(view,pos,start){let categorize=view.state.charCategorizer(pos),cat=categorize(start);return next=>{let nextCat=categorize(next);return cat==CharCategory.Space&&(cat=nextCat),cat==nextCat}}(this,start.head,initial))))}visualLineSide(line,end){let order=this.bidiSpans(line),dir=this.textDirectionAt(line.from),span=order[end?order.length-1:0];return dist_EditorSelection.cursor(span.side(end,dir)+line.from,span.forward(!end,dir)?1:-1)}moveToLineBoundary(start,forward,includeWrap=!0){return function moveToLineBoundary(view,start,forward,includeWrap){let line=blockAt(view,start.head),coords=includeWrap&&line.type==BlockType.Text&&(view.lineWrapping||line.widgetLineBreaks)?view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head):null;if(coords){let editorRect=view.dom.getBoundingClientRect(),direction=view.textDirectionAt(line.from),pos=view.posAtCoords({x:forward==(direction==Direction.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(null!=pos)return dist_EditorSelection.cursor(pos,forward?-1:1)}return dist_EditorSelection.cursor(forward?line.to:line.from,forward?-1:1)}(this,start,forward,includeWrap)}moveVertically(start,forward,distance){return skipAtoms(this,start,function moveVertically(view,start,forward,distance){let startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return dist_EditorSelection.cursor(startPos,start.assoc);let startY,goal=start.goalColumn,rect=view.contentDOM.getBoundingClientRect(),startCoords=view.coordsAtPos(startPos,start.assoc||-1),docTop=view.documentTop;if(startCoords)null==goal&&(goal=startCoords.left-rect.left),startY=dir<0?startCoords.top:startCoords.bottom;else{let line=view.viewState.lineBlockAt(startPos);null==goal&&(goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from))),startY=(dir<0?line.top:line.bottom)+docTop}let resolvedGoal=rect.left+goal,dist=null!=distance?distance:view.viewState.heightOracle.textHeight>>1;for(let extra=0;;extra+=10){let curY=startY+(dist+extra)*dir,pos=posAtCoords(view,{x:resolvedGoal,y:curY},!1,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos)){let charRect=view.docView.coordsForChar(pos),assoc=!charRect||curY<charRect.top?-1:1;return dist_EditorSelection.cursor(pos,assoc,void 0,goal)}}}(this,start,forward,distance))}domAtPos(pos){return this.docView.domAtPos(pos)}posAtDOM(node,offset=0){return this.docView.posFromDOM(node,offset)}posAtCoords(coords,precise=!0){return this.readMeasured(),posAtCoords(this,coords,precise)}coordsAtPos(pos,side=1){this.readMeasured();let rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;let line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);return flattenRect(rect,order[BidiSpan.find(order,pos-line.from,-1,side)].dir==Direction.LTR==side>0)}coordsForChar(pos){return this.readMeasured(),this.docView.coordsForChar(pos)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(pos){return!this.state.facet(perLineTextDirection)||pos<this.viewport.from||pos>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(pos))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(line){if(line.length>MaxBidiLine)return trivialOrder(line.length);let isolates,dir=this.textDirectionAt(line.from);for(let entry of this.bidiCache)if(entry.from==line.from&&entry.dir==dir&&(entry.fresh||isolatesEq(entry.isolates,isolates=getIsolatedRanges(this,line))))return entry.order;isolates||(isolates=getIsolatedRanges(this,line));let order=computeOrder(line.text,dir,isolates);return this.bidiCache.push(new CachedOrder(line.from,line.to,dir,isolates,!0,order)),order}get hasFocus(){var _a;return(this.dom.ownerDocument.hasFocus()||browser.safari&&(null===(_a=this.inputState)||void 0===_a?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()}))}setRoot(root){this._root!=root&&(this._root=root,this.observer.setWindow((9==root.nodeType?root:root.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let plugin of this.plugins)plugin.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(pos,options={}){return scrollIntoView.of(new ScrollTarget("number"==typeof pos?dist_EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin))}scrollSnapshot(){let{scrollTop,scrollLeft}=this.scrollDOM,ref=this.viewState.scrollAnchorAt(scrollTop);return scrollIntoView.of(new ScrollTarget(dist_EditorSelection.cursor(ref.from),"start","start",ref.top-scrollTop,scrollLeft,!0))}static domEventHandlers(handlers){return ViewPlugin.define((()=>({})),{eventHandlers:handlers})}static domEventObservers(observers){return ViewPlugin.define((()=>({})),{eventObservers:observers})}static theme(spec,options){let prefix=StyleModule.newName(),result=[theme.of(prefix),styleModule.of(buildTheme(`.${prefix}`,spec))];return options&&options.dark&&result.push(darkTheme.of(!0)),result}static baseTheme(spec){return dist_Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,spec,lightDarkIDs)))}static findFromDOM(dom){var _a;let content=dom.querySelector(".cm-content"),cView=content&&ContentView.get(content)||ContentView.get(dom);return(null===(_a=null==cView?void 0:cView.rootView)||void 0===_a?void 0:_a.view)||null}}EditorView.styleModule=styleModule,EditorView.inputHandler=inputHandler,EditorView.scrollHandler=scrollHandler,EditorView.focusChangeEffect=focusChangeEffect,EditorView.perLineTextDirection=perLineTextDirection,EditorView.exceptionSink=exceptionSink,EditorView.updateListener=updateListener,EditorView.editable=editable,EditorView.mouseSelectionStyle=mouseSelectionStyle,EditorView.dragMovesSelection=dragMovesSelection$1,EditorView.clickAddsSelectionRange=clickAddsSelectionRange,EditorView.decorations=decorations,EditorView.outerDecorations=outerDecorations,EditorView.atomicRanges=atomicRanges,EditorView.bidiIsolatedRanges=bidiIsolatedRanges,EditorView.scrollMargins=scrollMargins,EditorView.darkTheme=darkTheme,EditorView.cspNonce=Facet.define({combine:values=>values.length?values[0]:""}),EditorView.contentAttributes=contentAttributes,EditorView.editorAttributes=editorAttributes,EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"}),EditorView.announce=dist_StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(from,to,dir,isolates,fresh,order){this.from=from,this.to=to,this.dir=dir,this.isolates=isolates,this.fresh=fresh,this.order=order}static update(cache,changes){if(changes.empty&&!cache.some((c=>c.fresh)))return cache;let result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction.LTR;for(let i=Math.max(0,cache.length-10);i<cache.length;i++){let entry=cache[i];entry.dir!=lastDir||changes.touchesRange(entry.from,entry.to)||result.push(new CachedOrder(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.isolates,!1,entry.order))}return result}}function attrsFromFacet(view,facet,base){for(let sources=view.state.facet(facet),i=sources.length-1;i>=0;i--){let source=sources[i],value="function"==typeof source?source(view):source;value&&combineAttrs(value,base)}return base}browser.mac||browser.windows||browser.linux;const CanHidePrimary=!browser.ios;const themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important",themeSpec[".cm-content"]={caretColor:"transparent !important"});class GutterMarker extends RangeValue{compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}eq(other){return!1}destroy(dom){}}GutterMarker.prototype.elementClass="",GutterMarker.prototype.toDOM=void 0,GutterMarker.prototype.mapMode=dist_MapMode.TrackBefore,GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1,GutterMarker.prototype.point=!0},"./node_modules/collaborative-editor/lib/Selection.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Selection=void 0;exports.Selection=class Selection{constructor(){this.start=null,this.end=null,this.dir=0,this.ts=0,this.tick=0,this.startId=null,this.endId=null}}},"./node_modules/collaborative-editor/lib/StrBinding.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrBinding=void 0;const util_1=__webpack_require__("./node_modules/collaborative-editor/lib/util.js"),Selection_1=__webpack_require__("./node_modules/collaborative-editor/lib/Selection.js"),util_2=__webpack_require__("./node_modules/collaborative-editor/lib/util.js"),diff=__webpack_require__("./node_modules/fast-diff/diff.js");class StrBinding{constructor(str,editor){this.str=str,this.editor=editor,this.race=(0,util_1.invokeFirstOnly)(),this.onModelChange=()=>{this.race((()=>{this.syncFromModel();const{editor,selection,str}=this;if(editor.setSelection){const start=selection.startId?str.findPos(selection.startId)+1:-1,end=selection.endId?str.findPos(selection.endId)+1:-1;editor.setSelection(start,end,selection.dir)}this.saveSelection()}))},this.onchange=changes=>{this.race((()=>{if(changes){let expected=this.str.view();for(const change of changes)expected=(0,util_2.applyChange)(expected,change);const editor=this.editor;if((!editor.getLength||expected.length===editor.getLength())&&expected===editor.get()){const str=this.str;for(const change of changes){const[position,remove,insert]=change;remove&&str.del(position,remove),insert&&str.ins(position,insert)}return void this.saveSelection()}}this.syncFromEditor()}))},this.pollingInterval=1e3,this._p=null,this.pollChanges=()=>{this._p=setTimeout((()=>{this.race((()=>{try{const view=this.str.view(),editor=this.editor;(!!editor.getLength&&view.length!==editor.getLength()||view!==editor.get())&&this.syncFromEditor()}catch(_a){}this._p&&this.pollChanges()}))}),this.pollingInterval)},this._s=null,this.bind=polling=>{this.syncFromModel();const editor=this.editor;editor.onchange=this.onchange,editor.onselection=()=>this.saveSelection(),polling&&this.pollChanges(),this._s=this.str.api.onChange.listen(this.onModelChange)},this.unbind=()=>{var _a,_b,_c;this.stopPolling(),null===(_a=this._s)||void 0===_a||_a.call(this),null===(_c=(_b=this.editor).dispose)||void 0===_c||_c.call(_b)},editor.selection=this.selection=new Selection_1.Selection}saveSelection(){var _a,_b,_c;const{str,editor,selection}=this,[selectionStart,selectionEnd,selectionDirection]=(null===(_a=editor.getSelection)||void 0===_a?void 0:_a.call(editor))||[-1,-1,0],{start,end}=selection,now=Date.now(),tick=str.api.model.tick;start===selectionStart&&end===selectionEnd&&(tick===selection.tick||now-selection.ts<3e3)||(selection.start=selectionStart,selection.end=selectionEnd,selection.dir=selectionDirection,selection.ts=now,selection.tick=tick,selection.startId="number"==typeof selectionStart&&null!==(_b=str.findId((null!=selectionStart?selectionStart:0)-1))&&void 0!==_b?_b:null,selection.endId="number"==typeof selectionEnd&&null!==(_c=str.findId((null!=selectionEnd?selectionEnd:0)-1))&&void 0!==_c?_c:null)}syncFromModel(){const{editor,str}=this;if(editor.ins&&editor.del){const view=str.view(),editorText=editor.get();if(view===editorText)return;const changes=diff(editorText,view),changeLen=changes.length;let pos=0;for(let i=0;i<changeLen;i++){const change=changes[i],[type,text]=change,len=text.length;switch(type){case-1:editor.del(pos,len);break;case 0:pos+=len;break;case 1:editor.ins(pos,text),pos+=len}}}else editor.set(str.view())}syncFromEditor(){var _a;const{str,editor}=this,view=str.view(),value=editor.get();if(value===view)return;const selection=this.selection,caretPos=selection.start===selection.end&&null!==(_a=selection.start)&&void 0!==_a?_a:void 0,changes=diff(view,value,caretPos),changeLen=changes.length;let pos=0;for(let i=0;i<changeLen;i++){const change=changes[i],[type,text]=change;switch(type){case-1:str.del(pos,text.length);break;case 0:pos+=text.length;break;case 1:str.ins(pos,text),pos+=text.length}}this.saveSelection()}stopPolling(){this._p&&clearTimeout(this._p),this._p=null}}exports.StrBinding=StrBinding,StrBinding.bind=(str,editor,polling)=>{const binding=new StrBinding(str,editor);return binding.syncFromModel(),binding.bind(polling),binding.unbind}},"./node_modules/collaborative-editor/lib/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/collaborative-editor/lib/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/collaborative-editor/lib/Selection.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/collaborative-editor/lib/StrBinding.js"),exports)},"./node_modules/collaborative-editor/lib/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/collaborative-editor/lib/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.invokeFirstOnly=exports.applyChange=void 0;exports.applyChange=(str,[position,remove,insert])=>str.slice(0,position)+insert+str.slice(position+remove);exports.invokeFirstOnly=()=>{let invoked=!1;return fn=>{if(!invoked){invoked=!0;try{fn()}finally{invoked=!1}}}}},"./node_modules/fast-diff/diff.js":module=>{var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;function diff_main(text1,text2,cursor_pos,cleanup,_fix_unicode){if(text1===text2)return text1?[[DIFF_EQUAL,text1]]:[];if(null!=cursor_pos){var editdiff=function find_cursor_edit_diff(oldText,newText,cursor_pos){var oldRange="number"==typeof cursor_pos?{index:cursor_pos,length:0}:cursor_pos.oldRange,newRange="number"==typeof cursor_pos?null:cursor_pos.newRange,oldLength=oldText.length,newLength=newText.length;if(0===oldRange.length&&(null===newRange||0===newRange.length)){var oldCursor=oldRange.index,oldBefore=oldText.slice(0,oldCursor),oldAfter=oldText.slice(oldCursor),maybeNewCursor=newRange?newRange.index:null,newCursor=oldCursor+newLength-oldLength;if((null===maybeNewCursor||maybeNewCursor===newCursor)&&!(newCursor<0||newCursor>newLength)){var newBefore=newText.slice(0,newCursor);if((newAfter=newText.slice(newCursor))===oldAfter){var prefixLength=Math.min(oldCursor,newCursor);if((oldPrefix=oldBefore.slice(0,prefixLength))===(newPrefix=newBefore.slice(0,prefixLength)))return make_edit_splice(oldPrefix,oldBefore.slice(prefixLength),newBefore.slice(prefixLength),oldAfter)}}if(null===maybeNewCursor||maybeNewCursor===oldCursor){var cursor=oldCursor,newAfter=(newBefore=newText.slice(0,cursor),newText.slice(cursor));if(newBefore===oldBefore){var suffixLength=Math.min(oldLength-cursor,newLength-cursor);if((oldSuffix=oldAfter.slice(oldAfter.length-suffixLength))===(newSuffix=newAfter.slice(newAfter.length-suffixLength)))return make_edit_splice(oldBefore,oldAfter.slice(0,oldAfter.length-suffixLength),newAfter.slice(0,newAfter.length-suffixLength),oldSuffix)}}}if(oldRange.length>0&&newRange&&0===newRange.length){var oldPrefix=oldText.slice(0,oldRange.index),oldSuffix=oldText.slice(oldRange.index+oldRange.length);if(!(newLength<(prefixLength=oldPrefix.length)+(suffixLength=oldSuffix.length))){var newPrefix=newText.slice(0,prefixLength),newSuffix=newText.slice(newLength-suffixLength);if(oldPrefix===newPrefix&&oldSuffix===newSuffix)return make_edit_splice(oldPrefix,oldText.slice(prefixLength,oldLength-suffixLength),newText.slice(prefixLength,newLength-suffixLength),oldSuffix)}}return null}(text1,text2,cursor_pos);if(editdiff)return editdiff}var commonlength=diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);commonlength=diff_commonSuffix(text1=text1.substring(commonlength),text2=text2.substring(commonlength));var commonsuffix=text1.substring(text1.length-commonlength),diffs=function diff_compute_(text1,text2){var diffs;if(!text1)return[[DIFF_INSERT,text2]];if(!text2)return[[DIFF_DELETE,text1]];var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);if(-1!==i)return diffs=[[DIFF_INSERT,longtext.substring(0,i)],[DIFF_EQUAL,shorttext],[DIFF_INSERT,longtext.substring(i+shorttext.length)]],text1.length>text2.length&&(diffs[0][0]=diffs[2][0]=DIFF_DELETE),diffs;if(1===shorttext.length)return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]];var hm=function diff_halfMatch_(text1,text2){var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||2*shorttext.length<longtext.length)return null;function diff_halfMatchI_(longtext,shorttext,i){for(var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,seed=longtext.substring(i,i+Math.floor(longtext.length/4)),j=-1,best_common="";-1!==(j=shorttext.indexOf(seed,j+1));){var prefixLength=diff_commonPrefix(longtext.substring(i),shorttext.substring(j)),suffixLength=diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));best_common.length<suffixLength+prefixLength&&(best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength),best_longtext_a=longtext.substring(0,i-suffixLength),best_longtext_b=longtext.substring(i+prefixLength),best_shorttext_a=shorttext.substring(0,j-suffixLength),best_shorttext_b=shorttext.substring(j+prefixLength))}return 2*best_common.length>=longtext.length?[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]:null}var hm,text1_a,text1_b,text2_a,text2_b,hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));if(!hm1&&!hm2)return null;hm=hm2?hm1&&hm1[4].length>hm2[4].length?hm1:hm2:hm1;text1.length>text2.length?(text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3]):(text2_a=hm[0],text2_b=hm[1],text1_a=hm[2],text1_b=hm[3]);var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]}(text1,text2);if(hm){var text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3],mid_common=hm[4],diffs_a=diff_main(text1_a,text2_a),diffs_b=diff_main(text1_b,text2_b);return diffs_a.concat([[DIFF_EQUAL,mid_common]],diffs_b)}return function diff_bisect_(text1,text2){for(var text1_length=text1.length,text2_length=text2.length,max_d=Math.ceil((text1_length+text2_length)/2),v_offset=max_d,v_length=2*max_d,v1=new Array(v_length),v2=new Array(v_length),x=0;x<v_length;x++)v1[x]=-1,v2[x]=-1;v1[v_offset+1]=0,v2[v_offset+1]=0;for(var delta=text1_length-text2_length,front=delta%2!=0,k1start=0,k1end=0,k2start=0,k2end=0,d=0;d<max_d;d++){for(var k1=-d+k1start;k1<=d-k1end;k1+=2){for(var k1_offset=v_offset+k1,y1=(x1=k1===-d||k1!==d&&v1[k1_offset-1]<v1[k1_offset+1]?v1[k1_offset+1]:v1[k1_offset-1]+1)-k1;x1<text1_length&&y1<text2_length&&text1.charAt(x1)===text2.charAt(y1);)x1++,y1++;if(v1[k1_offset]=x1,x1>text1_length)k1end+=2;else if(y1>text2_length)k1start+=2;else if(front){if((k2_offset=v_offset+delta-k1)>=0&&k2_offset<v_length&&-1!==v2[k2_offset])if(x1>=(x2=text1_length-v2[k2_offset]))return diff_bisectSplit_(text1,text2,x1,y1)}}for(var k2=-d+k2start;k2<=d-k2end;k2+=2){for(var x2,k2_offset=v_offset+k2,y2=(x2=k2===-d||k2!==d&&v2[k2_offset-1]<v2[k2_offset+1]?v2[k2_offset+1]:v2[k2_offset-1]+1)-k2;x2<text1_length&&y2<text2_length&&text1.charAt(text1_length-x2-1)===text2.charAt(text2_length-y2-1);)x2++,y2++;if(v2[k2_offset]=x2,x2>text1_length)k2end+=2;else if(y2>text2_length)k2start+=2;else if(!front){if((k1_offset=v_offset+delta-k2)>=0&&k1_offset<v_length&&-1!==v1[k1_offset]){var x1;y1=v_offset+(x1=v1[k1_offset])-k1_offset;if(x1>=(x2=text1_length-x2))return diff_bisectSplit_(text1,text2,x1,y1)}}}}return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]]}(text1,text2)}(text1=text1.substring(0,text1.length-commonlength),text2=text2.substring(0,text2.length-commonlength));return commonprefix&&diffs.unshift([DIFF_EQUAL,commonprefix]),commonsuffix&&diffs.push([DIFF_EQUAL,commonsuffix]),diff_cleanupMerge(diffs,_fix_unicode),cleanup&&function diff_cleanupSemantic(diffs){var changes=!1,equalities=[],equalitiesLength=0,lastequality=null,pointer=0,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0;for(;pointer<diffs.length;)diffs[pointer][0]==DIFF_EQUAL?(equalities[equalitiesLength++]=pointer,length_insertions1=length_insertions2,length_deletions1=length_deletions2,length_insertions2=0,length_deletions2=0,lastequality=diffs[pointer][1]):(diffs[pointer][0]==DIFF_INSERT?length_insertions2+=diffs[pointer][1].length:length_deletions2+=diffs[pointer][1].length,lastequality&&lastequality.length<=Math.max(length_insertions1,length_deletions1)&&lastequality.length<=Math.max(length_insertions2,length_deletions2)&&(diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]),diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT,equalitiesLength--,pointer=--equalitiesLength>0?equalities[equalitiesLength-1]:-1,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0,lastequality=null,changes=!0)),pointer++;changes&&diff_cleanupMerge(diffs);(function diff_cleanupSemanticLossless(diffs){function diff_cleanupSemanticScore_(one,two){if(!one||!two)return 6;var char1=one.charAt(one.length-1),char2=two.charAt(0),nonAlphaNumeric1=char1.match(nonAlphaNumericRegex_),nonAlphaNumeric2=char2.match(nonAlphaNumericRegex_),whitespace1=nonAlphaNumeric1&&char1.match(whitespaceRegex_),whitespace2=nonAlphaNumeric2&&char2.match(whitespaceRegex_),lineBreak1=whitespace1&&char1.match(linebreakRegex_),lineBreak2=whitespace2&&char2.match(linebreakRegex_),blankLine1=lineBreak1&&one.match(blanklineEndRegex_),blankLine2=lineBreak2&&two.match(blanklineStartRegex_);return blankLine1||blankLine2?5:lineBreak1||lineBreak2?4:nonAlphaNumeric1&&!whitespace1&&whitespace2?3:whitespace1||whitespace2?2:nonAlphaNumeric1||nonAlphaNumeric2?1:0}var pointer=1;for(;pointer<diffs.length-1;){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){var equality1=diffs[pointer-1][1],edit=diffs[pointer][1],equality2=diffs[pointer+1][1],commonOffset=diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset),edit=commonString+edit.substring(0,edit.length-commonOffset),equality2=commonString+equality2}for(var bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2,bestScore=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);edit.charAt(0)===equality2.charAt(0);){equality1+=edit.charAt(0),edit=edit.substring(1)+equality2.charAt(0),equality2=equality2.substring(1);var score=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);score>=bestScore&&(bestScore=score,bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2)}diffs[pointer-1][1]!=bestEquality1&&(bestEquality1?diffs[pointer-1][1]=bestEquality1:(diffs.splice(pointer-1,1),pointer--),diffs[pointer][1]=bestEdit,bestEquality2?diffs[pointer+1][1]=bestEquality2:(diffs.splice(pointer+1,1),pointer--))}pointer++}})(diffs),pointer=1;for(;pointer<diffs.length;){if(diffs[pointer-1][0]==DIFF_DELETE&&diffs[pointer][0]==DIFF_INSERT){var deletion=diffs[pointer-1][1],insertion=diffs[pointer][1],overlap_length1=diff_commonOverlap_(deletion,insertion),overlap_length2=diff_commonOverlap_(insertion,deletion);overlap_length1>=overlap_length2?(overlap_length1>=deletion.length/2||overlap_length1>=insertion.length/2)&&(diffs.splice(pointer,0,[DIFF_EQUAL,insertion.substring(0,overlap_length1)]),diffs[pointer-1][1]=deletion.substring(0,deletion.length-overlap_length1),diffs[pointer+1][1]=insertion.substring(overlap_length1),pointer++):(overlap_length2>=deletion.length/2||overlap_length2>=insertion.length/2)&&(diffs.splice(pointer,0,[DIFF_EQUAL,deletion.substring(0,overlap_length2)]),diffs[pointer-1][0]=DIFF_INSERT,diffs[pointer-1][1]=insertion.substring(0,insertion.length-overlap_length2),diffs[pointer+1][0]=DIFF_DELETE,diffs[pointer+1][1]=deletion.substring(overlap_length2),pointer++),pointer++}pointer++}}(diffs),diffs}function diff_bisectSplit_(text1,text2,x,y){var text1a=text1.substring(0,x),text2a=text2.substring(0,y),text1b=text1.substring(x),text2b=text2.substring(y),diffs=diff_main(text1a,text2a),diffsb=diff_main(text1b,text2b);return diffs.concat(diffsb)}function diff_commonPrefix(text1,text2){if(!text1||!text2||text1.charAt(0)!==text2.charAt(0))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;pointermin<pointermid;)text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)?pointerstart=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return is_surrogate_pair_start(text1.charCodeAt(pointermid-1))&&pointermid--,pointermid}function diff_commonOverlap_(text1,text2){var text1_length=text1.length,text2_length=text2.length;if(0==text1_length||0==text2_length)return 0;text1_length>text2_length?text1=text1.substring(text1_length-text2_length):text1_length<text2_length&&(text2=text2.substring(0,text1_length));var text_length=Math.min(text1_length,text2_length);if(text1==text2)return text_length;for(var best=0,length=1;;){var pattern=text1.substring(text_length-length),found=text2.indexOf(pattern);if(-1==found)return best;length+=found,0!=found&&text1.substring(text_length-length)!=text2.substring(0,length)||(best=length,length++)}}function diff_commonSuffix(text1,text2){if(!text1||!text2||text1.slice(-1)!==text2.slice(-1))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;pointermin<pointermid;)text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)?pointerend=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return is_surrogate_pair_end(text1.charCodeAt(text1.length-pointermid))&&pointermid--,pointermid}var nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,whitespaceRegex_=/\s/,linebreakRegex_=/[\r\n]/,blanklineEndRegex_=/\n\r?\n$/,blanklineStartRegex_=/^\r?\n\r?\n/;function diff_cleanupMerge(diffs,fix_unicode){diffs.push([DIFF_EQUAL,""]);for(var commonlength,pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;)if(pointer<diffs.length-1&&!diffs[pointer][1])diffs.splice(pointer,1);else switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++,text_insert+=diffs[pointer][1],pointer++;break;case DIFF_DELETE:count_delete++,text_delete+=diffs[pointer][1],pointer++;break;case DIFF_EQUAL:var previous_equality=pointer-count_insert-count_delete-1;if(fix_unicode){if(previous_equality>=0&&ends_with_pair_start(diffs[previous_equality][1])){var stray=diffs[previous_equality][1].slice(-1);if(diffs[previous_equality][1]=diffs[previous_equality][1].slice(0,-1),text_delete=stray+text_delete,text_insert=stray+text_insert,!diffs[previous_equality][1]){diffs.splice(previous_equality,1),pointer--;var k=previous_equality-1;diffs[k]&&diffs[k][0]===DIFF_INSERT&&(count_insert++,text_insert=diffs[k][1]+text_insert,k--),diffs[k]&&diffs[k][0]===DIFF_DELETE&&(count_delete++,text_delete=diffs[k][1]+text_delete,k--),previous_equality=k}}if(starts_with_pair_end(diffs[pointer][1])){stray=diffs[pointer][1].charAt(0);diffs[pointer][1]=diffs[pointer][1].slice(1),text_delete+=stray,text_insert+=stray}}if(pointer<diffs.length-1&&!diffs[pointer][1]){diffs.splice(pointer,1);break}if(text_delete.length>0||text_insert.length>0){text_delete.length>0&&text_insert.length>0&&(0!==(commonlength=diff_commonPrefix(text_insert,text_delete))&&(previous_equality>=0?diffs[previous_equality][1]+=text_insert.substring(0,commonlength):(diffs.splice(0,0,[DIFF_EQUAL,text_insert.substring(0,commonlength)]),pointer++),text_insert=text_insert.substring(commonlength),text_delete=text_delete.substring(commonlength)),0!==(commonlength=diff_commonSuffix(text_insert,text_delete))&&(diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1],text_insert=text_insert.substring(0,text_insert.length-commonlength),text_delete=text_delete.substring(0,text_delete.length-commonlength)));var n=count_insert+count_delete;0===text_delete.length&&0===text_insert.length?(diffs.splice(pointer-n,n),pointer-=n):0===text_delete.length?(diffs.splice(pointer-n,n,[DIFF_INSERT,text_insert]),pointer=pointer-n+1):0===text_insert.length?(diffs.splice(pointer-n,n,[DIFF_DELETE,text_delete]),pointer=pointer-n+1):(diffs.splice(pointer-n,n,[DIFF_DELETE,text_delete],[DIFF_INSERT,text_insert]),pointer=pointer-n+2)}0!==pointer&&diffs[pointer-1][0]===DIFF_EQUAL?(diffs[pointer-1][1]+=diffs[pointer][1],diffs.splice(pointer,1)):pointer++,count_insert=0,count_delete=0,text_delete="",text_insert=""}""===diffs[diffs.length-1][1]&&diffs.pop();var changes=!1;for(pointer=1;pointer<diffs.length-1;)diffs[pointer-1][0]===DIFF_EQUAL&&diffs[pointer+1][0]===DIFF_EQUAL&&(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)===diffs[pointer-1][1]?(diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length),diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1],diffs.splice(pointer-1,1),changes=!0):diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]&&(diffs[pointer-1][1]+=diffs[pointer+1][1],diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1],diffs.splice(pointer+1,1),changes=!0)),pointer++;changes&&diff_cleanupMerge(diffs,fix_unicode)}function is_surrogate_pair_start(charCode){return charCode>=55296&&charCode<=56319}function is_surrogate_pair_end(charCode){return charCode>=56320&&charCode<=57343}function starts_with_pair_end(str){return is_surrogate_pair_end(str.charCodeAt(0))}function ends_with_pair_start(str){return is_surrogate_pair_start(str.charCodeAt(str.length-1))}function make_edit_splice(before,oldMiddle,newMiddle,after){return ends_with_pair_start(before)||starts_with_pair_end(after)?null:function remove_empty_tuples(tuples){for(var ret=[],i=0;i<tuples.length;i++)tuples[i][1].length>0&&ret.push(tuples[i]);return ret}([[DIFF_EQUAL,before],[DIFF_DELETE,oldMiddle],[DIFF_INSERT,newMiddle],[DIFF_EQUAL,after]])}function diff(text1,text2,cursor_pos,cleanup){return diff_main(text1,text2,cursor_pos,cleanup,!0)}diff.INSERT=DIFF_INSERT,diff.DELETE=DIFF_DELETE,diff.EQUAL=DIFF_EQUAL,module.exports=diff},"./node_modules/hyperdyperid/lib/randomU32.js":(__unused_webpack_module,exports)=>{var x=1+Math.round(4294967294*Math.random());exports.randomU32=function randomU32(min,max){return x^=x<<13,x^=x>>>17,((x^=x<<5)>>>0)%(max-min+1)+min}},"./node_modules/json-joy/es2020/json-crdt-patch/Patch.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Patch=void 0;const operations=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/operations.js")),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),binary_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/index.js");class Patch{constructor(){this.ops=[],this.meta=void 0}static fromBinary(data){return(0,binary_1.decode)(data)}getId(){const op=this.ops[0];if(op)return op.id}span(){let span=0;for(const op of this.ops)span+=op.span();return span}nextTime(){const ops=this.ops,length=ops.length;if(!length)return 0;const lastOp=ops[length-1];return lastOp.id.time+lastOp.span()}rewriteTime(ts){const patch=new Patch,ops=this.ops,length=ops.length,patchOps=patch.ops;for(let i=0;i<length;i++){const op=ops[i];op instanceof operations.DelOp?patchOps.push(new operations.DelOp(ts(op.id),ts(op.obj),op.what)):op instanceof operations.NewConOp?patchOps.push(new operations.NewConOp(ts(op.id),op.val)):op instanceof operations.NewVecOp?patchOps.push(new operations.NewVecOp(ts(op.id))):op instanceof operations.NewValOp?patchOps.push(new operations.NewValOp(ts(op.id))):op instanceof operations.NewObjOp?patchOps.push(new operations.NewObjOp(ts(op.id))):op instanceof operations.NewStrOp?patchOps.push(new operations.NewStrOp(ts(op.id))):op instanceof operations.NewBinOp?patchOps.push(new operations.NewBinOp(ts(op.id))):op instanceof operations.NewArrOp?patchOps.push(new operations.NewArrOp(ts(op.id))):op instanceof operations.InsArrOp?patchOps.push(new operations.InsArrOp(ts(op.id),ts(op.obj),ts(op.ref),op.data.map(ts))):op instanceof operations.InsStrOp?patchOps.push(new operations.InsStrOp(ts(op.id),ts(op.obj),ts(op.ref),op.data)):op instanceof operations.InsBinOp?patchOps.push(new operations.InsBinOp(ts(op.id),ts(op.obj),ts(op.ref),op.data)):op instanceof operations.InsValOp?patchOps.push(new operations.InsValOp(ts(op.id),ts(op.obj),ts(op.val))):op instanceof operations.InsObjOp?patchOps.push(new operations.InsObjOp(ts(op.id),ts(op.obj),op.data.map((([key,value])=>[key,ts(value)])))):op instanceof operations.NopOp&&patchOps.push(new operations.NopOp(ts(op.id),op.len))}return patch}rebase(serverTime,transformHorizon){const id=this.getId();if(!id)throw new Error("EMPTY_PATCH");const patchStartTime=id.time;if(patchStartTime===serverTime)return this;const delta=serverTime-patchStartTime;return this.rewriteTime((id=>{if(!(1===id.sid))return id;const time=id.time;return time<transformHorizon?id:(0,clock_1.ts)(1,time+delta)}))}clone(){return this.rewriteTime((id=>id))}toBinary(){return(0,binary_1.encode)(this)}toString(tab=""){const id=this.getId();let out=`${this.constructor.name} ${id?(0,clock_1.toDisplayString)(id):"(nil)"}!${this.span()}`;for(let i=0;i<this.ops.length;i++){const isLast=i===this.ops.length-1;out+=`\n${tab}${isLast?"└─":"├─"} ${this.ops[i].toString(tab+(isLast?"  ":"│ "))}`}return out}}exports.Patch=Patch},"./node_modules/json-joy/es2020/json-crdt-patch/PatchBuilder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PatchBuilder=void 0;const operations_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/operations.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),isUint8Array_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/isUint8Array.js"),Patch_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/Patch.js"),constants_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/constants.js"),Tuple_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/Tuple.js"),Konst_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/Konst.js"),DelayedValueBuilder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/DelayedValueBuilder.js"),maybeConst=x=>{switch(typeof x){case"number":case"boolean":return!0;default:return null===x}};exports.PatchBuilder=class PatchBuilder{constructor(clock){this.clock=clock,this.patch=new Patch_1.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const patch=this.patch;return this.patch=new Patch_1.Patch,patch}obj(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewObjOp(id)),id}arr(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewArrOp(id)),id}vec(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewVecOp(id)),id}str(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewStrOp(id)),id}bin(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewBinOp(id)),id}const(value){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewConOp(id,value)),id}val(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewValOp(id)),id}root(val){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.InsValOp(id,constants_1.ORIGIN,val)),id}insObj(obj,data){if(this.pad(),!data.length)throw new Error("EMPTY_TUPLES");const id=this.clock.tick(1),op=new operations_1.InsObjOp(id,obj,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insVec(obj,data){if(this.pad(),!data.length)throw new Error("EMPTY_TUPLES");const id=this.clock.tick(1),op=new operations_1.InsVecOp(id,obj,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}setVal(obj,val){this.pad();const id=this.clock.tick(1),op=new operations_1.InsValOp(id,obj,val);return this.patch.ops.push(op),id}insStr(obj,ref,data){if(this.pad(),!data.length)throw new Error("EMPTY_STRING");const id=this.clock.tick(1),op=new operations_1.InsStrOp(id,obj,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insBin(obj,ref,data){if(this.pad(),!data.length)throw new Error("EMPTY_BINARY");const id=this.clock.tick(1),op=new operations_1.InsBinOp(id,obj,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insArr(arr,ref,data){this.pad();const id=this.clock.tick(1),op=new operations_1.InsArrOp(id,arr,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}del(obj,what){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.DelOp(id,obj,what)),id}nop(span){this.pad();const id=this.clock.tick(span);return this.patch.ops.push(new operations_1.NopOp(id,span)),id}jsonObj(obj){const id=this.obj(),keys=Object.keys(obj);if(keys.length){const tuples=[];for(const k of keys){const value=obj[k],valueId=value instanceof clock_1.Timestamp?value:maybeConst(value)?this.const(value):this.json(value);tuples.push([k,valueId])}this.insObj(id,tuples)}return id}jsonArr(arr){const id=this.arr();if(arr.length){const values=[];for(const el of arr)values.push(this.json(el));this.insArr(id,id,values)}return id}jsonStr(str){const id=this.str();return str&&this.insStr(id,id,str),id}jsonBin(bin){const id=this.bin();return bin.length&&this.insBin(id,id,bin),id}jsonVal(value){const valId=this.val(),id=this.const(value);return this.setVal(valId,id),valId}jsonVec(vector){const id=this.vec(),length=vector.length;if(length){const writes=[];for(let i=0;i<length;i++)writes.push([i,this.constOrJson(vector[i])]);this.insVec(id,writes)}return id}json(json){if(json instanceof clock_1.Timestamp)return json;if(void 0===json)return this.const(json);if(json instanceof Array)return this.jsonArr(json);if((0,isUint8Array_1.isUint8Array)(json))return this.jsonBin(json);if(json instanceof Tuple_1.VectorDelayedValue)return this.jsonVec(json.slots);if(json instanceof Konst_1.Konst)return this.const(json.val);if(json instanceof DelayedValueBuilder_1.NodeBuilder)return json.build(this);switch(typeof json){case"object":return null===json?this.jsonVal(json):this.jsonObj(json);case"string":return this.jsonStr(json);case"number":case"boolean":return this.jsonVal(json)}throw new Error("INVALID_JSON")}constOrJson(value){return value instanceof clock_1.Timestamp?value:maybeConst(value)?this.const(value):this.json(value)}maybeConst(value){return value instanceof clock_1.Timestamp?value:this.const(value)}pad(){const nextTime=this.patch.nextTime();if(!nextTime)return;const drift=this.clock.time-nextTime;if(drift>0){const id=(0,clock_1.ts)(this.clock.sid,nextTime),padding=new operations_1.NopOp(id,drift);this.patch.ops.push(padding)}}}},"./node_modules/json-joy/es2020/json-crdt-patch/builder/DelayedValueBuilder.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delayed=exports.NodeBuilder=void 0;class NodeBuilder{constructor(build){this.build=build}}exports.NodeBuilder=NodeBuilder;exports.delayed=build=>new NodeBuilder(build)},"./node_modules/json-joy/es2020/json-crdt-patch/builder/Konst.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.konst=exports.Konst=void 0;class Konst{constructor(val){this.val=val}}exports.Konst=Konst;exports.konst=val=>new Konst(val)},"./node_modules/json-joy/es2020/json-crdt-patch/builder/Tuple.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vec=exports.VectorDelayedValue=void 0;class VectorDelayedValue{constructor(slots){this.slots=slots}}exports.VectorDelayedValue=VectorDelayedValue;exports.vec=(...slots)=>new VectorDelayedValue(slots)},"./node_modules/json-joy/es2020/json-crdt-patch/builder/schema.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.s=exports.schema=exports.nodes=void 0;const DelayedValueBuilder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/DelayedValueBuilder.js");var nodes;!function(nodes){class con extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super((builder=>builder.const(raw))),this.raw=raw,this.type="con"}}nodes.con=con;class str extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super((builder=>builder.json(raw))),this.raw=raw,this.type="str"}}nodes.str=str;class bin extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super((builder=>builder.json(raw))),this.raw=raw,this.type="bin"}}nodes.bin=bin;class val extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super((builder=>{const valId=builder.val(),valueId=value.build(builder);return builder.setVal(valId,valueId),valId})),this.value=value,this.type="val"}}nodes.val=val;class vec extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super((builder=>{const vecId=builder.vec(),length=value.length;if(length){const elementPairs=[];for(let i=0;i<length;i++){const elementId=value[i].build(builder);elementPairs.push([i,elementId])}builder.insVec(vecId,elementPairs)}return vecId})),this.value=value,this.type="vec"}}nodes.vec=vec;class obj extends DelayedValueBuilder_1.NodeBuilder{constructor(obj,opt){super((builder=>{const objId=builder.obj(),keyValuePairs=[],merged={...obj,...opt},keys=Object.keys(merged),length=keys.length;if(length){for(let i=0;i<length;i++){const key=keys[i],valueId=merged[key].build(builder);keyValuePairs.push([key,valueId])}builder.insObj(objId,keyValuePairs)}return objId})),this.obj=obj,this.opt=opt,this.type="obj"}optional(){return this}}nodes.obj=obj;class arr extends DelayedValueBuilder_1.NodeBuilder{constructor(arr){super((builder=>{const arrId=builder.arr(),length=arr.length;if(length){const valueIds=[];for(let i=0;i<length;i++)valueIds.push(arr[i].build(builder));builder.insArr(arrId,arrId,valueIds)}return arrId})),this.arr=arr,this.type="arr"}}nodes.arr=arr}(nodes||(exports.nodes=nodes={})),exports.schema={con:raw=>new nodes.con(raw),str:str=>new nodes.str(str||""),bin:bin=>new nodes.bin(bin),val:val=>new nodes.val(val),vec:(...vec)=>new nodes.vec(vec),obj:(obj,opt)=>new nodes.obj(obj,opt),map:obj=>exports.schema.obj(obj),arr:arr=>new nodes.arr(arr)},exports.s=exports.schema},"./node_modules/json-joy/es2020/json-crdt-patch/clock/clock.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServerClockVector=exports.ClockVector=exports.LogicalClock=exports.interval=exports.toDisplayString=exports.containsId=exports.contains=exports.compare=exports.equal=exports.tick=exports.tss=exports.ts=exports.Timespan=exports.Timestamp=void 0;class Timestamp{constructor(sid,time){this.sid=sid,this.time=time}}exports.Timestamp=Timestamp;class Timespan{constructor(sid,time,span){this.sid=sid,this.time=time,this.span=span}}exports.Timespan=Timespan;exports.ts=(sid,time)=>new Timestamp(sid,time);exports.tss=(sid,time,span)=>new Timespan(sid,time,span);exports.tick=(stamp,cycles)=>(0,exports.ts)(stamp.sid,stamp.time+cycles);exports.equal=(ts1,ts2)=>ts1.time===ts2.time&&ts1.sid===ts2.sid;exports.compare=(ts1,ts2)=>{const t1=ts1.time,t2=ts2.time;if(t1>t2)return 1;if(t1<t2)return-1;const s1=ts1.sid,s2=ts2.sid;return s1>s2?1:s1<s2?-1:0};exports.contains=(ts1,span1,ts2,span2)=>{if(ts1.sid!==ts2.sid)return!1;const t1=ts1.time,t2=ts2.time;return!(t1>t2)&&!(t1+span1<t2+span2)};exports.containsId=(ts1,span1,ts2)=>{if(ts1.sid!==ts2.sid)return!1;const t1=ts1.time,t2=ts2.time;return!(t1>t2)&&!(t1+span1<t2+1)};exports.toDisplayString=id=>{if(1===id.sid)return"."+id.time;let session=""+id.sid;return session.length>4&&(session=".."+session.slice(session.length-4)),session+"."+id.time};exports.interval=(ts,tick,span)=>new Timespan(ts.sid,ts.time+tick,span);class LogicalClock extends Timestamp{tick(cycles){const timestamp=new Timestamp(this.sid,this.time);return this.time+=cycles,timestamp}}exports.LogicalClock=LogicalClock;class ClockVector extends LogicalClock{constructor(){super(...arguments),this.peers=new Map}observe(id,span){const edge=id.time+span-1,sid=id.sid;if(sid!==this.sid){const clock=this.peers.get(id.sid);clock?edge>clock.time&&(clock.time=edge):this.peers.set(id.sid,(0,exports.ts)(sid,edge))}edge>=this.time&&(this.time=edge+1)}clone(){return this.fork(this.sid)}fork(sessionId){const clock=new ClockVector(sessionId,this.time);return sessionId!==this.sid&&clock.observe((0,exports.tick)(this,-1),1),this.peers.forEach((peer=>{clock.observe(peer,1)})),clock}toString(tab=""){const last=this.peers.size;let i=1,lines="";return this.peers.forEach((clock=>{lines+=`\n${tab}${i===last?"└─":"├─"} ${clock.sid}.${clock.time}`,i++})),`clock ${this.sid}.${this.time}${lines}`}}exports.ClockVector=ClockVector;class ServerClockVector extends LogicalClock{constructor(){super(...arguments),this.peers=new Map}observe(ts,span){if(1!==ts.sid)throw new Error("INVALID_SERVER_SESSION");if(this.time<ts.time)throw new Error("TIME_TRAVEL");const time=ts.time+span;time>this.time&&(this.time=time)}clone(){return this.fork()}fork(){return new ServerClockVector(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}exports.ServerClockVector=ServerClockVector},"./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/clock.js"),exports)},"./node_modules/json-joy/es2020/json-crdt-patch/clock/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decoder=void 0;const CrdtReader_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtReader.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),PatchBuilder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/PatchBuilder.js"),CborDecoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborDecoder.js");class Decoder extends CborDecoder_1.CborDecoder{constructor(reader=new CrdtReader_1.CrdtReader){super(reader)}decode(data){const reader=this.reader;reader.reset(data);const sid=reader.vu57(),time=reader.vu57(),clock=1===sid?new clock_1.ServerClockVector(1,time):new clock_1.ClockVector(sid,time);this.patchSid=clock.sid;const builder=this.builder=new PatchBuilder_1.PatchBuilder(clock),map=this.val();return map instanceof Array&&(builder.patch.meta=map[0]),this.decodeOperations(),builder.patch}decodeId(){const reader=this.reader,[isSessionDifferent,x]=reader.b1vu56();return isSessionDifferent?new clock_1.Timestamp(reader.vu57(),x):new clock_1.Timestamp(this.patchSid,x)}decodeTss(){const id=this.decodeId(),span=this.reader.vu57();return(0,clock_1.interval)(id,0,span)}decodeOperations(){const length=this.reader.vu57();for(let i=0;i<length;i++)this.decodeOperation()}decodeOperation(){const builder=this.builder,reader=this.reader,octet=reader.u8();switch(octet>>3){case 0:{const length=7&octet;builder.const(length?this.decodeId():this.val());break}case 1:builder.val();break;case 2:builder.obj();break;case 3:builder.vec();break;case 4:builder.str();break;case 5:builder.bin();break;case 6:builder.arr();break;case 9:{const obj=this.decodeId(),val=this.decodeId();builder.setVal(obj,val);break}case 10:{const length=7&octet||reader.vu57(),obj=this.decodeId(),tuples=[];for(let i=0;i<length;i++){const key=this.val();if("string"!=typeof key)continue;const value=this.decodeId();tuples.push([key,value])}builder.insObj(obj,tuples);break}case 11:{const length=7&octet||reader.vu57(),obj=this.decodeId(),tuples=[];for(let i=0;i<length;i++){const index=this.val();if("number"!=typeof index)continue;const value=this.decodeId();tuples.push([index,value])}builder.insVec(obj,tuples);break}case 12:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),str=reader.utf8(length);builder.insStr(obj,after,str);break}case 13:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),buf=reader.buf(length);if(!(buf instanceof Uint8Array))return;builder.insBin(obj,after,buf);break}case 14:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),elements=[];for(let i=0;i<length;i++)elements.push(this.decodeId());builder.insArr(obj,after,elements);break}case 16:{const length=7&octet||reader.vu57(),obj=this.decodeId(),what=[];for(let i=0;i<length;i++)what.push(this.decodeTss());builder.del(obj,what);break}case 17:{const length=7&octet||reader.vu57();builder.nop(length);break}default:throw new Error("UNKNOWN_OP")}}}exports.Decoder=Decoder},"./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Encoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Encoder=void 0;const operations=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/operations.js")),CrdtWriter_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtWriter.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),CborEncoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborEncoder.js");class Encoder extends CborEncoder_1.CborEncoder{constructor(writer=new CrdtWriter_1.CrdtWriter){super(writer),this.writer=writer,this.patchSid=0}encode(patch){this.writer.reset();const id=patch.getId(),sid=this.patchSid=id.sid,writer=this.writer;writer.vu57(sid),writer.vu57(id.time);const meta=patch.meta;return void 0===meta?this.writeUndef():this.writeArr([meta]),this.encodeOperations(patch),writer.flush()}encodeOperations(patch){const ops=patch.ops,length=ops.length;this.writer.vu57(length);for(let i=0;i<length;i++)this.encodeOperation(ops[i])}encodeId(id){const sessionId=id.sid,time=id.time,writer=this.writer;sessionId===this.patchSid?writer.b1vu56(0,time):(writer.b1vu56(1,time),writer.vu57(sessionId))}encodeTss(span){this.encodeId(span),this.writer.vu57(span.span)}writeInsStr(length,obj,ref,str){const writer=this.writer;return length<=7?writer.u8(96+length):(writer.u8(96),writer.vu57(length)),this.encodeId(obj),this.encodeId(ref),writer.utf8(str)}encodeOperation(op){const writer=this.writer;switch(op.constructor){case operations.NewConOp:{const val=op.val;val instanceof clock_1.Timestamp?(writer.u8(1),this.encodeId(val)):(writer.u8(0),this.writeAny(val));break}case operations.NewValOp:writer.u8(8);break;case operations.NewObjOp:writer.u8(16);break;case operations.NewVecOp:writer.u8(24);break;case operations.NewStrOp:writer.u8(32);break;case operations.NewBinOp:writer.u8(40);break;case operations.NewArrOp:writer.u8(48);break;case operations.InsValOp:{const operation=op;writer.u8(72),this.encodeId(operation.obj),this.encodeId(operation.val);break}case operations.InsObjOp:{const operation=op,data=operation.data,length=data.length;length<=7?writer.u8(80+length):(writer.u8(80),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++){const tuple=data[i];this.writeStr(tuple[0]),this.encodeId(tuple[1])}break}case operations.InsVecOp:{const operation=op,data=operation.data,length=data.length;length<=7?writer.u8(88+length):(writer.u8(88),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++){const tuple=data[i];writer.u8(tuple[0]),this.encodeId(tuple[1])}break}case operations.InsStrOp:{const operation=op,obj=operation.obj,ref=operation.ref,str=operation.data,len1=str.length;writer.ensureCapacity(24+4*len1);const x=writer.x,len2=this.writeInsStr(len1,obj,ref,str);len1!==len2&&(writer.x=x,this.writeInsStr(len2,obj,ref,str));break}case operations.InsBinOp:{const operation=op,buf=operation.data,length=buf.length;length<=7?writer.u8(104+length):(writer.u8(104),writer.vu57(length)),this.encodeId(operation.obj),this.encodeId(operation.ref),writer.buf(buf,length);break}case operations.InsArrOp:{const operation=op,elements=operation.data,length=elements.length;length<=7?writer.u8(112+length):(writer.u8(112),writer.vu57(length)),this.encodeId(operation.obj),this.encodeId(operation.ref);for(let i=0;i<length;i++)this.encodeId(elements[i]);break}case operations.DelOp:{const operation=op,what=operation.what,length=what.length;length<=7?writer.u8(128+length):(writer.u8(128),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++)this.encodeTss(what[i]);break}case operations.NopOp:{const length=op.len;length<=7?writer.u8(136+length):(writer.u8(136),writer.vu57(length));break}default:throw new Error("UNKNOWN_OP")}}}exports.Encoder=Encoder},"./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Encoder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Decoder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/shared.js"),exports)},"./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/shared.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decode=exports.decoder=exports.encode=exports.encoder=void 0;const Encoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Encoder.js"),Decoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/binary/Decoder.js"),writer=new(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtWriter.js").CrdtWriter)(4096);exports.encoder=new Encoder_1.Encoder(writer);exports.encode=patch=>exports.encoder.encode(patch),exports.decoder=new Decoder_1.Decoder;exports.decode=buf=>exports.decoder.decode(buf)},"./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/ClockDecoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClockDecoder=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js");class ClockDecoder{static fromArr(arr){const decoder=new ClockDecoder(arr[0],arr[1]),length=arr.length;for(let i=2;i<length;i+=2)decoder.pushTuple(arr[i],arr[i+1]);return decoder}constructor(sid,time){this.table=[],this.clock=new clock_1.ClockVector(sid,time+1),this.table.push((0,clock_1.ts)(sid,time))}pushTuple(sid,time){const id=(0,clock_1.ts)(sid,time);this.clock.observe(id,1),this.table.push(id)}decodeId(sessionIndex,timeDiff){if(!sessionIndex)return(0,clock_1.ts)(0,timeDiff);const clock=this.table[sessionIndex-1];if(!clock)throw new Error("INVALID_CLOCK_TABLE");return(0,clock_1.ts)(clock.sid,clock.time-timeDiff)}}exports.ClockDecoder=ClockDecoder},"./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/ClockEncoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClockEncoder=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),RelativeTimestamp_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/RelativeTimestamp.js");class ClockTableEntry{constructor(index,clock){this.index=index,this.clock=clock}}exports.ClockEncoder=class ClockEncoder{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(clock){this.index=1,this.clock=clock;const entry=new ClockTableEntry(this.index++,(0,clock_1.tick)(clock,-1));this.table.clear(),this.table.set(clock.sid,entry)}append(ts){const time=ts.time,sid=ts.sid;let entry=this.table.get(sid);if(!entry){let clock=this.clock.peers.get(sid);clock||(clock=new clock_1.Timestamp(sid,this.clock.time-1)),entry=new ClockTableEntry(this.index++,clock),this.table.set(sid,entry)}const timeDiff=entry.clock.time-time;if(timeDiff<0)throw new Error("TIME_TRAVEL");return new RelativeTimestamp_1.RelativeTimestamp(entry.index,timeDiff)}toJson(){const out=[];return this.table.forEach((entry=>{const clock=entry.clock;out.push(clock.sid,clock.time)})),out}}},"./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/RelativeTimestamp.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RelativeTimestamp=void 0;exports.RelativeTimestamp=class RelativeTimestamp{constructor(sessionIndex,timeDiff){this.sessionIndex=sessionIndex,this.timeDiff=timeDiff}}},"./node_modules/json-joy/es2020/json-crdt-patch/constants.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ORIGIN=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js");exports.ORIGIN=(0,clock_1.ts)(0,0)},"./node_modules/json-joy/es2020/json-crdt-patch/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/operations.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/Patch.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/PatchBuilder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/schema.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/Konst.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/Tuple.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/builder/DelayedValueBuilder.js"),exports)},"./node_modules/json-joy/es2020/json-crdt-patch/operations.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NopOp=exports.DelOp=exports.InsArrOp=exports.InsBinOp=exports.InsStrOp=exports.InsVecOp=exports.InsObjOp=exports.InsValOp=exports.NewArrOp=exports.NewBinOp=exports.NewStrOp=exports.NewVecOp=exports.NewObjOp=exports.NewValOp=exports.NewConOp=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js");exports.NewConOp=class NewConOp{constructor(id,val){this.id=id,this.val=val}span(){return 1}name(){return"new_con"}toString(tab=""){const val=this.val,valFormatted=val instanceof clock_1.Timestamp?`{ ${(0,clock_1.toDisplayString)(val)} }`:val instanceof Uint8Array?val.length<13?`Uint8Array { ${(""+val).replaceAll(",",", ")} }`:`Uint8Array(${val.length})`:`{ ${JSON.stringify(val)} }`;return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)} ${valFormatted}`}};exports.NewValOp=class NewValOp{constructor(id){this.id=id}span(){return 1}name(){return"new_val"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.NewObjOp=class NewObjOp{constructor(id){this.id=id}span(){return 1}name(){return"new_obj"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.NewVecOp=class NewVecOp{constructor(id){this.id=id}span(){return 1}name(){return"new_vec"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.NewStrOp=class NewStrOp{constructor(id){this.id=id}span(){return 1}name(){return"new_str"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.NewBinOp=class NewBinOp{constructor(id){this.id=id}span(){return 1}name(){return"new_bin"}toString(tab=""){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.NewArrOp=class NewArrOp{constructor(id){this.id=id}span(){return 1}name(){return"new_arr"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}`}};exports.InsValOp=class InsValOp{constructor(id,obj,val){this.id=id,this.obj=obj,this.val=val}span(){return 1}name(){return"ins_val"}toString(tab=""){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)}, val = ${(0,clock_1.toDisplayString)(this.val)}`}};exports.InsObjOp=class InsObjOp{constructor(id,obj,data){this.id=id,this.obj=obj,this.data=data}span(){return 1}name(){return"ins_obj"}toString(tab=""){let out=`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)}`;for(let i=0;i<this.data.length;i++){out+=`\n${tab}  ${i===this.data.length-1?"└─":"├─"} ${JSON.stringify(this.data[i][0])}: ${(0,clock_1.toDisplayString)(this.data[i][1])}`}return out}};exports.InsVecOp=class InsVecOp{constructor(id,obj,data){this.id=id,this.obj=obj,this.data=data}span(){return 1}name(){return"ins_vec"}toString(tab=""){let out=`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)}`;for(let i=0;i<this.data.length;i++){out+=`\n${tab}  ${i===this.data.length-1?"└─":"├─"} ${JSON.stringify(this.data[i][0])}: ${(0,clock_1.toDisplayString)(this.data[i][1])}`}return out}};exports.InsStrOp=class InsStrOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_str"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)} { ${(0,clock_1.toDisplayString)(this.ref)} ← ${JSON.stringify(this.data)} }`}};exports.InsBinOp=class InsBinOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_bin"}toString(tab=""){const ref=(0,clock_1.toDisplayString)(this.ref);return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)} { ${ref} ← ${this.data} }`}};exports.InsArrOp=class InsArrOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_arr"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.span()}, obj = ${(0,clock_1.toDisplayString)(this.obj)} { ${(0,clock_1.toDisplayString)(this.ref)} ← ${this.data.map(clock_1.toDisplayString).join(", ")} }`}};exports.DelOp=class DelOp{constructor(id,obj,what){this.id=id,this.obj=obj,this.what=what}span(){return 1}name(){return"del"}toString(){const spans=this.what.map((span=>(0,clock_1.toDisplayString)(span)+"!"+span.span)).join(", ");return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}, obj = ${(0,clock_1.toDisplayString)(this.obj)} { ${spans} }`}};exports.NopOp=class NopOp{constructor(id,len){this.id=id,this.len=len}span(){return this.len}name(){return"nop"}toString(){return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)}!${this.len}`}}},"./node_modules/json-joy/es2020/json-crdt-patch/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtReader.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CrdtReader=void 0;const Reader_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/Reader.js");class CrdtReader extends Reader_1.Reader{id(){const byte=this.u8();return byte<=127?[byte>>>4,15&byte]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const o1=this.u8();if(o1<=127)return o1;const o2=this.u8();if(o2<=127)return o2<<7|127&o1;const o3=this.u8();if(o3<=127)return o3<<14|(127&o2)<<7|127&o1;const o4=this.u8();if(o4<=127)return o4<<21|(127&o3)<<14|(127&o2)<<7|127&o1;const o5=this.u8();if(o5<=127)return 268435456*o5+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1);const o6=this.u8();if(o6<=127)return 34359738368*o6+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1));const o7=this.u8();if(o7<=127)return 4398046511104*o7+(34359738368*(127&o6)+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1)));return 562949953421312*this.u8()+(4398046511104*(127&o7)+(34359738368*(127&o6)+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1))))}vu57Skip(){if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;this.u8()<=127||this.x++}b1vu56(){const byte=this.u8(),flag=128&byte?1:0,o1=127&byte;if(o1<=63)return[flag,o1];const o2=this.u8();if(o2<=127)return[flag,o2<<6|63&o1];const o3=this.u8();if(o3<=127)return[flag,o3<<13|(127&o2)<<6|63&o1];const o4=this.u8();if(o4<=127)return[flag,o4<<20|(127&o3)<<13|(127&o2)<<6|63&o1];const o5=this.u8();if(o5<=127)return[flag,134217728*o5+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1)];const o6=this.u8();if(o6<=127)return[flag,17179869184*o6+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1))];const o7=this.u8();if(o7<=127)return[flag,2199023255552*o7+(17179869184*(127&o6)+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1)))];return[flag,281474976710656*this.u8()+(2199023255552*(127&o7)+(17179869184*(127&o6)+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1))))]}}exports.CrdtReader=CrdtReader},"./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtWriter.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CrdtWriter=void 0;const Writer_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/Writer.js");class CrdtWriter extends Writer_1.Writer{id(x,y){x<=7&&y<=15?this.u8(x<<4|y):(this.b1vu56(1,x),this.vu57(y))}vu57(num){if(num<=127)this.u8(num);else if(num<=16383){this.ensureCapacity(2);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=num>>>7}else if(num<=2097151){this.ensureCapacity(3);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=num>>>14}else if(num<=268435455){this.ensureCapacity(4);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=num>>>21}else{let lo32=0|num;lo32<0&&(lo32+=4294967296);const hi32=(num-lo32)/4294967296;if(num<=34359738367){this.ensureCapacity(5);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=hi32<<4|num>>>28}else if(num<=4398046511103){this.ensureCapacity(6);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=hi32>>>3}else if(num<=562949953421311){this.ensureCapacity(7);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=128|(1016&hi32)>>>3,uint8[this.x++]=hi32>>>10}else{this.ensureCapacity(8);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=128|(1016&hi32)>>>3,uint8[this.x++]=128|(130048&hi32)>>>10,uint8[this.x++]=hi32>>>17}}}b1vu56(flag,num){if(num<=63)this.u8(flag<<7|num);else{const firstByteMask=flag<<7|64;if(num<=8191){this.ensureCapacity(2);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=num>>>6}else if(num<=1048575){this.ensureCapacity(3);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=num>>>13}else if(num<=134217727){this.ensureCapacity(4);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=num>>>20}else{let lo32=0|num;lo32<0&&(lo32+=4294967296);const hi32=(num-lo32)/4294967296;if(num<=17179869183){this.ensureCapacity(5);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=hi32<<5|num>>>27}else if(num<=2199023255551){this.ensureCapacity(6);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=hi32>>>2}else if(num<=0xffffffffffff){this.ensureCapacity(7);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=128|(508&hi32)>>>2,uint8[this.x++]=hi32>>>9}else{this.ensureCapacity(8);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=128|(508&hi32)>>>2,uint8[this.x++]=128|(65024&hi32)>>>9,uint8[this.x++]=hi32>>>16}}}}}exports.CrdtWriter=CrdtWriter},"./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decoder=void 0;const nodes=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js")),ClockDecoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/ClockDecoder.js"),CrdtReader_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtReader.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),Model_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/Model.js"),CborDecoderBase_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborDecoderBase.js");class Decoder extends CborDecoderBase_1.CborDecoderBase{constructor(){super(new CrdtReader_1.CrdtReader),this.time=-1,this.cStrChunk=()=>{const id=this.ts(),val=this.val();return"string"==typeof val?new nodes.StrChunk(id,val.length,val):new nodes.StrChunk(id,~~val,"")},this.cBinChunk=()=>{const id=this.ts(),reader=this.reader,[deleted,length]=reader.b1vu56();return deleted?new nodes.BinChunk(id,length,void 0):new nodes.BinChunk(id,length,reader.buf(length))},this.cArrChunk=()=>{const id=this.ts(),[deleted,length]=this.reader.b1vu56();if(deleted)return new nodes.ArrChunk(id,length,void 0);const ids=[];for(let i=0;i<length;i++)ids.push(this.cNode().id);return new nodes.ArrChunk(id,length,ids)}}decode(data,model){delete this.clockDecoder,this.time=-1;const reader=this.reader;reader.reset(data);if(128&reader.peak()){reader.x++;const time=this.time=reader.vu57();model||(model=Model_1.Model.withServerClock(time))}else if(this.decodeClockTable(),!model){const clock=this.clockDecoder.clock;model=Model_1.Model.withLogicalClock(clock)}return this.doc=model,model.root=new nodes.RootNode(this.doc,this.cRoot().id),delete this.clockDecoder,model}decodeClockTable(){const reader=this.reader,clockTableOffset=reader.u32(),offset=reader.x;reader.x+=clockTableOffset;const length=reader.vu57(),sessionId=reader.vu57(),time=reader.vu57();this.clockDecoder=new ClockDecoder_1.ClockDecoder(sessionId,time);for(let i=1;i<length;i++){const sid=reader.vu57(),time=reader.vu57();this.clockDecoder.pushTuple(sid,time)}reader.x=offset}ts(){if(this.time<0){const[sessionIndex,timeDiff]=this.reader.id();return this.clockDecoder.decodeId(sessionIndex,timeDiff)}return new clock_1.Timestamp(1,this.reader.vu57())}cRoot(){const reader=this.reader;return reader.uint8[reader.x]?this.cNode():Model_1.UNDEFINED}cNode(){const reader=this.reader,id=this.ts(),octet=reader.u8(),minor=31&octet;switch(octet>>5){case 0:return this.cCon(id,minor);case 1:return this.cVal(id);case 2:return this.cObj(id,31!==minor?minor:reader.vu57());case 3:return this.cVec(id,31!==minor?minor:reader.vu57());case 4:return this.cStr(id,31!==minor?minor:reader.vu57());case 5:return this.cBin(id,31!==minor?minor:reader.vu57());case 6:return this.cArr(id,31!==minor?minor:reader.vu57())}throw new Error("UNKNOWN_NODE")}cCon(id,length){const doc=this.doc,data=length?this.ts():this.val(),node=new nodes.ConNode(id,data);return doc.index.set(id,node),node}cVal(id){const child=this.cNode(),doc=this.doc,node=new nodes.ValNode(doc,id,child.id);return doc.index.set(id,node),node}cObj(id,length){const obj=new nodes.ObjNode(this.doc,id);for(let i=0;i<length;i++)this.cObjChunk(obj);return this.doc.index.set(id,obj),obj}cObjChunk(obj){const key=this.key();obj.keys.set(key,this.cNode().id)}cVec(id,length){const reader=this.reader,obj=new nodes.VecNode(this.doc,id),elements=obj.elements;for(let i=0;i<length;i++){reader.peak()?elements.push(this.cNode().id):(reader.x++,elements.push(void 0))}return this.doc.index.set(id,obj),obj}cStr(id,length){const node=new nodes.StrNode(id);return length&&node.ingest(length,this.cStrChunk),this.doc.index.set(id,node),node}cBin(id,length){const node=new nodes.BinNode(id);return length&&node.ingest(length,this.cBinChunk),this.doc.index.set(id,node),node}cArr(id,length){const obj=new nodes.ArrNode(this.doc,id);return length&&obj.ingest(length,this.cArrChunk),this.doc.index.set(id,obj),obj}}exports.Decoder=Decoder},"./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/Encoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Encoder=void 0;const nodes=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js")),ClockEncoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/codec/clock/ClockEncoder.js"),CrdtWriter_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/util/binary/CrdtWriter.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),CborEncoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborEncoder.js");class Encoder extends CborEncoder_1.CborEncoder{constructor(writer){super(writer||new CrdtWriter_1.CrdtWriter),this.clockEncoder=new ClockEncoder_1.ClockEncoder,this.time=0,this.cTableEntry=entry=>{const clock=entry.clock,writer=this.writer;writer.vu57(clock.sid),writer.vu57(clock.time)},this.tsLogical=ts=>{const relativeId=this.clockEncoder.append(ts);this.writer.id(relativeId.sessionIndex,relativeId.timeDiff)},this.tsServer=ts=>{this.writer.vu57(ts.time)},this.ts=this.tsLogical,this.cKey=(val,key)=>{this.writeStr(key),this.cNode(this.doc.index.get(val))}}encode(doc){this.doc=doc;const writer=this.writer;return writer.reset(),1===doc.clock.sid?this.encodeServer(doc):this.encodeLogical(doc),writer.flush()}encodeLogical(model){const writer=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(model.clock),writer.ensureCapacity(4);const x0=writer.x0,x=writer.x;writer.x+=4,this.cRoot(model.root),this.encodeClockTable(x0,x)}encodeServer(model){this.ts=this.tsServer;const writer=this.writer;writer.u8(128),writer.vu57(this.time=model.clock.time),this.cRoot(model.root)}encodeClockTable(x0,x){const writer=this.writer,shift=writer.x0-x0;writer.view.setUint32(writer.x0+(x-x0),writer.x-x-shift-4);const table=this.clockEncoder.table,length=table.size;writer.vu57(length),table.forEach(this.cTableEntry)}cRoot(root){0===root.val.sid?this.writer.u8(0):this.cNode(root.node())}writeTL(majorOverlay,length){const writer=this.writer;length<31?writer.u8(majorOverlay|length):(writer.u8(31|majorOverlay),writer.vu57(length))}cNode(node){node instanceof nodes.ConNode?this.cCon(node):node instanceof nodes.ValNode?this.cVal(node):node instanceof nodes.StrNode?this.cStr(node):node instanceof nodes.ObjNode?this.cObj(node):node instanceof nodes.VecNode?this.cVec(node):node instanceof nodes.ArrNode?this.cArr(node):node instanceof nodes.BinNode&&this.cBin(node)}cCon(node){const val=node.val;this.ts(node.id),val instanceof clock_1.Timestamp?(this.writer.u8(1),this.ts(val)):(this.writer.u8(0),this.writeAny(val))}cVal(node){this.ts(node.id),this.writer.u8(32),this.cNode(node.node())}cObj(node){this.ts(node.id);const keys=node.keys;this.writeTL(64,keys.size),keys.forEach(this.cKey)}cVec(node){const elements=node.elements,length=elements.length;this.ts(node.id),this.writeTL(96,length);const index=this.doc.index;for(let i=0;i<length;i++){const elementId=elements[i];elementId?this.cNode(index.get(elementId)):this.writer.u8(0)}}cStr(node){const ts=this.ts;ts(node.id),this.writeTL(128,node.count);for(let chunk=node.first();chunk;chunk=node.next(chunk))ts(chunk.id),chunk.del?this.writeUInteger(chunk.span):this.writeStr(chunk.data)}cBin(node){const ts=this.ts,writer=this.writer;ts(node.id),this.writeTL(160,node.count);for(let chunk=node.first();chunk;chunk=node.next(chunk)){ts(chunk.id);const length=chunk.span,deleted=chunk.del;writer.b1vu56(~~deleted,length),deleted||writer.buf(chunk.data,length)}}cArr(node){const ts=this.ts,writer=this.writer;ts(node.id),this.writeTL(192,node.count);const index=this.doc.index;for(let chunk=node.first();chunk;chunk=node.next(chunk)){ts(chunk.id);const span=chunk.span,deleted=chunk.del;if(writer.b1vu56(~~deleted,span),deleted)continue;const nodes=chunk.data;for(let i=0;i<span;i++)this.cNode(index.get(nodes[i]))}}}exports.Encoder=Encoder},"./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/shared.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decoder=exports.encoder=void 0;const Encoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/Encoder.js"),Decoder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/Decoder.js");exports.encoder=new Encoder_1.Encoder,exports.decoder=new Decoder_1.Decoder},"./node_modules/json-joy/es2020/json-crdt/extensions/Extensions.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Extensions=void 0;const printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js");class Extensions{constructor(){this.ext={}}register(extension){this.ext[extension.id]=extension}get(id){return this.ext[id]}size(){return Object.keys(this.ext).length}clone(){const clone=new Extensions;for(const ext of Object.values(this.ext))clone.register(ext);return clone}toString(tab=""){const keys=Object.keys(this.ext).map((k=>+k)).sort();return"extensions"+(0,printTree_1.printTree)(tab,keys.map((k=>tab=>`${k}: ${this.ext[k].name}`)))}}exports.Extensions=Extensions},"./node_modules/json-joy/es2020/json-crdt/extensions/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/es2020/json-crdt/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/extensions/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/index.js"),exports)},"./node_modules/json-joy/es2020/json-crdt/model/Model.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=exports.UNDEFINED=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),operations=tslib_1.__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/operations.js")),clock=tslib_1.__importStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js")),ConNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/const/ConNode.js"),shared_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/codec/structural/binary/shared.js"),ModelApi_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/ModelApi.js"),constants_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/constants.js"),util_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/util.js"),nodes_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js"),Extensions_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/extensions/Extensions.js"),AvlMap_1=__webpack_require__("./node_modules/json-joy/es2020/util/trees/avl/AvlMap.js");exports.UNDEFINED=new ConNode_1.ConNode(constants_1.ORIGIN,void 0);class Model{static withLogicalClock(clockOrSessionId){const clockVector="number"==typeof clockOrSessionId?new clock.ClockVector(clockOrSessionId,1):clockOrSessionId||new clock.ClockVector((0,util_1.randomSessionId)(),1);return new Model(clockVector)}static withServerClock(time=0){const clockVector=new clock.ServerClockVector(1,time);return new Model(clockVector)}static fromBinary(data){return shared_1.decoder.decode(data)}constructor(clockVector){this.root=new nodes_1.RootNode(this,constants_1.ORIGIN),this.index=new AvlMap_1.AvlMap(clock.compare),this.ext=new Extensions_1.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=clockVector,clockVector.time||(clockVector.time=1)}get api(){return this._api||(this._api=new ModelApi_1.ModelApi(this)),this._api}get find(){return this.api.r.proxy()}get s(){return this.api.r.proxy().val}applyBatch(patches){const length=patches.length;for(let i=0;i<length;i++)this.applyPatch(patches[i])}applyPatch(patch){this.onbeforepatch?.(patch);const ops=patch.ops,{length}=ops;for(let i=0;i<length;i++)this.applyOperation(ops[i]);this.tick++,this.onpatch?.(patch)}applyOperation(op){this.clock.observe(op.id,op.span());const index=this.index;if(op instanceof operations.InsStrOp){const node=index.get(op.obj);node instanceof nodes_1.StrNode&&node.ins(op.ref,op.id,op.data)}else if(op instanceof operations.NewObjOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ObjNode(this,id))}else if(op instanceof operations.NewArrOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ArrNode(this,id))}else if(op instanceof operations.NewStrOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.StrNode(id))}else if(op instanceof operations.NewValOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ValNode(this,id,constants_1.ORIGIN))}else if(op instanceof operations.NewConOp){const id=op.id;index.get(id)||index.set(id,new ConNode_1.ConNode(id,op.val))}else if(op instanceof operations.InsObjOp){const node=index.get(op.obj),tuples=op.data,length=tuples.length;if(node instanceof nodes_1.ObjNode)for(let i=0;i<length;i++){const tuple=tuples[i],valueNode=index.get(tuple[1]);if(!valueNode)continue;if(node.id.time>=tuple[1].time)continue;const old=node.put(tuple[0]+"",valueNode.id);old&&this.deleteNodeTree(old)}}else if(op instanceof operations.InsVecOp){const node=index.get(op.obj),tuples=op.data,length=tuples.length;if(node instanceof nodes_1.VecNode)for(let i=0;i<length;i++){const tuple=tuples[i],valueNode=index.get(tuple[1]);if(!valueNode)continue;if(node.id.time>=tuple[1].time)continue;const old=node.put(Number(tuple[0]),valueNode.id);old&&this.deleteNodeTree(old)}}else if(op instanceof operations.InsValOp){const obj=op.obj,node=0===obj.sid&&0===obj.time?this.root:index.get(obj);if(node instanceof nodes_1.ValNode){if(index.get(op.val)){const old=node.set(op.val);old&&this.deleteNodeTree(old)}}}else if(op instanceof operations.InsArrOp){const node=index.get(op.obj);if(node instanceof nodes_1.ArrNode){const nodes=[],data=op.data,length=data.length;for(let i=0;i<length;i++){const stamp=data[i];index.get(stamp)&&(node.id.time>=stamp.time||nodes.push(stamp))}nodes.length&&node.ins(op.ref,op.id,nodes)}}else if(op instanceof operations.DelOp){const node=index.get(op.obj);if(node instanceof nodes_1.ArrNode){const length=op.what.length;for(let i=0;i<length;i++){const span=op.what[i];for(let j=0;j<span.span;j++){const id=node.getById(new clock.Timestamp(span.sid,span.time+j));id&&this.deleteNodeTree(id)}}node.delete(op.what)}else(node instanceof nodes_1.StrNode||node instanceof nodes_1.BinNode)&&node.delete(op.what)}else if(op instanceof operations.NewBinOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.BinNode(id))}else if(op instanceof operations.InsBinOp){const node=index.get(op.obj);node instanceof nodes_1.BinNode&&node.ins(op.ref,op.id,op.data)}else if(op instanceof operations.NewVecOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.VecNode(this,id))}}deleteNodeTree(value){if(0===value.sid)return;const node=this.index.get(value);if(!node)return;const api=node.api;api&&api.events.handleDelete(),node.children((child=>this.deleteNodeTree(child.id))),this.index.del(value)}fork(sessionId=(0,util_1.randomSessionId)()){const copy=Model.fromBinary(this.toBinary());return copy.clock.sid!==sessionId&&copy.clock instanceof clock.ClockVector&&(copy.clock=copy.clock.fork(sessionId)),copy.ext=this.ext,copy}clone(){return this.fork(this.clock.sid)}reset(to){this.onbeforereset?.();const index=this.index;this.index=new AvlMap_1.AvlMap(clock.compare);const blob=to.toBinary();shared_1.decoder.decode(blob,this),this.clock=to.clock.clone(),this.ext=to.ext.clone(),this._api?.flush(),index.forEach((({v:node})=>{const api=node.api;if(!api)return;const newNode=this.index.get(node.id);newNode?(api.node=newNode,newNode.api=api):api.events.handleDelete()})),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return shared_1.encoder.encode(this)}setSchema(schema){return this.clock.time<2&&this.api.root(schema),this}toString(tab=""){const nl=()=>"",hasExtensions=this.ext.size()>0;return"model"+(0,printTree_1.printTree)(tab,[tab=>this.root.toString(tab),nl,tab=>{const nodes=[];return this.index.forEach((item=>nodes.push(item.v))),`index (${nodes.length} nodes)`+(nodes.length?(0,printTree_1.printTree)(tab,nodes.map((node=>tab=>`${node.name()} ${clock.toDisplayString(node.id)}`))):"")},nl,tab=>`view${(0,printTree_1.printTree)(tab,[tab=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,"\n"+tab)])}`,nl,tab=>this.clock.toString(tab),hasExtensions?nl:null,hasExtensions?tab=>this.ext.toString(tab):null])}}exports.Model=Model},"./node_modules/json-joy/es2020/json-crdt/model/api/ModelApi.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelApi=void 0;const fanout_1=__webpack_require__("./node_modules/thingies/es2020/fanout.js"),nodes_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js"),nodes_2=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/nodes.js"),PatchBuilder_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/PatchBuilder.js"),fanout_2=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/fanout.js");exports.ModelApi=class ModelApi{constructor(model){this.model=model,this.next=0,this.onBeforeReset=new fanout_1.FanOut,this.onReset=new fanout_1.FanOut,this.onBeforePatch=new fanout_1.FanOut,this.onPatch=new fanout_1.FanOut,this.onBeforeLocalChange=new fanout_1.FanOut,this.onLocalChange=new fanout_1.FanOut,this.onLocalChanges=new fanout_2.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new fanout_1.FanOut,this.onTransaction=new fanout_1.FanOut,this.onChange=new fanout_2.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new fanout_2.MicrotaskBufferFanOut(this.onChange),this.onFlush=new fanout_1.FanOut,this.stopAutoFlush=void 0,this.subscribe=callback=>this.onChanges.listen((()=>callback())),this.getSnapshot=()=>this.view(),this.builder=new PatchBuilder_1.PatchBuilder(model.clock),model.onbeforereset=()=>this.onBeforeReset.emit(),model.onreset=()=>this.onReset.emit(),model.onbeforepatch=patch=>this.onBeforePatch.emit(patch),model.onpatch=patch=>this.onPatch.emit(patch)}wrap(node){if(node instanceof nodes_1.ValNode)return node.api||(node.api=new nodes_2.ValApi(node,this));if(node instanceof nodes_1.StrNode)return node.api||(node.api=new nodes_2.StrApi(node,this));if(node instanceof nodes_1.BinNode)return node.api||(node.api=new nodes_2.BinApi(node,this));if(node instanceof nodes_1.ArrNode)return node.api||(node.api=new nodes_2.ArrApi(node,this));if(node instanceof nodes_1.ObjNode)return node.api||(node.api=new nodes_2.ObjApi(node,this));if(node instanceof nodes_1.ConNode)return node.api||(node.api=new nodes_2.ConApi(node,this));if(node instanceof nodes_1.VecNode)return node.api||(node.api=new nodes_2.VecApi(node,this));throw new Error("UNKNOWN_NODE")}get r(){return new nodes_2.ValApi(this.model.root,this)}get node(){return this.r.get()}in(path){return this.r.in(path)}find(path){return this.node.find(path)}val(path){return this.node.val(path)}vec(path){return this.node.tup(path)}str(path){return this.node.str(path)}bin(path){return this.node.bin(path)}arr(path){return this.node.arr(path)}obj(path){return this.node.obj(path)}const(path){return this.node.const(path)}root(json){const builder=this.builder;return builder.root(builder.json(json)),this.apply(),this}apply(){const ops=this.builder.patch.ops,length=ops.length,model=this.model,from=this.next;this.onBeforeLocalChange.emit(from);for(let i=this.next;i<length;i++)model.applyOperation(ops[i]);this.next=length,model.tick++,this.onLocalChange.emit(from)}advance(){const from=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(from)}view(){return this.model.view()}transaction(callback){this.onBeforeTransaction.emit(),callback(),this.onTransaction.emit()}flush(){const patch=this.builder.flush();return this.next=0,this.onFlush.emit(patch),patch}autoFlush(){const drain=()=>this.builder.patch.ops.length&&this.flush(),onLocalChangesUnsubscribe=this.onLocalChanges.listen(drain),onBeforeTransactionUnsubscribe=this.onBeforeTransaction.listen(drain),onTransactionUnsubscribe=this.onTransaction.listen(drain);return this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,onLocalChangesUnsubscribe(),onBeforeTransactionUnsubscribe(),onTransactionUnsubscribe()}}}},"./node_modules/json-joy/es2020/json-crdt/model/api/NodeEvents.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NodeEvents=void 0;const fanout_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/fanout.js");exports.NodeEvents=class NodeEvents{constructor(api){this.api=api,this.subscribe=callback=>this.onViewChanges.listen((()=>callback())),this.getSnapshot=()=>this.api.view(),this.onChanges=new fanout_1.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new fanout_1.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}}},"./node_modules/json-joy/es2020/json-crdt/model/api/fanout.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OnNewFanOut=exports.MapFanOut=exports.MicrotaskBufferFanOut=exports.MergeFanOut=void 0;const fanout_1=__webpack_require__("./node_modules/thingies/es2020/fanout.js");class MergeFanOut extends fanout_1.FanOut{constructor(fanouts){super(),this.fanouts=fanouts,this.unsubs=[]}listen(listener){this.listeners.size||(this.unsubs=this.fanouts.map((fanout=>fanout.listen((data=>this.emit(data))))));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||(this.unsubs.forEach((unsub=>unsub())),this.unsubs=[])}}}exports.MergeFanOut=MergeFanOut;class MicrotaskBufferFanOut extends fanout_1.FanOut{constructor(source){super(),this.source=source,this.buffer=[],this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen((data=>{const buffer=this.buffer;buffer.length||queueMicrotask((()=>{this.emit(buffer),this.buffer=[]})),buffer.push(data)})));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}exports.MicrotaskBufferFanOut=MicrotaskBufferFanOut;class MapFanOut extends fanout_1.FanOut{constructor(source,mapper){super(),this.source=source,this.mapper=mapper,this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen((data=>this.emit(this.mapper(data)))));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}exports.MapFanOut=MapFanOut;class OnNewFanOut extends fanout_1.FanOut{constructor(source,last=void 0){super(),this.source=source,this.last=last,this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen((data=>{this.last!==data&&this.emit(this.last=data)})));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}exports.OnNewFanOut=OnNewFanOut},"./node_modules/json-joy/es2020/json-crdt/model/api/find.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.find=void 0;const json_pointer_1=__webpack_require__("./node_modules/json-joy/es2020/json-pointer/index.js"),nodes_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js");exports.find=(startNode,path)=>{const steps=(0,json_pointer_1.toPath)(path);let node=startNode;const length=steps.length;if(!length)return node;let i=0;for(;i<length&&node;){const step=steps[i++];if(node=node.container(),!node)throw new Error("NOT_CONTAINER");if(node instanceof nodes_1.ObjNode){const nextNode=node.get(String(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}else if(node instanceof nodes_1.ArrNode){const nextNode=node.getNode(Number(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}else if(node instanceof nodes_1.VecNode){const nextNode=node.get(Number(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}}return node}},"./node_modules/json-joy/es2020/json-crdt/model/api/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelApi=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var ModelApi_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/ModelApi.js");Object.defineProperty(exports,"ModelApi",{enumerable:!0,get:function(){return ModelApi_1.ModelApi}}),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/nodes.js"),exports)},"./node_modules/json-joy/es2020/json-crdt/model/api/nodes.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrApi=exports.BinApi=exports.StrApi=exports.ObjApi=exports.VecApi=exports.ValApi=exports.ConApi=exports.NodeApi=void 0;const find_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/find.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),nodes_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/index.js"),NodeEvents_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/NodeEvents.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js");class NodeApi{constructor(node,api){this.node=node,this.api=api,this.ev=void 0}get events(){return this.ev||(this.ev=new NodeEvents_1.NodeEvents(this))}find(path){const node=this.node;if(void 0===path){if("function"==typeof node.child){const child=node.child();if(!child)throw new Error("NO_CHILD");return child}throw new Error("CANNOT_IN")}return"string"==typeof path&&path&&"/"!==path[0]&&(path="/"+path),"number"==typeof path&&(path=[path]),(0,find_1.find)(this.node,path)}in(path){const node=this.find(path);return this.api.wrap(node)}asVal(){if(this.node instanceof nodes_1.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof nodes_1.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof nodes_1.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof nodes_1.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asTup(){if(this.node instanceof nodes_1.VecNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asObj(){if(this.node instanceof nodes_1.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof nodes_1.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CONST")}asExt(ext){let node=this.node;for(;node;){if(node instanceof ext.Node)return new ext.Api(node,this.api);node=node.child?node.child():void 0}throw new Error("NOT_EXT")}val(path){return this.in(path).asVal()}str(path){return this.in(path).asStr()}bin(path){return this.in(path).asBin()}arr(path){return this.in(path).asArr()}tup(path){return this.in(path).asTup()}obj(path){return this.in(path).asObj()}const(path){return this.in(path).asCon()}view(){return this.node.view()}toString(tab=""){return this.constructor.name+(0,printTree_1.printTree)(tab,[tab=>this.node.toString(tab)])}}exports.NodeApi=NodeApi;exports.ConApi=class ConApi extends NodeApi{proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.ValApi=class ValApi extends NodeApi{get(){return this.in()}set(json){const{api,node}=this,val=api.builder.constOrJson(json);return api.builder.setVal(node.id,val),api.apply(),this}proxy(){const self=this;return{toApi:()=>this,toView:()=>this.node.view(),get val(){const childNode=self.node.node();return self.api.wrap(childNode).proxy()}}}};exports.VecApi=class VecApi extends NodeApi{get(key){return this.in(key)}set(entries){const{api,node}=this,{builder}=api;return builder.insVec(node.id,entries.map((([index,json])=>[index,builder.constOrJson(json)]))),api.apply(),this}push(...values){const length=this.length();this.set(values.map(((value,index)=>[length+index,value])))}length(){return this.node.elements.length}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();const index=Number(prop);if(Number.isNaN(index))throw new Error("INVALID_INDEX");const child=this.node.get(index);if(!child)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(child).proxy()}})}};exports.ObjApi=class ObjApi extends NodeApi{get(key){return this.in(key)}set(entries){const{api,node}=this,{builder}=api;return builder.insObj(node.id,Object.entries(entries).map((([key,json])=>[key,builder.constOrJson(json)]))),api.apply(),this}del(keys){const{api,node}=this,{builder}=api;return api.builder.insObj(node.id,keys.map((key=>[key,builder.const(void 0)]))),api.apply(),this}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();const key=String(prop),child=this.node.get(key);if(!child)throw new Error("NO_SUCH_KEY");return this.api.wrap(child).proxy()}})}};exports.StrApi=class StrApi extends NodeApi{ins(index,text){const{api,node}=this;api.onBeforeLocalChange.emit(api.next);const builder=api.builder;builder.pad();const nextTime=api.builder.nextTime(),id=new clock_1.Timestamp(builder.clock.sid,nextTime),after=node.insAt(index,id,text);if(!after)throw new Error("OUT_OF_BOUNDS");return builder.insStr(node.id,after,text),api.advance(),this}del(index,length){const{api,node}=this;api.onBeforeLocalChange.emit(api.next);const builder=api.builder;builder.pad();const spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");return node.delete(spans),builder.del(node.id,spans),api.advance(),this}findId(index){const node=this.node,max=node.length()-1;if(index>max&&(index=max),index<0)return node.id;return node.find(index)||node.id}findPos(id){const node=this.node,nodeId=node.id;if(nodeId.sid===id.sid&&nodeId.time===id.time)return-1;const chunk=node.findById(id);if(!chunk)return-1;return node.pos(chunk)+(chunk.del?0:id.time-chunk.id.time)}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.BinApi=class BinApi extends NodeApi{ins(index,data){const{api,node}=this,after=index?node.find(index-1):node.id;if(!after)throw new Error("OUT_OF_BOUNDS");return api.builder.insBin(node.id,after,data),api.apply(),this}del(index,length){const{api,node}=this,spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");return api.builder.del(node.id,spans),api.apply(),this}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.ArrApi=class ArrApi extends NodeApi{get(index){return this.in(index)}ins(index,values){const{api,node}=this,{builder}=api,after=index?node.find(index-1):node.id;if(!after)throw new Error("OUT_OF_BOUNDS");const valueIds=[];for(let i=0;i<values.length;i++)valueIds.push(builder.json(values[i]));return builder.insArr(node.id,after,valueIds),api.apply(),this}del(index,length){const{api,node}=this,spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");return api.builder.del(node.id,spans),api.apply(),this}length(){return this.node.length()}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();const index=Number(prop);if(Number.isNaN(index))throw new Error("INVALID_INDEX");const child=this.node.getNode(index);if(!child)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(child).proxy()}})}}},"./node_modules/json-joy/es2020/json-crdt/model/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var Model_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/Model.js");Object.defineProperty(exports,"Model",{enumerable:!0,get:function(){return Model_1.Model}}),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/api/index.js"),exports)},"./node_modules/json-joy/es2020/json-crdt/model/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.randomSessionId=void 0;exports.randomSessionId=()=>Math.floor(9007199254675456*Math.random()+65535)},"./node_modules/json-joy/es2020/json-crdt/nodes/arr/ArrNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrNode=exports.ArrChunk=void 0;const AbstractRga_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/rga/AbstractRga.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),printBinary_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printBinary.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js");class ArrChunk{constructor(id,span,data){this.id=id,this.span=span,this.len=data?span:0,this.del=!data,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=data}merge(data){this.data.push(...data),this.span=this.data.length}split(ticks){const span=this.span;if(this.span=ticks,!this.del){const rightData=this.data.splice(ticks);return new ArrChunk((0,clock_1.tick)(this.id,ticks),span-ticks,rightData)}return new ArrChunk((0,clock_1.tick)(this.id,ticks),span-ticks,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new ArrChunk(this.id,this.span,this.data?[...this.data]:void 0)}}exports.ArrChunk=ArrChunk;class ArrNode extends AbstractRga_1.AbstractRga{constructor(doc,id){super(id),this.doc=doc,this._tick=0,this._view=[],this.api=void 0}get(position){const pair=this.findChunk(position);if(pair)return pair[0].data[pair[1]]}getNode(position){const id=this.get(position);if(id)return this.doc.index.get(id)}getById(id){const chunk=this.findById(id);if(!chunk||chunk.del)return;const offset=id.time-chunk.id.time;return chunk.data[offset]}createChunk(id,data){return new ArrChunk(id,data?data.length:0,data)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const doc=this.doc,tick=doc.clock.time+doc.tick,_view=this._view;if(this._tick===tick)return _view;const view=[],index=doc.index;let useCache=!0;for(let chunk=this.first();chunk;chunk=this.next(chunk))if(!chunk.del)for(const node of chunk.data){const elementNode=index.get(node);if(!elementNode){useCache=!1;continue}const element=elementNode.view();_view[view.length]!==element&&(useCache=!1),view.push(element)}_view.length!==view.length&&(useCache=!1);return useCache?_view:(this._tick=tick,this._view=view)}children(callback){const index=this.doc.index;for(let chunk=this.first();chunk;chunk=this.next(chunk))if(!chunk.del)for(const node of chunk.data)callback(index.get(node))}name(){return"arr"}printChunk(tab,chunk){const pos=this.pos(chunk);let valueTree="";if(!chunk.del){const index=this.doc.index;valueTree=(0,printTree_1.printTree)(tab,chunk.data.map((id=>index.get(id))).filter((node=>!!node)).map(((node,i)=>tab=>`[${pos+i}]: ${node.toString(tab+"    "+" ".repeat(String(i).length))}`)))}return this.formatChunk(chunk)+valueTree+(0,printBinary_1.printBinary)(tab,[chunk.l?tab=>this.printChunk(tab,chunk.l):null,chunk.r?tab=>this.printChunk(tab,chunk.r):null])}}exports.ArrNode=ArrNode},"./node_modules/json-joy/es2020/json-crdt/nodes/bin/BinNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BinNode=exports.BinChunk=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),AbstractRga_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/rga/AbstractRga.js");class BinChunk{constructor(id,span,buf){this.id=id,this.span=span,this.len=buf?span:0,this.del=!buf,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=buf}merge(data){const length=this.data.length,combined=new Uint8Array(length+data.length);combined.set(this.data),combined.set(data,length),this.data=combined,this.span=combined.length}split(ticks){if(!this.del){const data=this.data,rightBuffer=data.subarray(ticks),chunk=new BinChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,rightBuffer);return this.data=data.subarray(0,ticks),this.span=ticks,chunk}const chunk=new BinChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,void 0);return this.span=ticks,chunk}delete(){this.del=!0,this.data=void 0}clone(){return new BinChunk(this.id,this.span,this.data)}}exports.BinChunk=BinChunk;class BinNode extends AbstractRga_1.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const res=new Uint8Array(this.length());let offset=0,chunk=this.first();for(;chunk;){if(!chunk.del){const buf=chunk.data;res.set(buf,offset),offset+=buf.length}chunk=this.next(chunk)}return this._view=res}children(){}child(){}container(){}name(){return"bin"}createChunk(id,buf){return new BinChunk(id,buf?buf.length:0,buf)}onChange(){this._view=null}toStringName(){return this.name()}}exports.BinNode=BinNode},"./node_modules/json-joy/es2020/json-crdt/nodes/const/ConNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js");exports.ConNode=class ConNode{constructor(id,val){this.id=id,this.val=val,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(tab){const val=this.val,valFormatted=val instanceof Uint8Array?`Uint8Array { ${(""+val).replaceAll(",",", ")} }`:`{ ${val instanceof clock_1.Timestamp?(0,clock_1.toDisplayString)(val):JSON.stringify(val)} }`;return`${this.name()} ${(0,clock_1.toDisplayString)(this.id)} ${valFormatted}`}}},"./node_modules/json-joy/es2020/json-crdt/nodes/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/nodes.js"),exports)},"./node_modules/json-joy/es2020/json-crdt/nodes/nodes.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrChunk=exports.StrNode=exports.BinChunk=exports.BinNode=exports.ArrChunk=exports.ArrNode=exports.ObjNode=exports.VecNode=exports.RootNode=exports.ValNode=exports.ConNode=void 0;var ConNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/const/ConNode.js");Object.defineProperty(exports,"ConNode",{enumerable:!0,get:function(){return ConNode_1.ConNode}});var ValNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/val/ValNode.js");Object.defineProperty(exports,"ValNode",{enumerable:!0,get:function(){return ValNode_1.ValNode}});var RootNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/root/RootNode.js");Object.defineProperty(exports,"RootNode",{enumerable:!0,get:function(){return RootNode_1.RootNode}});var VecNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/vec/VecNode.js");Object.defineProperty(exports,"VecNode",{enumerable:!0,get:function(){return VecNode_1.VecNode}});var ObjNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/obj/ObjNode.js");Object.defineProperty(exports,"ObjNode",{enumerable:!0,get:function(){return ObjNode_1.ObjNode}});var ArrNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/arr/ArrNode.js");Object.defineProperty(exports,"ArrNode",{enumerable:!0,get:function(){return ArrNode_1.ArrNode}}),Object.defineProperty(exports,"ArrChunk",{enumerable:!0,get:function(){return ArrNode_1.ArrChunk}});var BinNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/bin/BinNode.js");Object.defineProperty(exports,"BinNode",{enumerable:!0,get:function(){return BinNode_1.BinNode}}),Object.defineProperty(exports,"BinChunk",{enumerable:!0,get:function(){return BinNode_1.BinChunk}});var StrNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/str/StrNode.js");Object.defineProperty(exports,"StrNode",{enumerable:!0,get:function(){return StrNode_1.StrNode}}),Object.defineProperty(exports,"StrChunk",{enumerable:!0,get:function(){return StrNode_1.StrChunk}})},"./node_modules/json-joy/es2020/json-crdt/nodes/obj/ObjNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ObjNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js");exports.ObjNode=class ObjNode{constructor(doc,id){this.doc=doc,this.id=id,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(key){const id=this.keys.get(key);if(id)return this.doc.index.get(id)}put(key,id){const currentId=this.keys.get(key);if(!(currentId&&(0,clock_1.compare)(currentId,id)>=0))return this.keys.set(key,id),currentId}nodes(callback){const index=this.doc.index;this.keys.forEach(((id,key)=>callback(index.get(id),key)))}children(callback){const index=this.doc.index;this.keys.forEach(((id,key)=>callback(index.get(id))))}child(){}container(){return this}view(){const doc=this.doc,tick=doc.clock.time+doc.tick,_view=this._view;if(this._tick===tick)return _view;const view={},index=doc.index;let useCache=!0;return this.keys.forEach(((id,key)=>{const valueNode=index.get(id);if(!valueNode)return void(useCache=!1);const value=valueNode.view();void 0!==value?(_view[key]!==value&&(useCache=!1),view[key]=value):void 0!==_view[key]&&(useCache=!1)})),useCache?_view:(this._tick=tick,this._view=view)}name(){return"obj"}toString(tab=""){return this.name()+" "+(0,clock_1.toDisplayString)(this.id)+(0,printTree_1.printTree)(tab,[...this.keys.entries()].filter((([,id])=>!!this.doc.index.get(id))).map((([key,id])=>tab=>JSON.stringify(key)+(0,printTree_1.printTree)(tab+" ",[tab=>this.doc.index.get(id).toString(tab)]))))}}},"./node_modules/json-joy/es2020/json-crdt/nodes/rga/AbstractRga.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractRga=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),isUint8Array_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/isUint8Array.js"),util_1=__webpack_require__("./node_modules/json-joy/es2020/util/trees/splay/util.js"),util2_1=__webpack_require__("./node_modules/json-joy/es2020/util/trees/splay/util2.js"),util2_2=__webpack_require__("./node_modules/json-joy/es2020/util/trees/util2.js"),constants_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/constants.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js"),printBinary_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printBinary.js"),printOctets_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/printOctets.js"),compareById=(c1,c2)=>{const ts1=c1.id,ts2=c2.id;return ts1.sid-ts2.sid||ts1.time-ts2.time},updateLenOne=chunk=>{const l=chunk.l,r=chunk.r;chunk.len=(chunk.del?0:chunk.span)+(l?l.len:0)+(r?r.len:0)},updateLenOneLive=chunk=>{const l=chunk.l,r=chunk.r;chunk.len=chunk.span+(l?l.len:0)+(r?r.len:0)},dLen=(chunk,delta)=>{for(;chunk;)chunk.len+=delta,chunk=chunk.p},next=curr=>{const r=curr.r;if(r){let tmp;for(curr=r;tmp=curr.l;)curr=tmp;return curr}let p=curr.p;for(;p&&p.r===curr;)curr=p,p=p.p;return p};exports.AbstractRga=class AbstractRga{constructor(id){this.id=id,this.root=void 0,this.ids=void 0,this.count=0}ins(after,id,content){const rootId=this.id,afterTime=after.time,afterSid=after.sid;if(rootId.time===afterTime&&rootId.sid===afterSid)return void this.insAfterRoot(after,id,content);let curr=this.ids,chunk=curr;for(;curr;){const currId=curr.id,currIdSid=currId.sid;if(currIdSid>afterSid)curr=curr.l2;else if(currIdSid<afterSid)chunk=curr,curr=curr.r2;else{const currIdTime=currId.time;if(currIdTime>afterTime)curr=curr.l2;else{if(!(currIdTime<afterTime)){chunk=curr;break}chunk=curr,curr=curr.r2}}}if(!chunk)return;const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span;if(atIdSid!==afterSid)return;if(afterTime-atIdTime>=atSpan)return;const offsetInInsertAtChunk=afterTime-atIdTime;this.insAfterChunk(after,chunk,offsetInInsertAtChunk,id,content)}insAt(position,id,content){if(!position){const rootId=this.id;return this.insAfterRoot(rootId,id,content),rootId}const found=this.findChunk(position-1);if(!found)return;const[at,offset]=found,atId=at.id,after=0===offset?atId:new clock_1.Timestamp(atId.sid,atId.time+offset);return this.insAfterChunk(after,at,offset,id,content),after}insAfterRoot(after,id,content){const chunk=this.createChunk(id,content),first=this.first();if(first)if((0,clock_1.compare)(first.id,id)<0)this.insertBefore(chunk,first);else{if((0,clock_1.containsId)(first.id,first.span,id))return;this.insertAfterRef(chunk,after,first)}else this.setRoot(chunk)}insAfterChunk(after,chunk,chunkOffset,id,content){const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span,newChunk=this.createChunk(id,content);if(chunkOffset+1<atSpan){const idSid=id.sid,idTime=id.time;if(atIdSid===idSid&&atIdTime<=idTime&&atIdTime+atSpan-1>=idTime)return;if(idTime>after.time+1||idSid>after.sid)return this.insertInside(newChunk,chunk,chunkOffset+1),void this.splay(newChunk)}this.insertAfterRef(newChunk,after,chunk),this.splay(newChunk)}delete(spans){const length=spans.length;for(let i=0;i<length;i++)this.deleteSpan(spans[i]);this.onChange()}deleteSpan(span){const len=span.span,t1=span.time,t2=t1+len-1,start=this.findById(span);if(!start)return;let chunk=start,last=chunk;for(;chunk;){last=chunk;const id=chunk.id,chunkSpan=chunk.span,c1=id.time,c2=c1+chunkSpan-1;if(chunk.del){if(c2>=t2)break;chunk=chunk.s;continue}const deleteStartsInTheMiddle=t1<=c2;if(t1<=c1){if(!(t2>=c2)){const range=t2-c1+1,newChunk=this.split(chunk,range);chunk.delete(),updateLenOne(newChunk),dLen(chunk,-chunk.span);break}if(chunk.delete(),dLen(chunk,-chunk.span),t2<=c2)break}else if(deleteStartsInTheMiddle){if(!(t2>=c2)){const right=this.split(chunk,t2-c1+1),mid=this.split(chunk,t1-c1);mid.delete(),updateLenOne(right),updateLenOne(mid),dLen(chunk,-mid.span);break}{const offset=t1-c1,newChunk=this.split(chunk,offset);if(newChunk.delete(),newChunk.len=newChunk.r?newChunk.r.len:0,dLen(chunk,-newChunk.span),t2<=c2)break}}chunk=chunk.s}last&&this.mergeTombstones2(start,last)}find(position){let curr=this.root;for(;curr;){const l=curr.l,leftLength=l?l.len:0;let span;if(position<leftLength)curr=l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+(span=curr.span)){const ticks=position-leftLength,id=curr.id;return ticks?new clock_1.Timestamp(id.sid,id.time+ticks):id}position-=leftLength+span,curr=curr.r}}}findChunk(position){let curr=this.root;for(;curr;){const l=curr.l,leftLength=l?l.len:0;let span;if(position<leftLength)curr=l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+(span=curr.span))return[curr,position-leftLength];position-=leftLength+span,curr=curr.r}}}findInterval(position,length){const ranges=[];if(!length)return ranges;let curr=this.root,offset=0;for(;curr;){const leftLength=curr.l?curr.l.len:0;if(position<leftLength)curr=curr.l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+curr.span){offset=position-leftLength;break}position-=leftLength+curr.span,curr=curr.r}}if(!curr)return ranges;if(curr.span>=length+offset){const id=curr.id;return ranges.push((0,clock_1.tss)(id.sid,id.time+offset,length)),ranges}const len=curr.span-offset,id=curr.id;if(ranges.push((0,clock_1.tss)(id.sid,id.time+offset,len)),length-=len,curr=next(curr),!curr)return ranges;do{if(curr.del)continue;const id=curr.id,span=curr.span;if(length<=span)return ranges.push((0,clock_1.tss)(id.sid,id.time,length)),ranges;ranges.push((0,clock_1.tss)(id.sid,id.time,span)),length-=span}while((curr=next(curr))&&length>0);return ranges}findInterval2(from,to){const ranges=[];return this.range0(void 0,from,to,((chunk,off,len)=>{const id=chunk.id;ranges.push((0,clock_1.tss)(id.sid,id.time+off,len))})),ranges}range0(startChunk,from,to,callback){let chunk=startChunk||this.findById(from);if(startChunk)for(;chunk&&!(0,clock_1.containsId)(chunk.id,chunk.span,from);)chunk=next(chunk);if(chunk){if(chunk.del){if((0,clock_1.containsId)(chunk.id,chunk.span,to))return}else{const off=from.time-chunk.id.time;if((0,clock_1.containsId)(chunk.id,chunk.span,to)){return callback(chunk,off,to.time-from.time+1),chunk}callback(chunk,off,chunk.span-off)}for(chunk=next(chunk);chunk;){if((0,clock_1.containsId)(chunk.id,chunk.span,to))return chunk.del||callback(chunk,0,to.time-chunk.id.time+1),chunk;chunk.del||callback(chunk,0,chunk.span),chunk=next(chunk)}return chunk}}first(){let curr=this.root;for(;curr;){const l=curr.l;if(!l)return curr;curr=l}return curr}last(){let curr=this.root;for(;curr;){const r=curr.r;if(!r)return curr;curr=r}return curr}lastId(){const chunk=this.last();if(!chunk)return;const id=chunk.id,span=chunk.span;return 1===span?id:new clock_1.Timestamp(id.sid,id.time+span-1)}next(curr){return next(curr)}length(){const root=this.root;return root?root.len:0}size(){return this.count}pos(chunk){const p=chunk.p,l=chunk.l;if(!p)return l?l.len:0;const parentPos=this.pos(p);if(p.r===chunk)return parentPos+(p.del?0:p.span)+(l?l.len:0);const r=chunk.r;return parentPos-(chunk.del?0:chunk.span)-(r?r.len:0)}setRoot(chunk){this.root=chunk,this.insertId(chunk),this.onChange()}insertBefore(chunk,before){const l=before.l;before.l=chunk,chunk.l=l,chunk.p=before;let lLen=0;l&&(l.p=chunk,lLen=l.len),chunk.len=chunk.span+lLen,dLen(before,chunk.span),this.insertId(chunk),this.onChange()}insertAfter(chunk,after){const r=after.r;after.r=chunk,chunk.r=r,chunk.p=after;let rLen=0;r&&(r.p=chunk,rLen=r.len),chunk.len=chunk.span+rLen,dLen(after,chunk.span),this.insertId(chunk),this.onChange()}insertAfterRef(chunk,ref,left){const id=chunk.id,sid=id.sid,time=id.time;let isSplit=!1;for(;;){const leftId=left.id,leftNextTick=leftId.time+left.span;left.s||(isSplit=leftId.sid===sid&&leftNextTick===time&&leftNextTick-1===ref.time,isSplit&&(left.s=chunk));const right=next(left);if(!right)break;const rightId=right.id,rightIdTime=rightId.time,rightIdSid=rightId.sid;if(rightIdTime<time)break;if(rightIdTime===time){if(rightIdSid===sid)return;if(rightIdSid<sid)break}left=right}isSplit&&!left.del?(this.mergeContent(left,chunk.data),left.s=void 0):this.insertAfter(chunk,left)}mergeContent(chunk,content){const span1=chunk.span;chunk.merge(content),dLen(chunk,chunk.span-span1),this.onChange()}insertInside(chunk,at,offset){const p=at.p,l=at.l,r=at.r,s=at.s,len=at.len,at2=at.split(offset);if(at.s=at2,at2.s=s,at.l=at.r=at2.l=at2.r=void 0,at2.l=void 0,chunk.p=p,l){chunk.l=l,l.p=chunk;const a=l.r;l.r=at,at.p=l,at.l=a,a&&(a.p=at)}else chunk.l=at,at.p=chunk;if(r){chunk.r=r,r.p=chunk;const b=r.l;r.l=at2,at2.p=r,at2.r=b,b&&(b.p=at2)}else chunk.r=at2,at2.p=chunk;p?p.l===at?p.l=chunk:p.r=chunk:this.root=chunk,updateLenOne(at),updateLenOne(at2),l&&(l.len=(l.l?l.l.len:0)+at.len+(l.del?0:l.span)),r&&(r.len=(r.r?r.r.len:0)+at2.len+(r.del?0:r.span)),chunk.len=len+chunk.span;const span=chunk.span;let curr=chunk.p;for(;curr;)curr.len+=span,curr=curr.p;this.insertId(at2),this.insertIdFast(chunk),this.onChange()}split(chunk,ticks){const s=chunk.s,newChunk=chunk.split(ticks),r=chunk.r;return chunk.s=newChunk,newChunk.r=r,newChunk.s=s,chunk.r=newChunk,newChunk.p=chunk,this.insertId(newChunk),r&&(r.p=newChunk),newChunk}mergeTombstones(ch1,ch2){if(!ch1.del||!ch2.del)return!1;const id1=ch1.id,id2=ch2.id;return id1.sid===id2.sid&&(id1.time+ch1.span===id2.time&&(ch1.s=ch2.s,ch1.span+=ch2.span,this.deleteChunk(ch2),!0))}mergeTombstones2(start,end){let curr=start;for(;curr;){const nextCurr=next(curr);if(!nextCurr)break;if(!this.mergeTombstones(curr,nextCurr)){if(nextCurr===end){if(nextCurr){const n=next(nextCurr);n&&this.mergeTombstones(nextCurr,n)}break}curr=curr.s}}const left=(curr=>{const l=curr.l;if(l){let tmp;for(curr=l;tmp=curr.r;)curr=tmp;return curr}let p=curr.p;for(;p&&p.l===curr;)curr=p,p=p.p;return p})(start);left&&this.mergeTombstones(left,start)}removeTombstones(){let curr=this.first();const list=[];for(;curr;)curr.del&&list.push(curr),curr=next(curr);for(let i=0;i<list.length;i++)this.deleteChunk(list[i])}deleteChunk(chunk){this.deleteId(chunk);const p=chunk.p,l=chunk.l,r=chunk.r;if(chunk.id=constants_1.ORIGIN,l||r)if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r;)mostRightChildFromLeft=mostRightChildFromLeft.r;mostRightChildFromLeft.r=r,r.p=mostRightChildFromLeft;const rLen=r.len;let curr;for(curr=mostRightChildFromLeft,p?(p.l===chunk?p.l=l:p.r=l,l.p=p):(this.root=l,l.p=void 0);curr&&curr!==p;)curr.len+=rLen,curr=curr.p}else{const child=l||r;child.p=p,p?p.l===chunk?p.l=child:p.r=child:this.root=child}else p?p.l===chunk?p.l=void 0:p.r=void 0:this.root=void 0}insertId(chunk){this.ids=(0,util2_2.insert2)(this.ids,chunk,compareById),this.count++,this.ids=(0,util2_1.splay2)(this.ids,chunk)}insertIdFast(chunk){this.ids=(0,util2_2.insert2)(this.ids,chunk,compareById),this.count++}deleteId(chunk){this.ids=(0,util2_2.remove2)(this.ids,chunk),this.count--}findById(after){const afterSid=after.sid,afterTime=after.time;let curr=this.ids,chunk=curr;for(;curr;){const currId=curr.id,currIdSid=currId.sid;if(currIdSid>afterSid)curr=curr.l2;else if(currIdSid<afterSid)chunk=curr,curr=curr.r2;else{const currIdTime=currId.time;if(currIdTime>afterTime)curr=curr.l2;else{if(!(currIdTime<afterTime)){chunk=curr;break}chunk=curr,curr=curr.r2}}}if(!chunk)return;const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span;if(atIdSid!==afterSid)return;if(afterTime<atIdTime)return;return afterTime-atIdTime>=atSpan?void 0:chunk}splay(chunk){const p=chunk.p;if(!p)return;const pp=p.p,l2=p.l===chunk;if(!pp)return l2?(0,util_1.rSplay)(chunk,p):(0,util_1.lSplay)(chunk,p),this.root=chunk,updateLenOne(p),void updateLenOneLive(chunk);const l1=pp.l===p;this.root=l1?l2?(0,util_1.llSplay)(this.root,chunk,p,pp):(0,util_1.lrSplay)(this.root,chunk,p,pp):l2?(0,util_1.rlSplay)(this.root,chunk,p,pp):(0,util_1.rrSplay)(this.root,chunk,p,pp),updateLenOne(pp),updateLenOne(p),updateLenOneLive(chunk),this.splay(chunk)}iterator(){let curr=this.first();return()=>{const res=curr;return curr&&(curr=next(curr)),res}}ingest(size,next){if(size<1)return;const splitLeftChunks=new Map;this.root=this._ingest(size,(()=>{const chunk=next(),id=chunk.id,key=id.sid+"."+id.time,split=splitLeftChunks.get(key);split&&(split.s=chunk,splitLeftChunks.delete(key));const nextStampAfterSpan=(0,clock_1.tick)(id,chunk.span);return splitLeftChunks.set(nextStampAfterSpan.sid+"."+nextStampAfterSpan.time,chunk),chunk}))}_ingest(size,next){const leftSize=size>>1,rightSize=size-leftSize-1,c1=leftSize>0?this._ingest(leftSize,next):void 0,c2=next();c1&&(c2.l=c1,c1.p=c2);const c3=rightSize>0?this._ingest(rightSize,next):void 0;return c3&&(c2.r=c3,c3.p=c2),updateLenOne(c2),this.insertId(c2),c2}toStringName(){return this.constructor.name}toString(tab=""){const view=this.view();let value="";(0,isUint8Array_1.isUint8Array)(view)?value+=` { ${(0,printOctets_1.printOctets)(view)||"∅"} }`:"string"==typeof view&&(value+=`{ ${view.length>32?JSON.stringify(view.substring(0,32))+" …":JSON.stringify(view)} }`);return`${this.toStringName()} ${(0,clock_1.toDisplayString)(this.id)} ${value}`+(0,printTree_1.printTree)(tab,[tab=>this.root?this.printChunk(tab,this.root):"∅"])}printChunk(tab,chunk){return this.formatChunk(chunk)+(0,printBinary_1.printBinary)(tab,[chunk.l?tab=>this.printChunk(tab,chunk.l):null,chunk.r?tab=>this.printChunk(tab,chunk.r):null])}formatChunk(chunk){const id=(0,clock_1.toDisplayString)(chunk.id);let str=`${chunk.constructor.name} ${id}!${chunk.span} len:${chunk.len}`;if(chunk.del)str+=` [${chunk.span}]`;else if((0,isUint8Array_1.isUint8Array)(chunk.data))str+=` { ${(0,printOctets_1.printOctets)(chunk.data)||"∅"} }`;else if("string"==typeof chunk.data){str+=` { ${chunk.data.length>32?JSON.stringify(chunk.data.substring(0,32))+" …":JSON.stringify(chunk.data)} }`}return str}}},"./node_modules/json-joy/es2020/json-crdt/nodes/root/RootNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RootNode=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/constants.js"),ValNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/val/ValNode.js");class RootNode extends ValNode_1.ValNode{constructor(doc,val){super(doc,constants_1.ORIGIN,val)}name(){return"root"}}exports.RootNode=RootNode},"./node_modules/json-joy/es2020/json-crdt/nodes/str/StrNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrNode=exports.StrChunk=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),AbstractRga_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/rga/AbstractRga.js"),util_1=__webpack_require__("./node_modules/json-joy/es2020/util/trees/util.js");class StrChunk{constructor(id,span,str){this.id=id,this.span=span,this.len=str?span:0,this.del=!str,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=str}merge(str){this.data+=str,this.span=this.data.length}split(ticks){if(!this.del){const chunk=new StrChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,this.data.slice(ticks));return this.data=this.data.slice(0,ticks),this.span=ticks,chunk}const chunk=new StrChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,"");return this.span=ticks,chunk}delete(){this.del=!0,this.data=""}clone(){return new StrChunk(this.id,this.span,this.data)}}exports.StrChunk=StrChunk;class StrNode extends AbstractRga_1.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let str="";for(let chunk=this.first();chunk;chunk=(0,util_1.next)(chunk))str+=chunk.data;return this._view=str}name(){return"str"}createChunk(id,str){return new StrChunk(id,str?str.length:0,str||"")}onChange(){this._view=""}toStringName(){return this.name()}}exports.StrNode=StrNode},"./node_modules/json-joy/es2020/json-crdt/nodes/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/es2020/json-crdt/nodes/val/ValNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js"),Model_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/model/Model.js");exports.ValNode=class ValNode{constructor(doc,id,val){this.doc=doc,this.id=id,this.val=val,this.api=void 0}set(val){if((0,clock_1.compare)(val,this.val)<=0&&0!==this.val.sid)return;if((0,clock_1.compare)(val,this.id)<=0)return;const oldVal=this.val;return this.val=val,oldVal}node(){return 0===this.val.sid?Model_1.UNDEFINED:this.child()}view(){return this.node()?.view()}children(callback){callback(this.node())}child(){return this.doc.index.get(this.val)}container(){const child=this.node();return child?child.container():void 0}name(){return"val"}toString(tab=""){const node=this.node();return this.name()+" "+(0,clock_1.toDisplayString)(this.id)+(0,printTree_1.printTree)(tab,[tab=>node?node.toString(tab):(0,clock_1.toDisplayString)(this.val)])}}},"./node_modules/json-joy/es2020/json-crdt/nodes/vec/VecNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VecNode=void 0;const ConNode_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/nodes/const/ConNode.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js"),clock_1=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/clock/index.js");exports.VecNode=class VecNode{constructor(doc,id){this.doc=doc,this.id=id,this.elements=[],this._view=[],this.api=void 0}val(index){return this.elements[index]}get(index){const id=this.elements[index];if(id)return this.doc.index.get(id)}put(index,id){if(index>255)throw new Error("OUT_OF_BOUNDS");const currentId=this.val(index);if(!(currentId&&(0,clock_1.compare)(currentId,id)>=0)){if(index>this.elements.length)for(let i=this.elements.length;i<index;i++)this.elements.push(void 0);return index<this.elements.length?this.elements[index]=id:this.elements.push(id),currentId}}ext(){if(this.__extNode)return this.__extNode;const extensionId=this.getExtId();if(!(extensionId>=0))return;const extension=this.doc.ext.get(extensionId);return extension?(this.__extNode=new extension.Node(this.get(1)),this.__extNode):void 0}isExt(){return!!this.ext()}getExtId(){if(2!==this.elements.length)return-1;const type=this.get(0);if(!(type instanceof ConNode_1.ConNode))return-1;const buf=type.val,id=this.id;return buf instanceof Uint8Array&&3===buf.length&&buf[1]===id.sid%256&&buf[2]===id.time%256?buf[0]:-1}child(){return this.ext()}container(){return this}children(callback){if(this.isExt())return;const elements=this.elements,length=elements.length,index=this.doc.index;for(let i=0;i<length;i++){const id=elements[i];if(!id)continue;const node=index.get(id);node&&callback(node)}}view(){const extNode=this.ext();if(extNode)return extNode.view();let useCache=!0;const _view=this._view,arr=[],index=this.doc.index,elements=this.elements,length=elements.length;for(let i=0;i<length;i++){const id=elements[i],node=id?index.get(id):void 0,value=node?node.view():void 0;_view[i]!==value&&(useCache=!1),arr.push(value)}return useCache?_view:this._view=arr}name(){return"vec"}toString(tab=""){const extNode=this.ext(),header=this.name()+" "+(0,clock_1.toDisplayString)(this.id)+(extNode?` { extension = ${this.getExtId()} }`:"");if(extNode)return this.child().toString(tab);const index=this.doc.index;return header+(0,printTree_1.printTree)(tab,[...this.elements.map(((id,i)=>tab=>`${i}: ${id&&index.get(id)?index.get(id).toString(tab+"  "+" ".repeat((""+i).length)):"nil"}`)),...extNode?[tab=>`${this.child().toString(tab)}`]:[]])}}},"./node_modules/json-joy/es2020/json-pack/JsonPackExtension.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsonPackExtension=void 0;exports.JsonPackExtension=class JsonPackExtension{constructor(tag,val){this.tag=tag,this.val=val}}},"./node_modules/json-joy/es2020/json-pack/JsonPackValue.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsonPackValue=void 0;exports.JsonPackValue=class JsonPackValue{constructor(val){this.val=val}}},"./node_modules/json-joy/es2020/json-pack/cbor/CborDecoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborDecoder=void 0;const CborDecoderBase_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborDecoderBase.js"),JsonPackValue_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/JsonPackValue.js");class CborDecoder extends CborDecoderBase_1.CborDecoderBase{readAsMap(){const octet=this.reader.u8(),minor=31&octet;if(5===octet>>5)return this.readMap(minor);throw 0}readMap(minor){const length=this.readMinorLen(minor);return length>=0?this.readMapRaw(length):this.readMapIndef()}readMapRaw(length){const map=new Map;for(let i=0;i<length;i++){const key=this.val(),value=this.val();map.set(key,value)}return map}readMapIndef(){const map=new Map;for(;255!==this.reader.peak();){const key=this.val();if(255===this.reader.peak())throw 7;const value=this.val();map.set(key,value)}return this.reader.x++,map}skipN(n){for(let i=0;i<n;i++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(octet){const minor=31&octet;switch(octet>>5){case 0:case 1:this.skipUNint(minor);break;case 2:this.skipBin(minor);break;case 3:this.skipStr(minor);break;case 4:this.skipArr(minor);break;case 5:this.skipObj(minor);break;case 7:this.skipTkn(minor);break;case 6:this.skipTag(minor)}}skipMinorLen(minor){if(minor<=23)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(minor){if(!(minor<=23))switch(minor){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(minor){const length=this.skipMinorLen(minor);if(length>=0)this.reader.skip(length);else{for(;255!==this.reader.peak();)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const octet=this.reader.u8(),minor=31&octet;if(2!==octet>>5)throw 2;if(minor>27)throw 3;this.skipBin(minor)}skipStr(minor){const length=this.skipMinorLen(minor);if(length>=0)this.reader.skip(length);else{for(;255!==this.reader.peak();)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 4;if(minor>27)throw 5;this.skipStr(minor)}skipArr(minor){const length=this.skipMinorLen(minor);if(length>=0)this.skipN(length);else{for(;255!==this.reader.peak();)this.skipAny();this.reader.x++}}skipObj(minor){const length=this.readMinorLen(minor);if(length>=0)return this.skipN(2*length);for(;255!==this.reader.peak();){if(this.skipAny(),255===this.reader.peak())throw 7;this.skipAny()}this.reader.x++}skipTag(minor){if(this.skipMinorLen(minor)<0)throw 1;this.skipAny()}skipTkn(minor){switch(minor){case 24:return void this.reader.skip(1);case 25:return void this.reader.skip(2);case 26:return void this.reader.skip(4);case 27:return void this.reader.skip(8)}if(!(minor<=23))throw 1}validate(value,offset=0,size=value.length){this.reader.reset(value),this.reader.x=offset;const start=offset;this.skipAny();if(this.reader.x-start!==size)throw 8}decodeLevel(value){return this.reader.reset(value),this.readLevel()}readLevel(){const octet=this.reader.u8(),minor=31&octet;switch(octet>>5){case 4:return this.readArrLevel(minor);case 5:return this.readObjLevel(minor);default:return super.readAnyRaw(octet)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.val()}}readAsValue(){const reader=this.reader,start=reader.x;this.skipAny();const end=reader.x;return new JsonPackValue_1.JsonPackValue(reader.uint8.subarray(start,end))}readObjLevel(minor){const length=this.readMinorLen(minor);return length>=0?this.readObjRawLevel(length):this.readObjIndefLevel()}readObjRawLevel(length){const obj={};for(let i=0;i<length;i++){const key=this.key(),value=this.readPrimitiveOrVal();obj[key]=value}return obj}readObjIndefLevel(){const obj={};for(;255!==this.reader.peak();){const key=this.key();if(255===this.reader.peak())throw 7;const value=this.readPrimitiveOrVal();obj[key]=value}return this.reader.x++,obj}readArrLevel(minor){const length=this.readMinorLen(minor);return length>=0?this.readArrRawLevel(length):this.readArrIndefLevel()}readArrRawLevel(length){const arr=[];for(let i=0;i<length;i++)arr.push(this.readPrimitiveOrVal());return arr}readArrIndefLevel(){const arr=[];for(;255!==this.reader.peak();)arr.push(this.readPrimitiveOrVal());return this.reader.x++,arr}readHdr(expectedMajor){const octet=this.reader.u8();if(octet>>5!==expectedMajor)throw 0;const minor=31&octet;if(minor<24)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(key){const size=this.readObjHdr();for(let i=0;i<size;i++){if(this.key()===key)return this;this.skipAny()}throw 9}findIndex(index){if(index>=this.readArrHdr())throw 10;for(let i=0;i<index;i++)this.skipAny();return this}find(path){for(let i=0;i<path.length;i++){const segment=path[i];"string"==typeof segment?this.findKey(segment):this.findIndex(segment)}return this}}exports.CborDecoder=CborDecoder},"./node_modules/json-joy/es2020/json-pack/cbor/CborDecoderBase.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborDecoderBase=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),f16_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/f16.js"),JsonPackExtension_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/JsonPackExtension.js"),JsonPackValue_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/JsonPackValue.js"),Reader_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/Reader.js"),sharedCachedUtf8Decoder_1=tslib_1.__importDefault(__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/sharedCachedUtf8Decoder.js"));exports.CborDecoderBase=class CborDecoderBase{constructor(reader=new Reader_1.Reader,keyDecoder=sharedCachedUtf8Decoder_1.default){this.reader=reader,this.keyDecoder=keyDecoder}read(uint8){return this.reader.reset(uint8),this.val()}decode(uint8){return this.reader.reset(uint8),this.val()}val(){const octet=this.reader.u8(),major=octet>>5,minor=31&octet;return major<4?major<2?0===major?this.readUint(minor):this.readNint(minor):2===major?this.readBin(minor):this.readStr(minor):major<6?4===major?this.readArr(minor):this.readObj(minor):6===major?this.readTag(minor):this.readTkn(minor)}readAnyRaw(octet){const major=octet>>5,minor=31&octet;return major<4?major<2?0===major?this.readUint(minor):this.readNint(minor):2===major?this.readBin(minor):this.readStr(minor):major<6?4===major?this.readArr(minor):this.readObj(minor):6===major?this.readTag(minor):this.readTkn(minor)}readMinorLen(minor){if(minor<24)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(minor){if(minor<25)return 24===minor?this.reader.u8():minor;if(minor<27)return 25===minor?this.reader.u16():this.reader.u32();{const num=this.reader.u64();return num>9007199254740991?num:Number(num)}}readNint(minor){if(minor<25)return 24===minor?-this.reader.u8()-1:-minor-1;if(minor<27)return 25===minor?-this.reader.u16()-1:-this.reader.u32()-1;{const num=this.reader.u64();return num>9007199254740990?-num-BigInt(1):-Number(num)-1}}readBin(minor){const reader=this.reader;if(minor<=23)return reader.buf(minor);switch(minor){case 24:return reader.buf(reader.u8());case 25:return reader.buf(reader.u16());case 26:return reader.buf(reader.u32());case 27:return reader.buf(Number(reader.u64()));case 31:{let size=0;const list=[];for(;255!==this.reader.peak();){const uint8=this.readBinChunk();size+=uint8.length,list.push(uint8)}this.reader.x++;const res=new Uint8Array(size);let offset=0;const length=list.length;for(let i=0;i<length;i++){const arr=list[i];res.set(arr,offset),offset+=arr.length}return res}default:throw 1}}readBinChunk(){const octet=this.reader.u8(),minor=31&octet;if(2!==octet>>5)throw 2;if(minor>27)throw 3;return this.readBin(minor)}readAsStr(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 11;return this.readStr(minor)}readStr(minor){const reader=this.reader;if(minor<=23)return reader.utf8(minor);switch(minor){case 24:return reader.utf8(reader.u8());case 25:return reader.utf8(reader.u16());case 26:return reader.utf8(reader.u32());case 27:return reader.utf8(Number(reader.u64()));case 31:{let str="";for(;255!==reader.peak();)str+=this.readStrChunk();return this.reader.x++,str}default:throw 1}}readStrLen(minor){if(minor<=23)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 4;if(minor>27)throw 5;return this.readStr(minor)}readArr(minor){const length=this.readMinorLen(minor);return length>=0?this.readArrRaw(length):this.readArrIndef()}readArrRaw(length){const arr=[];for(let i=0;i<length;i++)arr.push(this.val());return arr}readArrIndef(){const arr=[];for(;255!==this.reader.peak();)arr.push(this.val());return this.reader.x++,arr}readObj(minor){if(minor<28){let length=minor;switch(minor){case 24:length=this.reader.u8();break;case 25:length=this.reader.u16();break;case 26:length=this.reader.u32();break;case 27:length=Number(this.reader.u64())}const obj={};for(let i=0;i<length;i++){const key=this.key();if("__proto__"===key)throw 6;const value=this.val();obj[key]=value}return obj}if(31===minor)return this.readObjIndef();throw 1}readObjRaw(length){const obj={};for(let i=0;i<length;i++){const key=this.key(),value=this.val();obj[key]=value}return obj}readObjIndef(){const obj={};for(;255!==this.reader.peak();){const key=this.key();if(255===this.reader.peak())throw 7;const value=this.val();obj[key]=value}return this.reader.x++,obj}key(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)return String(this.readAnyRaw(octet));const length=this.readStrLen(minor);if(length>31)return this.reader.utf8(length);const key=this.keyDecoder.decode(this.reader.uint8,this.reader.x,length);return this.reader.skip(length),key}readTag(minor){if(minor<=23)return this.readTagRaw(minor);switch(minor){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(tag){return new JsonPackExtension_1.JsonPackExtension(tag,this.val())}readTkn(minor){switch(minor){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new JsonPackValue_1.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(minor<=23)return new JsonPackValue_1.JsonPackValue(minor);throw 1}f16(){return(0,f16_1.decodeF16)(this.reader.u16())}}},"./node_modules/json-joy/es2020/json-pack/cbor/CborEncoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborEncoder=void 0;const isFloat32_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/isFloat32.js"),JsonPackExtension_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/JsonPackExtension.js"),CborEncoderFast_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/cbor/CborEncoderFast.js"),JsonPackValue_1=__webpack_require__("./node_modules/json-joy/es2020/json-pack/JsonPackValue.js");class CborEncoder extends CborEncoderFast_1.CborEncoderFast{writeUnknown(value){this.writeNull()}writeAny(value){switch(typeof value){case"number":return this.writeNumber(value);case"string":return this.writeStr(value);case"boolean":return this.writer.u8(+value+244);case"object":if(!value)return this.writer.u8(246);switch(value.constructor){case Object:return this.writeObj(value);case Array:return this.writeArr(value);case Uint8Array:return this.writeBin(value);case Map:return this.writeMap(value);case JsonPackExtension_1.JsonPackExtension:return this.writeTag(value.tag,value.val);case JsonPackValue_1.JsonPackValue:const buf=value.val;return this.writer.buf(buf,buf.length);default:return this.writeUnknown(value)}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(value);default:return this.writeUnknown(value)}}writeFloat(float){(0,isFloat32_1.isFloat32)(float)?this.writer.u8f32(250,float):this.writer.u8f64(251,float)}writeMap(map){this.writeMapHdr(map.size),map.forEach(((value,key)=>{this.writeAny(key),this.writeAny(value)}))}writeUndef(){this.writer.u8(247)}}exports.CborEncoder=CborEncoder},"./node_modules/json-joy/es2020/json-pack/cbor/CborEncoderFast.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborEncoderFast=void 0;const Writer_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/Writer.js"),isSafeInteger=Number.isSafeInteger;exports.CborEncoderFast=class CborEncoderFast{constructor(writer=new Writer_1.Writer){this.writer=writer}encode(value){return this.writeAny(value),this.writer.flush()}encodeToSlice(value){return this.writeAny(value),this.writer.flushSlice()}writeAny(value){switch(typeof value){case"number":return this.writeNumber(value);case"string":return this.writeStr(value);case"boolean":return this.writer.u8(+value+244);case"object":if(!value)return this.writer.u8(246);return value.constructor===Array?this.writeArr(value):this.writeObj(value)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(bool){bool?this.writer.u8(245):this.writer.u8(244)}writeNumber(num){isSafeInteger(num)?this.writeInteger(num):"bigint"==typeof num?this.writeBigInt(num):this.writeFloat(num)}writeBigInt(int){int>=0?this.writeBigUint(int):this.writeBigSint(int)}writeBigUint(uint){if(uint<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(uint));this.writer.u8u64(27,uint)}writeBigSint(int){if(int>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(int));const uint=-BigInt(1)-int;this.writer.u8u64(59,uint)}writeInteger(int){int>=0?this.writeUInteger(int):this.encodeNint(int)}writeUInteger(uint){const writer=this.writer;writer.ensureCapacity(9);const uint8=writer.uint8;let x=writer.x;uint<=23?uint8[x++]=0+uint:uint<=255?(uint8[x++]=24,uint8[x++]=uint):uint<=65535?(uint8[x++]=25,writer.view.setUint16(x,uint),x+=2):uint<=4294967295?(uint8[x++]=26,writer.view.setUint32(x,uint),x+=4):(uint8[x++]=27,writer.view.setBigUint64(x,BigInt(uint)),x+=8),writer.x=x}encodeNumber(num){this.writeNumber(num)}encodeInteger(int){this.writeInteger(int)}encodeUint(uint){this.writeUInteger(uint)}encodeNint(int){const uint=-1-int,writer=this.writer;writer.ensureCapacity(9);const uint8=writer.uint8;let x=writer.x;uint<24?uint8[x++]=32+uint:uint<=255?(uint8[x++]=56,uint8[x++]=uint):uint<=65535?(uint8[x++]=57,writer.view.setUint16(x,uint),x+=2):uint<=4294967295?(uint8[x++]=58,writer.view.setUint32(x,uint),x+=4):(uint8[x++]=59,writer.view.setBigUint64(x,BigInt(uint)),x+=8),writer.x=x}writeFloat(float){this.writer.u8f64(251,float)}writeBin(buf){const length=buf.length;this.writeBinHdr(length),this.writer.buf(buf,length)}writeBinHdr(length){const writer=this.writer;length<=23?writer.u8(64+length):length<=255?writer.u16(22528+length):length<=65535?writer.u8u16(89,length):length<=4294967295?writer.u8u32(90,length):writer.u8u64(91,length)}writeStr(str){const writer=this.writer,maxSize=4*str.length;writer.ensureCapacity(5+maxSize);const uint8=writer.uint8;let lengthOffset=writer.x;maxSize<=23?writer.x++:maxSize<=255?(uint8[writer.x++]=120,lengthOffset=writer.x,writer.x++):maxSize<=65535?(uint8[writer.x++]=121,lengthOffset=writer.x,writer.x+=2):(uint8[writer.x++]=122,lengthOffset=writer.x,writer.x+=4);const bytesWritten=writer.utf8(str);maxSize<=23?uint8[lengthOffset]=96+bytesWritten:maxSize<=255?uint8[lengthOffset]=bytesWritten:maxSize<=65535?writer.view.setUint16(lengthOffset,bytesWritten):writer.view.setUint32(lengthOffset,bytesWritten)}writeStrHdr(length){const writer=this.writer;length<=23?writer.u8(96+length):length<=255?writer.u16(30720+length):length<=65535?writer.u8u16(121,length):writer.u8u32(122,length)}writeAsciiStr(str){this.writeStrHdr(str.length),this.writer.ascii(str)}writeArr(arr){const length=arr.length;this.writeArrHdr(length);for(let i=0;i<length;i++)this.writeAny(arr[i])}writeArrHdr(length){const writer=this.writer;length<=23?writer.u8(128+length):length<=255?writer.u16(38912+length):length<=65535?writer.u8u16(153,length):length<=4294967295?writer.u8u32(154,length):writer.u8u64(155,length)}writeObj(obj){const keys=Object.keys(obj),length=keys.length;this.writeObjHdr(length);for(let i=0;i<length;i++){const key=keys[i];this.writeStr(key),this.writeAny(obj[key])}}writeObjHdr(length){const writer=this.writer;length<=23?writer.u8(160+length):length<=255?writer.u16(47104+length):length<=65535?writer.u8u16(185,length):length<=4294967295?writer.u8u32(186,length):writer.u8u64(187,length)}writeMapHdr(length){this.writeObjHdr(length)}writeStartMap(){this.writer.u8(191)}writeTag(tag,value){this.writeTagHdr(tag),this.writeAny(value)}writeTagHdr(tag){const writer=this.writer;tag<=23?writer.u8(192+tag):tag<=255?writer.u16(55296+tag):tag<=65535?writer.u8u16(217,tag):tag<=4294967295?writer.u8u32(218,tag):writer.u8u64(219,tag)}writeTkn(value){const writer=this.writer;value<=23?writer.u8(224+value):value<=255&&writer.u16(63488+value)}writeStartStr(){this.writer.u8(127)}writeStrChunk(str){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(buf){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(item){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(key,value){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}}},"./node_modules/json-joy/es2020/json-pointer/find.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObjectReference=exports.isArrayEnd=exports.isArrayReference=exports.find=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/json-joy/es2020/util/hasOwnProperty.js"),{isArray}=Array;exports.find=(val,path)=>{const pathLength=path.length;if(!pathLength)return{val};let obj,key;for(let i=0;i<pathLength;i++)if(obj=val,key=path[i],isArray(obj)){const length=obj.length;if("-"===key)key=length;else if("string"==typeof key){const key2=~~key;if(""+key2!==key)throw new Error("INVALID_INDEX");if(key=key2,key<0)throw new Error("INVALID_INDEX")}val=obj[key]}else{if("object"!=typeof obj||!obj)throw new Error("NOT_FOUND");val=(0,hasOwnProperty_1.hasOwnProperty)(obj,key)?obj[key]:void 0}return{val,obj,key}};exports.isArrayReference=ref=>isArray(ref.obj)&&"number"==typeof ref.key;exports.isArrayEnd=ref=>ref.obj.length===ref.key;exports.isObjectReference=ref=>"object"==typeof ref.obj&&"string"==typeof ref.key},"./node_modules/json-joy/es2020/json-pointer/findByPointer/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/findByPointer/v5.js"),exports)},"./node_modules/json-joy/es2020/json-pointer/findByPointer/v5.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findByPointer=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/json-joy/es2020/util/hasOwnProperty.js"),util_1=__webpack_require__("./node_modules/json-joy/es2020/json-pointer/util.js"),{isArray}=Array;exports.findByPointer=(pointer,val)=>{if(!pointer)return{val};let obj,key,indexOfSlash=0,indexAfterSlash=1;for(;indexOfSlash>-1;)if(indexOfSlash=pointer.indexOf("/",indexAfterSlash),key=indexOfSlash>-1?pointer.substring(indexAfterSlash,indexOfSlash):pointer.substring(indexAfterSlash),indexAfterSlash=indexOfSlash+1,obj=val,isArray(obj)){const length=obj.length;if("-"===key)key=length;else{const key2=~~key;if(""+key2!==key)throw new Error("INVALID_INDEX");if(key=key2,key<0)throw"INVALID_INDEX"}val=obj[key]}else{if("object"!=typeof obj||!obj)throw"NOT_FOUND";key=(0,util_1.unescapeComponent)(key),val=(0,hasOwnProperty_1.hasOwnProperty)(obj,key)?obj[key]:void 0}return{val,obj,key}}},"./node_modules/json-joy/es2020/json-pointer/get.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/json-joy/es2020/util/hasOwnProperty.js");exports.get=(val,path)=>{const pathLength=path.length;let key;if(!pathLength)return val;for(let i=0;i<pathLength;i++)if(key=path[i],val instanceof Array){val.length;if("-"===key)return;const key2=~~key;if(""+key2!==key)return;if(key=key2,key<0)return;val=val[key]}else{if("object"!=typeof val)return;if(!val||!(0,hasOwnProperty_1.hasOwnProperty)(val,key))return;val=val[key]}return val}},"./node_modules/json-joy/es2020/json-pointer/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/util.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/validate.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/get.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/find.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/es2020/json-pointer/findByPointer/index.js"),exports)},"./node_modules/json-joy/es2020/json-pointer/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/es2020/json-pointer/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isInteger=exports.isValidIndex=exports.parent=exports.isRoot=exports.isPathEqual=exports.isChild=exports.toPath=exports.formatJsonPointer=exports.parseJsonPointer=exports.escapeComponent=exports.unescapeComponent=void 0;const r1=/~1/g,r2=/~0/g,r3=/~/g,r4=/\//g;function unescapeComponent(component){return-1===component.indexOf("~")?component:component.replace(r1,"/").replace(r2,"~")}function escapeComponent(component){return-1===component.indexOf("/")&&-1===component.indexOf("~")?component:component.replace(r3,"~0").replace(r4,"~1")}function parseJsonPointer(pointer){return pointer?pointer.slice(1).split("/").map(unescapeComponent):[]}exports.unescapeComponent=unescapeComponent,exports.escapeComponent=escapeComponent,exports.parseJsonPointer=parseJsonPointer,exports.formatJsonPointer=function formatJsonPointer(path){return(0,exports.isRoot)(path)?"":"/"+path.map((component=>escapeComponent(String(component)))).join("/")};exports.toPath=pointer=>"string"==typeof pointer?parseJsonPointer(pointer):pointer,exports.isChild=function isChild(parent,child){if(parent.length>=child.length)return!1;for(let i=0;i<parent.length;i++)if(parent[i]!==child[i])return!1;return!0},exports.isPathEqual=function isPathEqual(p1,p2){if(p1.length!==p2.length)return!1;for(let i=0;i<p1.length;i++)if(p1[i]!==p2[i])return!1;return!0};exports.isRoot=path=>!path.length,exports.parent=function parent(path){if(path.length<1)throw new Error("NO_PARENT");return path.slice(0,path.length-1)},exports.isValidIndex=function isValidIndex(index){if("number"==typeof index)return!0;const n=parseInt(index,10);return String(n)===index&&n>=0};exports.isInteger=str=>{const len=str.length;let charCode,i=0;for(;i<len;){if(charCode=str.charCodeAt(i),!(charCode>=48&&charCode<=57))return!1;i++}return!0}},"./node_modules/json-joy/es2020/json-pointer/validate.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validatePath=exports.validateJsonPointer=void 0;exports.validateJsonPointer=pointer=>{if("string"==typeof pointer){if(pointer){if("/"!==pointer[0])throw new Error("POINTER_INVALID");if(pointer.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,exports.validatePath)(pointer)};const{isArray}=Array;exports.validatePath=path=>{if(!isArray(path))throw new Error("Invalid path.");if(path.length>256)throw new Error("Path too long.");for(const step of path)switch(typeof step){case"string":case"number":continue;default:throw new Error("Invalid path step.")}}},"./node_modules/json-joy/es2020/json-text/stringify.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stringify=void 0;exports.stringify=(value,spacing=" ")=>{switch(value){case null:return"!n";case void 0:return"!u";case!0:return"!t";case!1:return"!f"}if(Array.isArray(value))return`[${spacing}${value.map((v=>(0,exports.stringify)(v,spacing))).join(","+spacing)}${spacing}]`;if(value instanceof Uint8Array)return`${value}`;switch(typeof value){case"number":return`${value}`;case"string":return JSON.stringify(value);case"object":{const keys=Object.keys(value);return`{${spacing}${keys.map((k=>`${k}${spacing}=${spacing}${(0,exports.stringify)(value[k],spacing)}`)).join(","+spacing)}${spacing}}`}}return"?"}},"./node_modules/json-joy/es2020/util/buffers/Reader.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reader=void 0;const decodeUtf8_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/index.js");exports.Reader=class Reader{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(uint8){this.x=0,this.uint8=uint8,this.view=new DataView(uint8.buffer,uint8.byteOffset,uint8.length)}peak(){return this.view.getUint8(this.x)}skip(length){this.x+=length}buf(size){const end=this.x+size,bin=this.uint8.subarray(this.x,end);return this.x=end,bin}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let x=this.x;const num=(this.uint8[x++]<<8)+this.uint8[x++];return this.x=x,num}i16(){const num=this.view.getInt16(this.x);return this.x+=2,num}u32(){const num=this.view.getUint32(this.x);return this.x+=4,num}i32(){const num=this.view.getInt32(this.x);return this.x+=4,num}u64(){const num=this.view.getBigUint64(this.x);return this.x+=8,num}i64(){const num=this.view.getBigInt64(this.x);return this.x+=8,num}f32(){const pos=this.x;return this.x+=4,this.view.getFloat32(pos)}f64(){const pos=this.x;return this.x+=8,this.view.getFloat64(pos)}utf8(size){const start=this.x;return this.x+=size,(0,decodeUtf8_1.decodeUtf8)(this.uint8,start,size)}ascii(length){const uint8=this.uint8;let str="";const end=this.x+length;for(let i=this.x;i<end;i++)str+=String.fromCharCode(uint8[i]);return this.x=end,str}}},"./node_modules/json-joy/es2020/util/buffers/Slice.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slice=void 0;exports.Slice=class Slice{constructor(uint8,view,start,end){this.uint8=uint8,this.view=view,this.start=start,this.end=end}subarray(){return this.uint8.subarray(this.start,this.end)}}},"./node_modules/json-joy/es2020/util/buffers/Writer.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Writer=void 0;const Slice_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/Slice.js"),EMPTY_UINT8=new Uint8Array([]),EMPTY_VIEW=new DataView(EMPTY_UINT8.buffer),hasBuffer="function"==typeof Buffer,utf8Write=hasBuffer?Buffer.prototype.utf8Write:null,from=hasBuffer?Buffer.from:null,textEncoder="undefined"!=typeof TextEncoder?new TextEncoder:null;exports.Writer=class Writer{constructor(allocSize=65536){this.allocSize=allocSize,this.view=EMPTY_VIEW,this.x0=0,this.x=0,this.uint8=new Uint8Array(allocSize),this.size=allocSize,this.view=new DataView(this.uint8.buffer)}grow(size){const x0=this.x0,x=this.x,oldUint8=this.uint8,newUint8=new Uint8Array(size),view=new DataView(newUint8.buffer),activeSlice=oldUint8.subarray(x0,x);newUint8.set(activeSlice,0),this.x=x-x0,this.x0=0,this.uint8=newUint8,this.size=size,this.view=view}ensureCapacity(capacity){const byteLength=this.size,remaining=byteLength-this.x;if(remaining<capacity){const totalRequired=byteLength-this.x0+(capacity-remaining);this.grow(totalRequired<=this.allocSize?this.allocSize:2*totalRequired)}}move(capacity){this.ensureCapacity(capacity),this.x+=capacity}reset(){this.x0=this.x}newBuffer(size){const uint8=this.uint8=new Uint8Array(size);this.size=size,this.view=new DataView(uint8.buffer),this.x=this.x0=0}flush(){const result=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,result}flushSlice(){const slice=new Slice_1.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,slice}u8(char){this.ensureCapacity(1),this.uint8[this.x++]=char}u16(word){this.ensureCapacity(2),this.view.setUint16(this.x,word),this.x+=2}u32(dword){this.ensureCapacity(4),this.view.setUint32(this.x,dword),this.x+=4}i32(dword){this.ensureCapacity(4),this.view.setInt32(this.x,dword),this.x+=4}u64(qword){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(qword)),this.x+=8}f64(float){this.ensureCapacity(8),this.view.setFloat64(this.x,float),this.x+=8}u8u16(u8,u16){this.ensureCapacity(3);let x=this.x;this.uint8[x++]=u8,this.uint8[x++]=u16>>>8,this.uint8[x++]=255&u16,this.x=x}u8u32(u8,u32){this.ensureCapacity(5);let x=this.x;this.uint8[x++]=u8,this.view.setUint32(x,u32),this.x=x+4}u8u64(u8,u64){this.ensureCapacity(9);let x=this.x;this.uint8[x++]=u8,this.view.setBigUint64(x,BigInt(u64)),this.x=x+8}u8f32(u8,f32){this.ensureCapacity(5);let x=this.x;this.uint8[x++]=u8,this.view.setFloat32(x,f32),this.x=x+4}u8f64(u8,f64){this.ensureCapacity(9);let x=this.x;this.uint8[x++]=u8,this.view.setFloat64(x,f64),this.x=x+8}buf(buf,length){this.ensureCapacity(length);const x=this.x;this.uint8.set(buf,x),this.x=x+length}utf8(str){const maxLength=4*str.length;if(maxLength<168)return this.utf8Native(str);if(utf8Write){const writeLength=utf8Write.call(this.uint8,str,this.x,maxLength);return this.x+=writeLength,writeLength}if(from){const uint8=this.uint8,offset=uint8.byteOffset+this.x,writeLength=from(uint8.buffer).subarray(offset,offset+maxLength).write(str,0,maxLength,"utf8");return this.x+=writeLength,writeLength}if(maxLength>1024&&textEncoder){const writeLength=textEncoder.encodeInto(str,this.uint8.subarray(this.x,this.x+maxLength)).written;return this.x+=writeLength,writeLength}return this.utf8Native(str)}utf8Native(str){const length=str.length,uint8=this.uint8;let offset=this.x,pos=0;for(;pos<length;){let value=str.charCodeAt(pos++);if(4294967168&value){if(4294965248&value){if(value>=55296&&value<=56319&&pos<length){const extra=str.charCodeAt(pos);56320==(64512&extra)&&(pos++,value=((1023&value)<<10)+(1023&extra)+65536)}4294901760&value?(uint8[offset++]=value>>18&7|240,uint8[offset++]=value>>12&63|128,uint8[offset++]=value>>6&63|128):(uint8[offset++]=value>>12&15|224,uint8[offset++]=value>>6&63|128)}else uint8[offset++]=value>>6&31|192;uint8[offset++]=63&value|128}else uint8[offset++]=value}const writeLength=offset-this.x;return this.x=offset,writeLength}ascii(str){const length=str.length;this.ensureCapacity(length);const uint8=this.uint8;let x=this.x,pos=0;for(;pos<length;)uint8[x++]=str.charCodeAt(pos++);this.x=x}}},"./node_modules/json-joy/es2020/util/buffers/f16.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeF16=void 0;const pow=Math.pow;exports.decodeF16=binary=>{const exponent=(31744&binary)>>10,fraction=1023&binary;return(binary>>15?-1:1)*(exponent?31===exponent?fraction?NaN:1/0:pow(2,exponent-15)*(1+fraction/1024):fraction/1024*6103515625e-14)}},"./node_modules/json-joy/es2020/util/buffers/isFloat32.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFloat32=void 0;const view=new DataView(new ArrayBuffer(4));exports.isFloat32=n=>(view.setFloat32(0,n),n===view.getFloat32(0))},"./node_modules/json-joy/es2020/util/buffers/isUint8Array.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isUint8Array=void 0,exports.isUint8Array="function"==typeof Buffer?x=>x instanceof Uint8Array||Buffer.isBuffer(x):x=>x instanceof Uint8Array},"./node_modules/json-joy/es2020/util/buffers/printOctets.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printOctets=void 0;exports.printOctets=(octets,max=16)=>{let str="";if(!octets.length)return str;octets[0]<16&&(str+="0"),str+=octets[0].toString(16);for(let i=1;i<octets.length&&i<max;i++){const n=octets[i];str+=" ",n<16&&(str+="0"),str+=n.toString(16)}return octets.length>max&&(str+=`… (${octets.length-max} more)`),str}},"./node_modules/json-joy/es2020/util/buffers/utf8/CachedUtf8Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CachedUtf8Decoder=void 0;const v10_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importDefault(__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v10.js")),randomU32_1=__webpack_require__("./node_modules/hyperdyperid/lib/randomU32.js");class CacheItem{constructor(bytes,value){this.bytes=bytes,this.value=value}}exports.CachedUtf8Decoder=class CachedUtf8Decoder{constructor(){this.caches=[];for(let i=0;i<31;i++)this.caches.push([])}get(bytes,offset,size){const records=this.caches[size-1],len=records.length;FIND_CHUNK:for(let i=0;i<len;i++){const record=records[i],recordBytes=record.bytes;for(let j=0;j<size;j++)if(recordBytes[j]!==bytes[offset+j])continue FIND_CHUNK;return record.value}return null}store(bytes,value){const records=this.caches[bytes.length-1],record=new CacheItem(bytes,value);records.length>=16?records[(0,randomU32_1.randomU32)(0,15)]=record:records.push(record)}decode(bytes,offset,size){if(!size)return"";const cachedValue=this.get(bytes,offset,size);if(null!==cachedValue)return cachedValue;const value=(0,v10_1.default)(bytes,offset,size),copy=Uint8Array.prototype.slice.call(bytes,offset,offset+size);return this.store(copy,value),value}}},"./node_modules/json-joy/es2020/util/buffers/utf8/decodeAscii.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeAsciiMax15=exports.decodeAscii=void 0;const fromCharCode=String.fromCharCode;exports.decodeAscii=(src,position,length)=>{const bytes=[];for(let i=0;i<length;i++){const byte=src[position++];if(128&byte)return;bytes.push(byte)}return fromCharCode.apply(String,bytes)};exports.decodeAsciiMax15=(src,position,length)=>{if(length<4){if(length<2){if(0===length)return"";{const a=src[position++];return(128&a)>1?void(position-=1):fromCharCode(a)}}{const a=src[position++],b=src[position++];if((128&a)>0||(128&b)>0)return void(position-=2);if(length<3)return fromCharCode(a,b);const c=src[position++];return(128&c)>0?void(position-=3):fromCharCode(a,b,c)}}{const a=src[position++],b=src[position++],c=src[position++],d=src[position++];if((128&a)>0||(128&b)>0||(128&c)>0||(128&d)>0)return void(position-=4);if(length<6){if(4===length)return fromCharCode(a,b,c,d);{const e=src[position++];return(128&e)>0?void(position-=5):fromCharCode(a,b,c,d,e)}}if(length<8){const e=src[position++],f=src[position++];if((128&e)>0||(128&f)>0)return void(position-=6);if(length<7)return fromCharCode(a,b,c,d,e,f);const g=src[position++];return(128&g)>0?void(position-=7):fromCharCode(a,b,c,d,e,f,g)}{const e=src[position++],f=src[position++],g=src[position++],h=src[position++];if((128&e)>0||(128&f)>0||(128&g)>0||(128&h)>0)return void(position-=8);if(length<10){if(8===length)return fromCharCode(a,b,c,d,e,f,g,h);{const i=src[position++];return(128&i)>0?void(position-=9):fromCharCode(a,b,c,d,e,f,g,h,i)}}if(length<12){const i=src[position++],j=src[position++];if((128&i)>0||(128&j)>0)return void(position-=10);if(length<11)return fromCharCode(a,b,c,d,e,f,g,h,i,j);const k=src[position++];return(128&k)>0?void(position-=11):fromCharCode(a,b,c,d,e,f,g,h,i,j,k)}{const i=src[position++],j=src[position++],k=src[position++],l=src[position++];if((128&i)>0||(128&j)>0||(128&k)>0||(128&l)>0)return void(position-=12);if(length<14){if(12===length)return fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l);{const m=src[position++];return(128&m)>0?void(position-=13):fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m)}}{const m=src[position++],n=src[position++];if((128&m)>0||(128&n)>0)return void(position-=14);if(length<15)return fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m,n);const o=src[position++];return(128&o)>0?void(position-=15):fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o)}}}}}},"./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeUtf8=void 0;const v16_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importDefault(__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v16.js"));exports.decodeUtf8=v16_1.default},"./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v10.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fromCharCode=String.fromCharCode;exports.default=(buf,start,length)=>{let offset=start;const end=offset+length;let str="";for(;offset<end;){const octet1=buf[offset++];if(!(128&octet1)){str+=fromCharCode(octet1);continue}const octet2=63&buf[offset++];if(192==(224&octet1)){str+=fromCharCode((31&octet1)<<6|octet2);continue}const octet3=63&buf[offset++];if(224!=(240&octet1))if(240==(248&octet1)){let unit=(7&octet1)<<18|octet2<<12|octet3<<6|63&buf[offset++];if(unit>65535){unit-=65536;const unit0=unit>>>10&1023|55296;unit=56320|1023&unit,str+=fromCharCode(unit0,unit)}else str+=fromCharCode(unit)}else str+=fromCharCode(octet1);else str+=fromCharCode((31&octet1)<<12|octet2<<6|octet3)}return str}},"./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v16.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),decodeAscii_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/decodeAscii.js"),v18_1=tslib_1.__importDefault(__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v18.js")),hasBuffer="undefined"!=typeof Buffer,utf8Slice=hasBuffer?Buffer.prototype.utf8Slice:null,from=hasBuffer?Buffer.from:null,longDecoder=utf8Slice?(buf,start,length)=>utf8Slice.call(buf,start,start+length):from?(buf,start,length)=>from(buf).subarray(start,start+length).toString("utf8"):v18_1.default;exports.default=(buf,start,length)=>length<16?((buf,start,length)=>(0,decodeAscii_1.decodeAsciiMax15)(buf,start,length)??(0,v18_1.default)(buf,start,length))(buf,start,length):length<32?((buf,start,length)=>(0,decodeAscii_1.decodeAscii)(buf,start,length)??(0,v18_1.default)(buf,start,length))(buf,start,length):longDecoder(buf,start,length)},"./node_modules/json-joy/es2020/util/buffers/utf8/decodeUtf8/v18.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fromCharCode=String.fromCharCode;exports.default=(buf,start,length)=>{let offset=start;const end=offset+length,points=[];for(;offset<end;){let code=buf[offset++];if(128&code){const octet2=63&buf[offset++];if(192==(224&code))code=(31&code)<<6|octet2;else{const octet3=63&buf[offset++];if(224==(240&code))code=(31&code)<<12|octet2<<6|octet3;else if(240==(248&code)){let unit=(7&code)<<18|octet2<<12|octet3<<6|63&buf[offset++];if(unit>65535){unit-=65536;const unit0=unit>>>10&1023|55296;code=56320|1023&unit,points.push(unit0)}else code=unit}}}points.push(code)}return fromCharCode.apply(String,points)}},"./node_modules/json-joy/es2020/util/buffers/utf8/sharedCachedUtf8Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const CachedUtf8Decoder_1=__webpack_require__("./node_modules/json-joy/es2020/util/buffers/utf8/CachedUtf8Decoder.js");exports.default=new CachedUtf8Decoder_1.CachedUtf8Decoder},"./node_modules/json-joy/es2020/util/hasOwnProperty.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasOwnProperty=void 0;const has=Object.prototype.hasOwnProperty;exports.hasOwnProperty=function hasOwnProperty(obj,key){return has.call(obj,key)}},"./node_modules/json-joy/es2020/util/print/printBinary.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printBinary=void 0;exports.printBinary=(tab="",children)=>{const[left,right]=children;let str="";return left&&(str+=`\n${tab}← ${left(tab+"  ")}`),right&&(str+=`\n${tab}→ ${right(tab+"  ")}`),str}},"./node_modules/json-joy/es2020/util/print/printTree.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printTree=void 0;exports.printTree=(tab="",children)=>{children=children.filter(Boolean);let str="";for(let i=0;i<children.length;i++){const isLast=i>=children.length-1,fn=children[i];if(!fn)continue;const child=fn(tab+(isLast?" ":"│")+"  ");str+=`\n${tab}${child?isLast?"└─":"├─":"│ "} ${child}`}return str}},"./node_modules/json-joy/es2020/util/trees/avl/AvlMap.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AvlMap=exports.AvlNode=void 0;const util_1=__webpack_require__("./node_modules/json-joy/es2020/util/trees/avl/util.js"),printTree_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printTree.js"),util_2=__webpack_require__("./node_modules/json-joy/es2020/util/trees/util.js");class AvlNode{constructor(k,v){this.k=k,this.v=v,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}exports.AvlNode=AvlNode;const defaultComparator=(a,b)=>a===b?0:a<b?-1:1;exports.AvlMap=class AvlMap{constructor(comparator){this.root=void 0,this.next=util_2.next,this.comparator=comparator||defaultComparator}insert(k,v){const item=new AvlNode(k,v);return this.root=(0,util_1.insert)(this.root,item,this.comparator),item}set(k,v){const root=this.root;if(!root)return this.insert(k,v);const comparator=this.comparator;let next=root,curr=next,cmp=0;do{if(curr=next,cmp=comparator(k,curr.k),0===cmp)return curr.v=v,curr}while(next=cmp<0?curr.l:curr.r);const node=new AvlNode(k,v);return this.root=cmp<0?(0,util_1.insertLeft)(root,node,curr):(0,util_1.insertRight)(root,node,curr),node}find(k){const comparator=this.comparator;let curr=this.root;for(;curr;){const cmp=comparator(k,curr.k);if(0===cmp)return curr;curr=cmp<0?curr.l:curr.r}}get(k){return this.find(k)?.v}del(k){const node=this.find(k);return!!node&&(this.root=(0,util_1.remove)(this.root,node),!0)}clear(){this.root=void 0}has(k){return!!this.find(k)}size(){const root=this.root;if(!root)return 0;let curr=(0,util_2.first)(root),size=1;for(;curr=(0,util_2.next)(curr);)size++;return size}isEmpty(){return!this.root}getOrNextLower(k){return(0,util_2.findOrNextLower)(this.root,k,this.comparator)||void 0}forEach(fn){let curr=this.first();if(curr)do{fn(curr)}while(curr=(0,util_2.next)(curr))}first(){const root=this.root;return root?(0,util_2.first)(root):void 0}iterator0(){let curr=this.first();return()=>{if(!curr)return;const value=curr;return curr=(0,util_2.next)(curr),value}}iterator(){const iterator=this.iterator0();return{next:()=>{const value=iterator();return{value,done:!value}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(tab){return this.constructor.name+(0,printTree_1.printTree)(tab,[tab=>(0,util_1.print)(this.root,tab)])}}},"./node_modules/json-joy/es2020/util/trees/avl/util.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.print=exports.remove=exports.insert=exports.insertLeft=exports.insertRight=void 0;const stringify_1=__webpack_require__("./node_modules/json-joy/es2020/json-text/stringify.js"),printBinary_1=__webpack_require__("./node_modules/json-joy/es2020/util/print/printBinary.js"),rebalanceAfterInsert=(root,node,child)=>{const p=node.p;if(!p)return root;const isLeft=node===p.l;let bf=0|p.bf;switch(p.bf=isLeft?++bf:--bf,bf){case 0:return root;case 1:case-1:return rebalanceAfterInsert(root,p,node);default:{const isChildLeft=child===node.l;return isLeft?isChildLeft?(llRotate(p,node),node.p?root:node):(lrRotate(p,node,child),child.p?root:child):isChildLeft?(rlRotate(p,node,child),child.p?root:child):(rrRotate(p,node),node.p?root:node)}}},llRotate=(n,nl)=>{const p=n.p,nlr=nl.r;nl.p=p,nl.r=n,n.p=nl,n.l=nlr,nlr&&(nlr.p=n),p&&(p.l===n?p.l=nl:p.r=nl);let nbf=n.bf,nlbf=nl.bf;nbf+=-1-(nlbf>0?nlbf:0),nlbf+=-1+(nbf<0?nbf:0),n.bf=nbf,nl.bf=nlbf},rrRotate=(n,nr)=>{const p=n.p,nrl=nr.l;nr.p=p,nr.l=n,n.p=nr,n.r=nrl,nrl&&(nrl.p=n),p&&(p.l===n?p.l=nr:p.r=nr);let nbf=n.bf,nrbf=nr.bf;nbf+=1-(nrbf<0?nrbf:0),nrbf+=1+(nbf>0?nbf:0),n.bf=nbf,nr.bf=nrbf},lrRotate=(n,nl,nlr)=>{rrRotate(nl,nlr),llRotate(n,nlr)},rlRotate=(n,nr,nrl)=>{llRotate(nr,nrl),rrRotate(n,nrl)};exports.insertRight=(root,n,p)=>(p.r=n,n.p=p,p.bf--,p.l?root:rebalanceAfterInsert(root,p,n));exports.insertLeft=(root,n,p)=>(p.l=n,n.p=p,p.bf++,p.r?root:rebalanceAfterInsert(root,p,n));exports.insert=(root,node,comparator)=>{if(!root)return node;const key=node.k;let next,curr=root,cmp=0;for(;next=(cmp=comparator(key,curr.k))<0?curr.l:curr.r;)curr=next;return cmp<0?(0,exports.insertLeft)(root,node,curr):(0,exports.insertRight)(root,node,curr)};exports.remove=(root,n)=>{if(!root)return n;const p=n.p,l=n.l,r=n.r;if(n.p=n.l=n.r=void 0,l&&r){if(l.r){let v=l,tmp=v;for(;tmp=v.r;)v=tmp;const vl=v.l,vp=v.p,vc=vl;return p&&(p.l===n?p.l=v:p.r=v),v.p=p,v.r=r,v.bf=n.bf,l!==v&&(v.l=l,l.p=v),r.p=v,vp&&(vp.l===v?vp.l=vc:vp.r=vc),vc&&(vc.p=vp),rRebalance(p?root:v,vp,1)}{p&&(p.l===n?p.l=l:p.r=l),l.p=p,l.r=r,r.p=l;const nbf=n.bf;if(p)return l.bf=nbf,lRebalance(root,l,1);const lbf=nbf-1;if(l.bf=lbf,lbf>=-1)return l;const rl=r.l;return r.bf>0?(rlRotate(l,r,rl),rl):(rrRotate(l,r),r)}}const c=l||r;return c&&(c.p=p),p?p.l===n?(p.l=c,lRebalance(root,p,1)):(p.r=c,rRebalance(root,p,1)):c};const lRebalance=(root,n,d)=>{let bf=0|n.bf;bf-=d,n.bf=bf;let nextD=d;if(-1===bf)return root;if(bf<-1){const u=n.r;if(u.bf<=0)u.l&&0===u.bf&&(nextD=0),rrRotate(n,u),n=u;else{const ul=u.l;rlRotate(n,u,ul),n=ul}}const p=n.p;return p?p.l===n?lRebalance(root,p,nextD):rRebalance(root,p,nextD):n},rRebalance=(root,n,d)=>{let bf=0|n.bf;bf+=d,n.bf=bf;let nextD=d;if(1===bf)return root;if(bf>1){const u=n.l;if(u.bf>=0)u.r&&0===u.bf&&(nextD=0),llRotate(n,u),n=u;else{const ur=u.r;lrRotate(n,u,ur),n=ur}}const p=n.p;return p?p.l===n?lRebalance(root,p,nextD):rRebalance(root,p,nextD):n};exports.print=(node,tab="")=>{if(!node)return"∅";const{bf,l,r,k,v}=node,vFormatted=v&&"object"==typeof v&&v.constructor===Object?(0,stringify_1.stringify)(v):v&&"object"==typeof v?v.toString(tab):(0,stringify_1.stringify)(v),content=void 0!==k?` { ${(0,stringify_1.stringify)(k)} = ${vFormatted} }`:"",bfFormatted=bf?` [${bf}]`:"";return node.constructor.name+`${bfFormatted}`+content+(0,printBinary_1.printBinary)(tab,[l?tab=>(0,exports.print)(l,tab):null,r?tab=>(0,exports.print)(r,tab):null])}},"./node_modules/json-joy/es2020/util/trees/splay/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rlSplay=exports.lrSplay=exports.llSplay=exports.rrSplay=exports.lSplay=exports.rSplay=exports.splay=void 0;exports.splay=(root,node,repeat)=>{const p=node.p;if(!p)return root;const pp=p.p,l2=p.l===node;if(!pp)return l2?(0,exports.rSplay)(node,p):(0,exports.lSplay)(node,p),node;return root=pp.l===p?l2?(0,exports.llSplay)(root,node,p,pp):(0,exports.lrSplay)(root,node,p,pp):l2?(0,exports.rlSplay)(root,node,p,pp):(0,exports.rrSplay)(root,node,p,pp),repeat>1?(0,exports.splay)(root,node,repeat-1):root};exports.rSplay=(c2,c1)=>{const b=c2.r;c2.p=void 0,c2.r=c1,c1.p=c2,c1.l=b,b&&(b.p=c1)};exports.lSplay=(c2,c1)=>{const b=c2.l;c2.p=void 0,c2.l=c1,c1.p=c2,c1.r=b,b&&(b.p=c1)};exports.rrSplay=(root,c3,c2,c1)=>{const b=c2.l,c=c3.l,p=c1.p;return c3.p=p,c3.l=c2,c2.p=c3,c2.l=c1,c2.r=c,c1.p=c2,c1.r=b,b&&(b.p=c1),c&&(c.p=c2),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.llSplay=(root,c3,c2,c1)=>{const b=c2.r,c=c3.r,p=c1.p;return c3.p=p,c3.r=c2,c2.p=c3,c2.l=c,c2.r=c1,c1.p=c2,c1.l=b,b&&(b.p=c1),c&&(c.p=c2),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.lrSplay=(root,c3,c2,c1)=>{const c=c3.l,d=c3.r,p=c1.p;return c3.p=p,c3.l=c2,c3.r=c1,c2.p=c3,c2.r=c,c1.p=c3,c1.l=d,c&&(c.p=c2),d&&(d.p=c1),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.rlSplay=(root,c3,c2,c1)=>{const c=c3.r,d=c3.l,p=c1.p;return c3.p=p,c3.l=c1,c3.r=c2,c2.p=c3,c2.l=c,c1.p=c3,c1.r=d,c&&(c.p=c2),d&&(d.p=c1),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root}},"./node_modules/json-joy/es2020/util/trees/splay/util2.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.splay2=void 0;exports.splay2=(root,node)=>{const p=node.p2;if(!p)return root;const pp=p.p2,l2=p.l2===node;if(!pp)return l2?rSplay2(node,p):lSplay2(node,p),node;return root=pp.l2===p?l2?llSplay2(root,node,p,pp):lrSplay2(root,node,p,pp):l2?rlSplay2(root,node,p,pp):rrSplay2(root,node,p,pp),(0,exports.splay2)(root,node)};const rSplay2=(c2,c1)=>{const b=c2.r2;c2.p2=void 0,c2.r2=c1,c1.p2=c2,c1.l2=b,b&&(b.p2=c1)},lSplay2=(c2,c1)=>{const b=c2.l2;c2.p2=void 0,c2.l2=c1,c1.p2=c2,c1.r2=b,b&&(b.p2=c1)},rrSplay2=(root,c3,c2,c1)=>{const b=c2.l2,c=c3.l2,p=c1.p2;return c3.p2=p,c3.l2=c2,c2.p2=c3,c2.l2=c1,c2.r2=c,c1.p2=c2,c1.r2=b,b&&(b.p2=c1),c&&(c.p2=c2),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},llSplay2=(root,c3,c2,c1)=>{const b=c2.r2,c=c3.r2,p=c1.p2;return c3.p2=p,c3.r2=c2,c2.p2=c3,c2.l2=c,c2.r2=c1,c1.p2=c2,c1.l2=b,b&&(b.p2=c1),c&&(c.p2=c2),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},lrSplay2=(root,c3,c2,c1)=>{const c=c3.l2,d=c3.r2,p=c1.p2;return c3.p2=p,c3.l2=c2,c3.r2=c1,c2.p2=c3,c2.r2=c,c1.p2=c3,c1.l2=d,c&&(c.p2=c2),d&&(d.p2=c1),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},rlSplay2=(root,c3,c2,c1)=>{const c=c3.r2,d=c3.l2,p=c1.p2;return c3.p2=p,c3.l2=c1,c3.r2=c2,c2.p2=c3,c2.l2=c,c1.p2=c3,c1.r2=d,c&&(c.p2=c2),d&&(d.p2=c1),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root}},"./node_modules/json-joy/es2020/util/trees/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove=exports.insert=exports.insertLeft=exports.insertRight=exports.findOrNextLower=exports.find=exports.size=exports.prev=exports.next=exports.last=exports.first=void 0;exports.first=root=>{let curr=root;for(;curr;){if(!curr.l)return curr;curr=curr.l}return curr};exports.last=root=>{let curr=root;for(;curr;){if(!curr.r)return curr;curr=curr.r}return curr};exports.next=curr=>{if(curr.r){for(curr=curr.r;curr.l;)curr=curr.l;return curr}let p=curr.p;for(;p&&p.r===curr;)curr=p,p=p.p;return p};exports.prev=curr=>{if(curr.l){for(curr=curr.l;curr.r;)curr=curr.r;return curr}let p=curr.p;for(;p&&p.l===curr;)curr=p,p=p.p;return p};exports.size=root=>{if(!root)return 0;let curr=(0,exports.first)(root),result=1;for(;curr=(0,exports.next)(curr);)result++;return result};exports.find=(root,key,comparator)=>{let curr=root;for(;curr;){const cmp=comparator(key,curr.k);if(0===cmp)return curr;curr=cmp<0?curr.l:curr.r}return curr};exports.findOrNextLower=(root,key,comparator)=>{let result,curr=root;for(;curr;){const cmp=comparator(curr.k,key);if(0===cmp)return curr;if(cmp>0)curr=curr.l;else{const next=curr.r;if(result=curr,!next)return result;curr=next}}return result};exports.insertRight=(node,p)=>{const r=node.r=p.r;p.r=node,node.p=p,r&&(r.p=node)};exports.insertLeft=(node,p)=>{const l=node.l=p.l;p.l=node,node.p=p,l&&(l.p=node)};exports.insert=(root,node,comparator)=>{if(!root)return node;const key=node.k;let curr=root;for(;curr;){const cmp=comparator(key,curr.k),next=cmp<0?curr.l:curr.r;if(!next){cmp<0?(0,exports.insertLeft)(node,curr):(0,exports.insertRight)(node,curr);break}curr=next}return root};exports.remove=(root,node)=>{const p=node.p,l=node.l,r=node.r;if(node.p=node.l=node.r=void 0,!l&&!r){if(!p)return;return p.l===node?p.l=void 0:p.r=void 0,root}if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r;)mostRightChildFromLeft=mostRightChildFromLeft.r;return mostRightChildFromLeft.r=r,r.p=mostRightChildFromLeft,p?(p.l===node?p.l=l:p.r=l,l.p=p,root):(l.p=void 0,l)}const child=l||r;return child.p=p,p?(p.l===node?p.l=child:p.r=child,root):child}},"./node_modules/json-joy/es2020/util/trees/util2.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove2=exports.insert2=exports.prev2=exports.next2=exports.last2=exports.first2=void 0;exports.first2=root=>{let curr=root;for(;curr;){if(!curr.l2)return curr;curr=curr.l2}return curr};exports.last2=root=>{let curr=root;for(;curr;){if(!curr.r2)return curr;curr=curr.r2}return curr};exports.next2=curr=>{if(curr.r2){for(curr=curr.r2;curr.l2;)curr=curr.l2;return curr}let p=curr.p2;for(;p&&p.r2===curr;)curr=p,p=p.p2;return p};exports.prev2=curr=>{if(curr.l2){for(curr=curr.l2;curr.r2;)curr=curr.r2;return curr}let p=curr.p2;for(;p&&p.l2===curr;)curr=p,p=p.p2;return p};const insertRight2=(node,p)=>{const r=node.r2=p.r2;p.r2=node,node.p2=p,r&&(r.p2=node)},insertLeft2=(node,p)=>{const l=node.l2=p.l2;p.l2=node,node.p2=p,l&&(l.p2=node)};exports.insert2=(root,node,comparator)=>{if(!root)return node;let curr=root;for(;curr;){const cmp=comparator(node,curr),next=cmp<0?curr.l2:curr.r2;if(!next){cmp<0?insertLeft2(node,curr):insertRight2(node,curr);break}curr=next}return root};exports.remove2=(root,node)=>{const p=node.p2,l=node.l2,r=node.r2;if(node.p2=node.l2=node.r2=void 0,!l&&!r){if(!p)return;return p.l2===node?p.l2=void 0:p.r2=void 0,root}if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r2;)mostRightChildFromLeft=mostRightChildFromLeft.r2;return mostRightChildFromLeft.r2=r,r.p2=mostRightChildFromLeft,p?(p.l2===node?p.l2=l:p.r2=l,l.p2=p,root):(l.p2=void 0,l)}const child=l||r;return child.p2=p,p?(p.l2===node?p.l2=child:p.r2=child,root):child}},"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var f=__webpack_require__("./node_modules/react/index.js"),k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,g){var b,d={},e=null,h=null;for(b in void 0!==g&&(e=""+g),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(h=a.ref),a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")},"./node_modules/thingies/es2020/fanout.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FanOut=void 0;exports.FanOut=class FanOut{constructor(){this.listeners=new Set}emit(data){this.listeners.forEach((listener=>listener(data)))}listen(listener){const listeners=this.listeners;return listeners.add(listener),()=>listeners.delete(listener)}}},"./node_modules/tslib/tslib.es6.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__addDisposableResource:()=>__addDisposableResource,__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldIn:()=>__classPrivateFieldIn,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__disposeResources:()=>__disposeResources,__esDecorate:()=>__esDecorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__propKey:()=>__propKey,__read:()=>__read,__rest:()=>__rest,__runInitializers:()=>__runInitializers,__setFunctionName:()=>__setFunctionName,__spread:()=>__spread,__spreadArray:()=>__spreadArray,__spreadArrays:()=>__spreadArrays,__values:()=>__values,default:()=>__WEBPACK_DEFAULT_EXPORT__});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __esDecorate(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0}function __runInitializers(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0}function __propKey(x){return"symbol"==typeof x?x:"".concat(x)}function __setFunctionName(f,name,prefix){return"symbol"==typeof name&&(name=name.description?"[".concat(name.description,"]"):""),Object.defineProperty(f,"name",{configurable:!0,value:prefix?"".concat(prefix," ",name):name})}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var __createBinding=Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]};function __exportStar(m,o){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(o,p)||__createBinding(o,m,p)}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise((function(a,b){q.push([n,v,a,b])>1||resume(n,v)}))})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",(function(e){throw e})),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:!1}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)})(resolve,reject,(v=o[n](v)).done,v.value)}))}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}var __setModuleDefault=Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v};function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)}function __classPrivateFieldSet(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value}function __classPrivateFieldIn(state,receiver){if(null===receiver||"object"!=typeof receiver&&"function"!=typeof receiver)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof state?receiver===state:state.has(receiver)}function __addDisposableResource(env,value,async){if(null!=value){if("object"!=typeof value&&"function"!=typeof value)throw new TypeError("Object expected.");var dispose;if(async){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");dispose=value[Symbol.asyncDispose]}if(void 0===dispose){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");dispose=value[Symbol.dispose]}if("function"!=typeof dispose)throw new TypeError("Object not disposable.");env.stack.push({value,dispose,async})}else async&&env.stack.push({async:!0});return value}var _SuppressedError="function"==typeof SuppressedError?SuppressedError:function(error,suppressed,message){var e=new Error(message);return e.name="SuppressedError",e.error=error,e.suppressed=suppressed,e};function __disposeResources(env){function fail(e){env.error=env.hasError?new _SuppressedError(e,env.error,"An error was suppressed during disposal."):e,env.hasError=!0}return function next(){for(;env.stack.length;){var rec=env.stack.pop();try{var result=rec.dispose&&rec.dispose.call(rec.value);if(rec.async)return Promise.resolve(result).then(next,(function(e){return fail(e),next()}))}catch(e){fail(e)}}if(env.hasError)throw env.error}()}const __WEBPACK_DEFAULT_EXPORT__={__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources}}}]);